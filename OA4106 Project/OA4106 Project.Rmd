---
title: "OA4106 Project"
author: "David Wren"
date: "9/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction
The very nature of the global landscape in the 21st century can be characterized as one of uncertainty and unpredictability.  Through the rise of globalization, a process compelled by investments and international trade, facilitated through the increase use of information technology, societies are becoming better integrated and more interconnected.   However, one thing is certain: as globalization continues, strife amongst societies will persist.  Our adversaries will continue to seek environment dominance and create an asymmetrical advantage by establishing regional hegemony to disrupt U.S. sanctuary at home or abroad.   Bahrain is no exception as actors, both state and non-state, have sought to establish strategic control and influence over their population since 2011.  These acts have resulted in violent and nonviolent protests occurring on a near daily basis within the kingdom.  Therefore, developing a model to predict populace behavior is vital to U.S. strategic objectives.

# Scenario
A team of analysts, LT Angeles, Capt Biles, and CPT Wren are assigned to 5th Fleet/US Navy Central Command (NAVCENT) located at NSA Bahrain.  5th Fleet has asked its analyst team to model the civil unrest within the island using open source data.

Collecting raw civil data within the Political, Military, Economic, Social, Information, Infrastructure, Physical Environment, and Time (PMESII-PT) variables allows the 5th Fleet analyst team to follow a commonly understood framework.  By applying data mining techniques across open source websites, daily data beginning on January 1st, 2016, through December 31st, 2019, from across 191 PMESII-PT independent variables was gathered and collated.  This time period resulted in a sample size, n, of 1461.  By collecting data across PMESII-PT variables, one is able to develop a baseline understanding of an operational environment that is comprehended universally by military leaders.  It is important to note that each operational environment is unique and that while some PMESII-PT variables are applicable, each environment requires its own data collection plan.  While individual variables do not dominate every operational environment, they are all present and require careful consideration; ignoring one or more of these variables can negatively impact military missions and degrade a commander’s understanding of the operational environment.


```{r, message = FALSE, error = FALSE, warning = FALSE, echo = FALSE}
# Code sourced from: https://community.rstudio.com/t/how-to-clear-the-r-environment/14303
# Clears global environment
rm(list = ls())

setwd("~/")
setwd("~/Operations Research/Q5/OA4106/Project")

library(GGally) # Plotting data
library(ggmap) # Geospatial data
library(ggplot2) # Plotting data
library(plotly) # Generating EDA and plots
library(plotmo) # Plot residuals
library(car) # Calculate VIF
library(caret) # Modeling package for confusion matrix
library(glmnet) # Modeling package for introducing bias
library(tidyverse) # Generating plots
library(leaps) # Required library for computing subsets
library(MASS) # Required package for stepwise selection
library(L1pack) # Required package to compute LAD
library(ggpubr) # Correlation plot
library(tsbox) # Creates a time series object
library(seastests) # library for seasonality tests
library(RColorBrewer) # Provides a color library for map plots
library(qpcR) # Calculate Residual Sum of Squares
library(randomForest) # RandomForest library
library(e1071) # Package for fitting SVM
library(rpart.plot) # New package for making pretty pictures of CART trees
library(data.table) # Library for data.table
library(gridExtra) ## Libraries for Plotting our Results
library(devtools)
library(plyr)
library(rmarkdown)
library(knitr)
library(base64enc)
library(xtable)
library(forecast)
library(Rcpp)
library(rCharts)
library(marima) # Package required to compute Marima models
library(vars)
library(dynlm) 
library(adabag) # AdaBoost
library(car) # Calculate VIF
library(ggfortify)
library(devtools)

# Set seed for repeatability
set.seed(0)

# Read in the master_df.csv that contains predictors and response
master_df <- read.csv('master_df.csv', header = TRUE)

# Read in the raw data that contains the target variables
raw_df <- read.csv('2016-01-01-2019-12-31-Bahrain.csv', header = TRUE)

# Aggregate protests by event type over each day
by_date_type <- raw_df %>% group_by(event_date, event_type, sub_event_type) %>% dplyr::summarise(count = n())

# Change the date format
by_date_type$event_date <- as.Date(by_date_type$event_date, format='%d-%b-%y')
master_df$event_date <- as.Date(master_df$event_date, format = '%m/%d/%Y')
```

# Codebook
The predictors in master_df.csv utilized Political-Military-Economic-Social-Information-Infrastructure-Physical_Environment-Time (PMESII-PT) as a framework for data collection.

1. Political
 + Political entities such as President Trump, Iranian President Hasan Rouhani, Bahrain's Ministry of Interior, and Israeli Prime Minister Benjamin Netanyahu utilize various social media platforms to include Twitter.  These data are captured using a Python script and a Twitter developer API and reported a daily count of the number of posts, favorites, and retweets.
 
2. Military
  + Although arrest records are openly available via their department website, it is difficult to get historical data.  As such, there is no data available in any dataframe.
 
3. Economic
 + Data mining of Bahrain’s currency exchange rate reveals minimal fluctuation between 2.645 to 2.660 Bahraini Dinar to the United States Dollar.  As a result, the impact of Bahrain’s exchange rate is minimal and excluded from this data set.
 + Like most developed nations, Bahrain employs a stock market, the Bahrain Bourse or Bahrain Stock Exchange (BSE), where the issuing and trading of bonds, securities, and equities occurs through formal exchanges.
 + In addition to the Bourse, the primary industries within Bahrain are: petroleum processing and refining, aluminum smelting, and iron palletization, which produce trackable indices and are tradable on the open market.
 + Additional commodities such as gold, natural gas, and Bitcoin were also collected, which diversified the data collection portfolio.
 + Some experts contend that one of the driving forces behind the Arab Spring in 2011 was the high cost of food.  Therefore, the prices of corn, rice, wheat, cattle, soybeans, cocoa, cane sugar, and coffee were also tracked on the open market.
 + When tracking these commodities on the open market, daily high, low, open, and close are all presented for trading days.
 + However, on days when no trading occurred such as weekends and federal holidays, tracked prices were set to the previous day’s values.  For example, Saturday and Sunday's data are equal to Friday’s data.
 
4. No daily social or Infrastructure data collected as they are difficult to measure categorically and even harder to quantify.  

5. Information
 + According to the Arab Social Media Report 2015, mobile messaging application Whatsapp has a penetration rate of 85%, Facebook has a penetration rate of 81%, Instagram has a penetration rate of 51%, and Twitter has a penetration rate of 47% for Bahrain.
 + Due to encryption protocols within Whatsapp, mining data and its usage are not possible.
 + Various insurgent groups utilize social media as a medium for propaganda purposes to depict their activity and potentially serve as a recruiting tool.
 + Some Twitter accounts post their messages in both English and Arabic while some only utilize Arabic. 
 
6. Physical Environment
 + The National Oceanic and Atmospheric Administration provides historical data for Bahrain at its international airport.  
 + Daily data collected included temperature, dew point, wind speed, gusts, and total rainfall.

7. Time
 + Various aspects of time and the perception of them can affect and influence military operations both friendly and enemy within the environment.  
 + As each day passes, the numerical day, day of the week, and month are collected in passing.  
 + Holiday information is represented for both Bahraini political and religious holidays while moon illumination is produced by the U.S. Naval Observatory in Washington D.C. for each time zone around the world.
 
Our various target variables, 2016-01-01-2019-12-31-Bahrain.csv, are provided by The Armed Conflict Location & Event Data (ACLED) Project, which "is a disaggregated data collection, analysis, and crisis mapping project.  ACLED collects the dates, actors, locations, fatalities, and modalities of all reported political violence and protest events across Africa, South Asia, Southeast Asia, the Middle East, Central Asia, and the Caucasus, Latin America and the Caribbean, and Southeastern and Eastern Europe and the Balkans.  The ACLED team conducts analysis to describe, explore, and test conflict scenarios, and makes both data and analysis open for free use by the public." Source: https://acleddata.com/about-acled/

For the initial stages of this analysis, the team will focus its efforts to predict the total number of riots, which is an aggregated sum of mob violence and violent demonstrations.  Further analysis below conducts dimensionality reduction and attempting to predict that new target variable.

# Exploratory Data Analysis (EDA): Part 1

The ACLED data set provided several different event and sub-event categories for study and analysis.  (Notionally) 5th Fleet is interested in any event that could potentially cause a disruption in base operations.  Analyzing the data can enable the team to identify patterns, discover anomalies, and generate hypotheses. Analyzing the raw data led the team to categorize social media posts, month, and weekday as discrete variables and holiday as binary.  The team elects to conduct a more thorough EDA once it selects an event to model.

```{r}
# Bar chart presenting event types over time along with their count
plot1 <- ggplot(by_date_type, aes(fill=event_type, y=count, x=event_date)) + 
    geom_bar(position="stack", stat="identity") + scale_x_date(date_breaks='year', date_labels='%y') + 
  labs(title='Bahrain Events (01-JAN-16 to 31-DEC-19)', x='Date', y='Count') +
  theme(legend.title=element_blank(), legend.position='right', legend.text=element_text(size=9))
  
ggplotly(plot1, tooltip=c('y', 'x', 'event_type')) 
```

From Plot1 we can see that protests make up the majority of our events.  However, these protests can be divided into peaceful or violent and this warrants further analysis.  Although violent and nonviolent protests occur on a near daily basis in the Kingdom of Bahrain, these protests are localized to predominately Shi’ite neighborhoods such as Diraz, Sitra, and Ma’ameer.  Despite being predominantly Shi’ite districts, these neighborhoods present distinct social, economic, and political challenges when identifying and understanding the civil domain.

```{r}
# Bar chart presenting sub event types over time along with their count
plot2 <- ggplot(by_date_type, aes(fill=sub_event_type, y=count, x=event_date)) +
  geom_bar(position="stack", stat="identity") + scale_x_date(date_breaks='years', date_labels='%y') +
  theme(legend.title=element_blank(), legend.position='bottom', legend.text=element_text(size=9)) + 
  labs(title='Bahrain Sub-events (01-JAN-16 to 31-DEC-19)', x='Date', y='Count')
  
ggplotly(plot2, tooltip=c('y', 'x', 'sub_event_type')) 
```

From Plot2 we can see that the majority of events are peaceful demonstrations.  However, this conclusion leads to further discussion about peaceful protests turning violent or action caused by the government against civilians.  The code analyzing this phenomenon is further below (EDA Question #3).

```{r plot template, results=FALSE, include=FALSE, message = FALSE, warning = FALSE}
plot3 <- ggplot(by_date_type, aes(x=event_date, y=count)) + 
  geom_point(alpha=0.7, cex=2, aes(fill=event_type)) + 
  labs(title='Bahrain Events (01-JAN-16 to 31-DEC-19)', x='Date', y='Count') + 
  scale_fill_brewer(palette='Dark2') + 
  scale_x_date(date_breaks='months', date_labels='%b') +
  theme(legend.title=element_blank(), legend.position='right', legend.text=element_text(size=9), plot.title=element_text(size=9, face='bold'), axis.title.x=element_text(size=7, face='bold'), axis.title.y=element_text(size=7, face='bold'))

ggplotly(plot3)
```

```{r}
# GG plot for riots during our time frame
plot4 <- master_df %>%
  ggplot( aes(x=event_date, y=riot_count)) +
    geom_area(fill="#69b3a2", alpha=0.5) +
    geom_line(color="#69b3a2") +
    labs(title='Bahrain Riots (01-JAN-16 to 31-DEC-19)', x='Date', y='Count') + 
  scale_x_date(date_breaks='years', date_labels='%Y')
    
ggplotly(plot4, tooltip=c('y', 'x', 'event_type'))
```

In Plot4 we can see that although violent demonstrations occur nearly every day, there appears to be a cyclical nature for high volume events.  Terrorists and insurgents often use a cycle to carry out their attacks. According to the Director of National Intelligence, the terrorism cycle roughly consists of re-attack surveillance, training, and rehearsals.  Conversely, the spike in protests may be in response to government actions against civilians or simply pure coincidence.  In the R chunk below we will explore the seasonality nature of these demonstrations (EDA Question #1).  A time series is said to be stationary if it holds the following conditions true:  

1. The mean value of time-series is constant over time, which implies, the trend component is nullified.
2. The variance does not increase over time.
3. Seasonality effect is minimal.
Source: http://r-statistics.co/Time-Series-Analysis-With-R.html

In order to determine seasonality, we will utilize the Webel and Ollech (2019) test, which is an overall test for seasonality of a given time series. 
Source: https://cran.r-project.org/web/packages/seastests/seastests.pdf

```{r, warning = FALSE, echo = FALSE}
# EDA Question #1: Is there evidence of a terrorist/insurgent attack cycle via seasonality analysis?

# Code sourced from https://cran.r-project.org/web/packages/seastests/vignettes/seastests-vignette.html

# Creates a dataframe for conversion into a time series object
tsData <- cbind(ts(master_df[, 1]), master_df[, 223])

# Creates a time series object
ts_obj <- ts_ts(ts_long(tsData))

# Performs a simple Webel and Ollech seasonality test
isSeasonal(ts_obj, test = 'wo', freq = 7)

# Checks for seasonality within a month
# Create a sequence of days from 1 to 30
day_seq <- seq(1,30, 1)
i <- 1 # Initialize a counter

# Create empty data containers for storage
kw_df <- data.frame() 

# Iterate over the length of 30 days
while(i <= length(day_seq)){
  # store the results of the Kruskal Wallace test
  kw_df[i,1] <- kw(ts_obj, freq = i, diff = T, residuals = F, autoarima = T)$Pval
  kw_df[i,2] <- i
  
  i = i + 1 # Increment the counter
}

# Change column names
names(kw_df)[1] <- "P-value"
names(kw_df)[2] <- "Day"

# Produce the trend and remainder data.
forecast::mstl(master_df$riot_count)
```

```{r, echo = FALSE}
# Print the p-values for the 30 day cycle
i <- 1 # Initialize a counter
while(i <= nrow(kw_df)){ # Iterate over the length of the Kruskal-Wallace dataframe
  print(paste("Day ", i, " has p-value", kw_df$`P-value`[i])) # print statement for each p-value
  i = i + 1 # increment the counter
}

# Determine the day cycle that has the lowest p-value
print(paste("The estimated cycle is", which.min(kw_df$`P-value`), "days"))

# Plot depicting seasonality trends
plot5 <- forecast::mstl(master_df$riot_count, lambda = "auto") %>% autoplot() + labs(title='Bahrain Seasonality Trends (01-JAN-16 to 31-DEC-19)')

plot5
```

By utilizing the Kruskal-Wallace Test with 30 groups, we are able to determine if there are differences between two or more groups of an independent variable on a continuous or ordinal dependent variable (source: https://statistics.laerd.com/spss-tutorials/kruskal-wallis-h-test-using-spss-statistics.php).  From the output above, we are able to conclude that there is sufficient evidence that riots occur on a 5 or 13-day cycle due to their low p-value.  Further analysis of Plot5 contributes to this conclusion as it's trending mean is approximately zero with an almost constant variance.  As these attacks appear to be seasonal, the team lacks sufficient evidence to pinpoint the exact duration of the insurgent planning cycle.

Speculation amongst the analyst team at 5th Fleet (notional) believes that these protests are localized within predominately Shi'a neighborhoods who believe they are oppressed by the government.  Identifying the towns with the most disruptions will enable effective force protection measures and ensuring minimal risk to the base. 

EDA Question #2: Where are the protests occurring and what is the subsequent risk to the base and personnel?

```{r, message = FALSE, error = FALSE, warning = FALSE}
# EDA Question #2: Where are the protests occurring and what is the risk to the base?

# Aggregate protests by location and exclude non-violent protests
by_location_type <- raw_df %>% group_by(location, sub_event_type != 'Peaceful protest') %>% dplyr::summarise(count = n())

# Change column name to Boolean_Violence
names(by_location_type)[2] <- "Boolean_Violence"

# Filter data that only accounts for violent protests only
filtered_location_df <- data.frame(by_location_type[by_location_type$Boolean_Violence == TRUE,])

# Sort the dataframe above with the highest number of events
filtered_location_df <- head(filtered_location_df[order(filtered_location_df$count, decreasing = TRUE),],10)

# Top 10 locations for violent/nonviolent protests
filtered_location_df['longitude'] <- NA
filtered_location_df['latitude'] <- NA
violent_locs <- filtered_location_df %>% pull(location)
for (loc in violent_locs) {
  filtered_location_df[filtered_location_df$location==loc,]['longitude'] <- raw_df[raw_df$location==loc,]$longitude[1]
  filtered_location_df[filtered_location_df$location==loc,]['latitude'] <- raw_df[raw_df$location==loc,]$latitude[1]
}

# All locations for violent/nonviolent protests
by_loc_type_df <- as.data.frame(by_location_type)
unique_locs <- by_loc_type_df %>% pull(location)
unique_locs <- unique(unique_locs)
by_loc_type_df['longitude'] <- NA
by_loc_type_df['latitude'] <- NA
for (loc in unique_locs) {
  by_loc_type_df[by_loc_type_df$location==loc,]['longitude'] <- raw_df[raw_df$location==loc,]$longitude[1]
  by_loc_type_df[by_loc_type_df$location==loc,]['latitude'] <- raw_df[raw_df$location==loc,]$latitude[1]
}

# Bar plot for top 10 violent demonstrations
plot6 <- ggplot(filtered_location_df, aes(x=reorder(location, -count), y=count, fill=location)) + geom_bar(stat='identity') + labs(title='Top 10 Violent Demonstrations (01-JAN-16 to 31-DEC-19)', x='Location', y='Count') + geom_text(aes(label=count), vjust=1.6, color="white", size=3) + scale_fill_brewer(palette='Paired') + theme(legend.position='none', axis.text.x=element_text(angle=45, hjust = 1))

plot6

Sys.setenv('MAPBOX_TOKEN' = 'pk.eyJ1IjoiZGF2aWR3cmVuIiwiYSI6ImNrYWxqNG8xZTB0bW0ycmxiNGI2NW9jenAifQ.XspCPRtcou2DCia28IF3og')

# Bubble map for where violent demonstrations are occurring
plot7 <- plot_mapbox(maps::canada.cities) %>%
  add_markers(data= by_loc_type_df[by_loc_type_df$Boolean_Violence==TRUE,],
    x = ~longitude,
    y = ~latitude, split=~location,
    size=~count,
    color = ~count,
    text=~paste('Count:', count)) %>%
  layout(
    showlegend=FALSE, title='Bahrain Riots (01-JAN-16 to 31-DEC-19)',
    mapbox=list(center=list(lat=median(raw_df$latitude), lon=median(raw_df$longitude)), zoom=9))

plot7

# Bubble map for where non-violent demonstrations are occurring
plot8 <- plot_mapbox(maps::canada.cities) %>%
  add_trace(data= by_loc_type_df[by_loc_type_df$Boolean_Violence==FALSE,], type='scattergeo',
    x = ~longitude,
    y = ~latitude, split=~location,
    size=~count,
    color = ~count,
    text=~paste('Count:', count)) %>%
  layout(
    showlegend=FALSE, title='Non-violent Demonstrations (01-JAN-17 to 31-DEC-19)',
    mapbox=list(center=list(lat=median(raw_df$latitude), lon=median(raw_df$longitude)), zoom=9))

plot8
```

The bar graph compares the number of riots of the top ten cities in Bahrain that have the highest count; Nuwaidrat experienced the most violent demonstrations at 387.  From the bubble map of violent demonstrations, we see that not very many protests actually occur around NSA Bahrain; there were only 91 violent protests northwest of NSA Bahrain in Juffair.  Most of the protests occurred in the south-southwest region of Bahrain, largely focused on the cities of Sitra and Ma'ameer.  Conversely, large numbers of peaceful protests are more spread out through the country.  While Ma'ameer still experienced many peaceful protests, cities like Budaiya, Jid Hafs, and A'ali have also experienced a large amount.  Additionally, we see that not very many peaceful protests occurred around NSA Bahrain, with the closest city being Juffair at 25 protests.

```{r}
# EDA Question #3: What is the relationship between nonviolent protests and violent demonstrations?

# This code determines the correlation between peaceful protests and violent demonstrations
cor.test(master_df$riot_count, master_df$Peaceful_protest_count)

# Create a dataframe for correlation plotting
corr_df <- data.frame(master_df$riot_count, master_df$Peaceful_protest_count)

# Change column names
names(corr_df)[1] <- "Riots"
names(corr_df)[2] <- "Peaceful_Protests"

# Code sourced from: http://www.sthda.com/english/wiki/correlation-test-between-two-variables-in-r
# Create a plot
plot9 <- ggscatter(corr_df, x = "Riots", y = "Peaceful_Protests", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Violent Demonstration Count", ylab = "Peaceful Protest Count", title = 'Violent and Peaceful Demonstrations')

plot9

# Shapiro-Wilk normality test for peaceful protests
shapiro.test(corr_df$Peaceful_Protests)

# Shapiro-Wilk normality test for violent demonstrations
shapiro.test(corr_df$Riots)
```

We see the correlation calculated above is 0.4840878, which is not above the widely accepted standard of 0.7 or -0.7.  However, given the nature of the events measured, we see that the correlation coefficient is insightful: not every non-violent protest will become violent.  Human actions from both parties and other external influences can either escalate or de-escalate a non-violent protest.

The team scrutinized a subset of the data and looked at individual events and at this point believes that non-violent events and violent demonstrations are not double-counted implying they are IID.  Furthermore, the team believes that both peaceful protests and violent demonstrations are both normal via the Shapiro-Wilk normality test.  As a result, the team believes that incorporating non-violent events may serve as a useful predictor variable.  

From the data above we can see that battles and attacks do occur between Ministry of Interior (MOI) forces and the civilian population.  The late Martin Luther King Jr stated that "violence begets violence."  Research into this topic leads the team to its fourth EDA question: Does violence beget violence?

```{r}
# EDA Question 4: Does violence beget violence?

# Compute the correlation between violence against civilians and violent demonstrations
cor.test(master_df$riot_count, master_df$VAC_count)
```

From the correlation coefficient, we can see there is no discernible relationship between violence against civilians and violent demonstrations on the same day.  However, additional analysis will need to occur to determine whether or not violence against civilians serves has an impact in the coming days as news of an attack would spread amongst the population and incite emotional responses.

# EDA: Part 2

```{r}
# Determine elementary statistical values of the column violent demonstrations
mean_of_df <- mean(master_df$riot_count)
median_of_df <- median(master_df$riot_count)
var_of_df <- var(master_df$riot_count)
sd_of_df <- sqrt(master_df$riot_count)

# Generate a boxplot of violent demonstrations per day
plot12 <- boxplot(riot_count~Numeric_Weekday,data=master_df, main="Riots During the Week", xlab="Weekday", ylab="Count", axes = FALSE); par(las=2); axis(1, at= 1:7, labels= c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday')); axis(2)

plot12

# Generate a boxplot of violent demonstrations per month
plot13 <- boxplot(riot_count~Month,data=master_df, main="Riots per Month", xlab="Month", ylab="Count", axes = FALSE); par(las=2); axis(1, at= 1:11, labels= month.abb[1:11]); axis(2)

plot13

# Generate a boxplot of violent demonstrations during holidays.  1 being yes, it is a holiday.
plot14 <- boxplot(riot_count~Holiday,data=master_df, main="Riots on Holidays", xlab="Holiday?", ylab="Count", axes = FALSE); par(las=2); axis(1, at= 1:2, labels=c("No", "Yes")); axis(2)
plot14

# Plots temperature versus protests
plot15 <- master_df %>%
  ggplot( aes(x=TEMP, y=riot_count)) +
    geom_area(fill="#69b3a2", alpha=0.5) +
    geom_line(color="#69b3a2") +
    labs(title='Bahrain Riots (01-JAN-16 to 31-DEC-19)', x='TEMP', y='Count')

ggplotly(plot15, tooltip=c('y', 'x', 'event_type')) 
```

Based upon the plots above, we notice several trends.  Holidays and days of the week tend to not have an effect on the number of riots.  From the monthly box plot we can see a downward trend from the beginning of the year to the end.  Upon inspection of the temperature data, there are more naturally more riots when the temperature is more suitable for action but the plot appears to be uniform in nature.

Once our exploratory data analysis is complete, we begin model formulation.  Initially, the team utilizes Reg Subsets to determine the optimal variable selection for predicting 'riot_count.'  However, the formulations below assume that the daily data is independent, which is often a poor assumption.

# Non-Time Series Models

## 1. Reg Subsets

```{r}
# id: model id
# object: regsubsets object
# data: data used to fit regsubsets
# outcome: outcome variable
get_model_formula <- function(id, object, outcome){
  # get models data
  models <- summary(object)$which[id,-1]
  # Get outcome variable
  form <- as.formula(object$call[[2]])
  outcome <- all.vars(form)[1]
  # Get model predictors
  predictors <- names(which(models == TRUE))
}
```

```{r}
# Remove event_date to simplify 
master_df$event_date <- NULL

# Determine which coefficients produce the most accurate model
regfit.backward.full <- regsubsets(riot_count ~ . -(Armed_clash_count + Armed_clash_fatalities + battle_count + battle_fatalities + SAMA_count + SAMA_fatalities + RELIED_count + RELIED_fatalities + Grenade_count + Grenade_fatalities + explosion_count + explosions_fatalities + Sexual_violence_count + sexual_violence_fatalities + Attack_count + Attack_fatalities + VAC_count + VAC_fatalities + EFAP_count + EFAP_fatalities + PWI_count + PWI_fatalities + Peaceful_protest_count + Peaceful_protest_fatalities + protest_count + protest_fatalities + mob_violence_count + mob_violence_fatalities + violent_demonstration_count + violent_demonstration_fatalities + riot_fatalities), data = master_df, nvmax = 100, really.big =  TRUE, method = 'backward')

# Produce a summary of the full model
res.backward.sum <- summary(regfit.backward.full)

# Determine which model has the highest R-squared
backward.adjr2 <- which.max(res.backward.sum$adjr2)

# Determine which model has the lowest Mallow's CP
backward.cp <- which.min(res.backward.sum$cp)

# Determine which model has the lowest BIC
backward.bic <- which.min(res.backward.sum$bic)
```

```{r, echo = FALSE}
print(paste("The backwards model with the highest R-squared is", backward.adjr2,"with a value of", round(max(res.backward.sum$adjr2),4)))

print(paste("The backwards model with the lowest Mallow's CP is", backward.cp, "with a value of", round(min(res.backward.sum$cp),4)))

print(paste("The backwards model with the lowest BIC is", backward.bic , "with a value of", round(min(res.backward.sum$bic),4)))
```

```{r}
## Backwards model

# Determines which features we should select according to our three measures of effectiveness: R-squared, Mallow's CP, and BIC
get_model_formula(backward.adjr2, regfit.backward.full, "riot_count")
get_model_formula(backward.cp, regfit.backward.full, "riot_count")
get_model_formula(backward.bic, regfit.backward.full, "riot_count")
```

```{r}
# Determine which coefficients produce the most accurate model
regfit.forward.full <- regsubsets(riot_count ~ . -(Armed_clash_count + Armed_clash_fatalities + battle_count + battle_fatalities + SAMA_count + SAMA_fatalities + RELIED_count + RELIED_fatalities + Grenade_count + Grenade_fatalities + explosion_count + explosions_fatalities + Sexual_violence_count + sexual_violence_fatalities + Attack_count + Attack_fatalities + VAC_count + VAC_fatalities + EFAP_count + EFAP_fatalities + PWI_count + PWI_fatalities + Peaceful_protest_count + Peaceful_protest_fatalities + protest_count + protest_fatalities + mob_violence_count + mob_violence_fatalities + violent_demonstration_count + violent_demonstration_fatalities + riot_fatalities), data = master_df, nvmax = 100, really.big =  TRUE, method = 'forward')

# Produce a summary of the full model
res.forward.sum <- summary(regfit.forward.full)

# Determine which model has the highest R-squared
forward.adjr2 <- which.max(res.forward.sum$adjr2)

# Determine which model has the lowest Mallow's CP
forward.cp <- which.min(res.forward.sum$cp)

# Determine which model has the lowest BIC
forward.bic <- which.min(res.forward.sum$bic)
```

```{r, echo = FALSE}
print(paste("The forwards model with the highest R-squared is", forward.adjr2,"with a value of", round(max(res.forward.sum$adjr2),4)))

print(paste("The forwards model with the lowest Mallow's CP is", forward.cp, "with a value of", round(min(res.forward.sum$cp),4)))

print(paste("The forwards model with the lowest BIC is", forward.bic , "with a value of", round(min(res.forward.sum$bic),4)))
```

```{r}
## Forwards model

# Determines which features we should select according to our three measures of effectiveness: R-squared, Mallow's CP, and BIC
get_model_formula(forward.adjr2, regfit.forward.full, "riot_count")
get_model_formula(forward.cp, regfit.forward.full, "riot_count")
get_model_formula(forward.bic, regfit.forward.full, "riot_count")
```

Utilizing the Reg Subsets, we are able to see that assess our three measures of effectiveness for both forward and backwards models: R-squared, Mallow's CP, and BIC.  Despite their relatively undesired performance measures, these models provide coefficients that serve as a starting point for model formulation.

AdaBoost is an ensemble methods for classification.  We will use AdaBoost with riot count as the target variable and our coefficients as determined by the backward.adjr2 model from Reg Subsets.

## 2. ADABOOST

```{r}
# Set riot_count as categorical for processing
master_df$riot_count <- as.factor(master_df$riot_count)

# Formulate the model using backward.adjr2 from Reg Subsets
cvmodel = boosting.cv(riot_count ~ al_wafa_Total_Posts + al_wafa_Favorites + Alwatan_Live_Retweets + 
    bahrain_moi_Favorites + bahrain_moi_Retweets + bh14feb2011_Retweets + 
    bna_ar_Total_Posts + bna_ar_Favorites + Coalition14_Total_Posts + 
    Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Favorites + 
    duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites + 
    feb14revolution_Retweets + Iran_Total_Posts + Iran_Favorites + 
    Iran_Retweets + khalidalkhalifa_Total_Posts + NABEELRAJAB_Favorites + 
    NABEELRAJAB_Retweets + trump_Total_Posts + USEmbassyManama_Favorites + 
    Holiday + Week_Number + TEMP + DEWP + zinc_Close + zinc_Open + 
    WTI_Close + wheat_Open + wheat_Low + tin_Open + tin_High + 
    tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + 
    soybean_Close + soybean_Low + silver_Close + silver_Low + 
    rice_Open + nickel_Open + nickel_Low + natural_gas_Low + 
    monero_Close + monero_High + monero_Low + litecoin_Close + 
    litecoin_Low + lead_Open + lead_Low + Iron_USA_Open + Iron_USA_Low + 
    Gold_Open + Gold_High + corn_Close + corn_Open + corn_High + 
    corn_Low + copper_Open + copper_High + coffee_Open + live_cattle_Close + 
    live_cattle_Low + feed_cattle_Close + feed_cattle_Open + 
    feed_cattle_High + Brent_Close + Brent_Low + Bitcoin_Close + 
    Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + 
    BHD_EUR_Open + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + 
    BAX_Low + JD + Numeric_Weekday + Binary_Weekday, data = master_df, boos = TRUE, v = 10)

print(cvmodel[-1])
```

```{r, echo = FALSE}
# Produce a side-by-side comparison of the original dataframe and the predicted value
data.frame(master_df$riot_count, cvmodel$class)
```

Create a testing and training split for master_df

```{r}
# Re-read in the dataframe 
master_df <- read.csv('master_df.csv')

# Delete the event_date column from the dataframe
master_df$event_date <- NULL

# Code sourced from Dr Bassett's Lecture5_MLR.R

# Splits the data into a 80% training and 20% testing bins
#train_inds <- sample(nrow(master_df), .8*nrow(master_df))

# Splits the data into a simulation of a time series dataset
train <- master_df[1:1454, c(1:187, 222)]
test <- master_df[1455:1461, c(1:187, 222)]

# Code sourced from Dr Bassett's Lecture5_MLR.R
# Function designed to compute the RMSE of the testing and training data split
train_and_test_error <- function(model){
  train_rmse <- sqrt(mean(resid(model)^2))
  test_rmse <- sqrt(mean((test$total_master_df - predict(model, newdata=test))^2))
  return(data.frame(train_rmse=train_rmse, test_rmse=test_rmse))
}
```

In model #3, we create a baseline linear model that we can use to compare our comparison against.

## 3. Baseline model

```{r, warning = FALSE, message = FALSE}
# Creates a baseline model with all of the predictors for comparison
lm_baseline <- lm(riot_count ~ AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low, data = train)

# Calculate RMSE for future comparison of model effectiveness
lm_baseline_training_RMSE <- as.numeric(train_and_test_error(lm_baseline)[1])
lm_baseline_testing_RMSE <- as.numeric(train_and_test_error(lm_baseline)[2])

# Calculates Mean Absolute Deviation (MAD)
lm_baseline_mad <- mad(residuals(lm_baseline))

# Calculates the Residual Sum of Squares (RSS)
lm_baseline_RSS <- RSS(lm_baseline)

# Produces a summary of the lm_baseline model
lm_baseline_rsquared <- summary(lm_baseline)$r.squared
```

```{r, warning = FALSE}
# Initial and Final Models for Stepwise Regression(AIC/BIC criteria)
initial_model <- lm(riot_count ~ 1, data=train) 
final_model <- lm_baseline
```

## 4. Forward Stepwise Regression

```{r}
# Forward Stepwise Regression

# Code sourced from https://stackoverflow.com/questions/22913774/forward-stepwise-regression

# AIC - Forward
# Code sourced from Dr Bassett's Lecture13.R
AIC_forward <- stepAIC(initial_model, scope=list(lower=initial_model, upper=final_model), direction='forward', trace=FALSE)

#BIC - Forward
# Code sourced from Dr Bassett's Lecture13.R
BIC_forward <- stepAIC(initial_model, scope=list(lower=initial_model, upper=final_model), direction='forward', k=log(nrow(master_df)), trace=FALSE)
```

```{r}
# Compute various statistics of the 'Forward' models

# Calculates RMSE
AIC_forward_trainingRMSE <- as.numeric(train_and_test_error(AIC_forward)[1])
AIC_forward_testingRMSE <- as.numeric(train_and_test_error(AIC_forward)[2])

BIC_forward_trainingRMSE <- as.numeric(train_and_test_error(BIC_forward)[1])
BIC_forward_testingRMSE <- as.numeric(train_and_test_error(BIC_forward)[2])

# Calculates Mean Absolute Deviation (MAD)
AIC_forward_MAD <- mad(residuals(AIC_forward))
BIC_forward_MAD <- mad(residuals(BIC_forward))

# Stores R^2 values
AIC_forward_rsquared <- summary(AIC_forward)$r.squared
BIC_forward_rsquared <- summary(BIC_forward)$r.squared

#Calculates RSS
AIC_forward_RSS <- RSS(AIC_forward)
BIC_forward_RSS <- RSS(BIC_forward)

# Store AIC/BIC values
AIC_forward_AIC <- extractAIC(AIC_forward)[2]
BIC_forward_BIC <- extractAIC(BIC_forward)[2]

# Plot residuals of the 'Forward' models
plot(AIC_forward, main = "AIC Forward")
plot(BIC_forward, main = "BIC Forward")
```

```{r, echo = FALSE}
print(paste("Forward AIC training RMSE", AIC_forward_trainingRMSE))
print(paste("Forward AIC testing RMSE", AIC_forward_testingRMSE))
print(paste("Forward BIC training RMSE", BIC_forward_trainingRMSE))
print(paste("Forward BIC testing RMSE", BIC_forward_testingRMSE))
print(paste("Forward AIC MAD", AIC_forward_MAD))
print(paste("Forward BIC MAD", BIC_forward_MAD))
print(paste("Forward AIC adjusted R-squared", AIC_forward_rsquared))
print(paste("Forward BIC adjusted R-squared", BIC_forward_rsquared))
print(paste("Forward AIC RSS", AIC_forward_RSS))
print(paste("Forward BIC RSS", BIC_forward_RSS))
print(paste("Forward AIC value", AIC_forward_AIC))
print(paste("Forward BIC value", BIC_forward_BIC))
```
## 5. Backwards Stepwise Regression

```{r}
# Backwards Stepwise Regression

# AIC - Backward
# Code sourced from Lecture13.R
AIC_backward <- stepAIC(final_model, scope=list(lower=initial_model, upper=final_model), direction='backward', trace=FALSE)

#BIC - Backward
# Code sourced from Lecture13.R
BIC_backward <- stepAIC(final_model, scope=list(lower=initial_model, upper=final_model), direction='backward', k=log(nrow(master_df)), trace=FALSE)
```

```{r}
# Compute various statistics of the 'Backward' models

# Calculates RMSE
AIC_backward_trainingRMSE <- as.numeric(train_and_test_error(AIC_backward)[1])
AIC_backward_testingRMSE <- as.numeric(train_and_test_error(AIC_backward)[2])

BIC_backward_trainingRMSE <- as.numeric(train_and_test_error(BIC_backward)[1])
BIC_backward_testingRMSE <- as.numeric(train_and_test_error(BIC_backward)[2])

# Calculates Mean Absolute Deviation (MAD)
AIC_backward_MAD <- mad(residuals(AIC_backward))
BIC_backward_MAD <- mad(residuals(BIC_backward))

# Stores R^2 values
AIC_backward_rsquared <- summary(AIC_backward)$r.squared
BIC_backward_rsquared <- summary(BIC_backward)$r.squared

#Calculates RSS
AIC_backward_RSS <- RSS(AIC_backward)
BIC_backward_RSS <- RSS(BIC_backward)

# Store AIC/BIC values
AIC_backward_AIC <- extractAIC(AIC_backward)[2]
BIC_backward_BIC <- extractAIC(BIC_backward)[2]

# Plot residuals of the 'Backward' models
plot(AIC_backward, main = "AIC Backward")
plot(BIC_backward, main = "BIC Backward")
```

```{r, echo = FALSE}
print(paste("backward AIC training RMSE", AIC_backward_trainingRMSE))
print(paste("backward AIC testing RMSE", AIC_backward_testingRMSE))
print(paste("backward BIC training RMSE", BIC_backward_trainingRMSE))
print(paste("backward BIC testing RMSE", BIC_backward_testingRMSE))
print(paste("backward AIC MAD", AIC_backward_MAD))
print(paste("backward BIC MAD", BIC_backward_MAD))
print(paste("backward AIC adjusted R-squared", AIC_backward_rsquared))
print(paste("backward BIC adjusted R-squared", BIC_backward_rsquared))
print(paste("backward AIC RSS", AIC_backward_RSS))
print(paste("backward BIC RSS", BIC_backward_RSS))
print(paste("backward AIC value", AIC_backward_AIC))
print(paste("backward BIC value", BIC_backward_BIC))
```

## 6. Both Stepwise Regression

```{r}
# Both Stepwise Regression

# Code sourced from https://stackoverflow.com/questions/22913774/forward-stepwise-regression

# AIC - Both
#AIC_both <- stepAIC(initial_model, scope=list(lower=initial_model, upper=final_model), direction='both', trace=FALSE)
AIC_both <- stepAIC(initial_model, scope=list(lower=initial_model, upper=final_model), direction='both', trace=FALSE)

#BIC - Both
BIC_both <- stepAIC(initial_model, scope=list(lower=initial_model, upper=final_model), direction='both', k=log(nrow(master_df)), trace=FALSE)
```

```{r}
# Compute various statistics of the 'both' models

# Calculates RMSE
AIC_both_trainingRMSE <- as.numeric(train_and_test_error(AIC_both)[1])
AIC_both_testingRMSE <- as.numeric(train_and_test_error(AIC_both)[2])

BIC_both_trainingRMSE <- as.numeric(train_and_test_error(BIC_both)[1])
BIC_both_testingRMSE <- as.numeric(train_and_test_error(BIC_both)[2])

# Calculates Mean Absolute Deviation (MAD)
AIC_both_MAD <- mad(residuals(AIC_both))
BIC_both_MAD <- mad(residuals(BIC_both))

# Stores R^2 values
AIC_both_rsquared <- summary(AIC_both)$r.squared
BIC_both_rsquared <- summary(BIC_both)$r.squared

#Calculates RSS
AIC_both_RSS <- RSS(AIC_both)
BIC_both_RSS <- RSS(BIC_both)

# Store AIC/BIC values
AIC_both_AIC <- extractAIC(AIC_both)[2]
BIC_both_BIC <- extractAIC(BIC_both)[2]

# Plot residuals
plot(AIC_both, main = "AIC Both")
plot(BIC_both, main = "BIC Both")
```

```{r, echo = FALSE}
print(paste("both AIC training RMSE", AIC_both_trainingRMSE))
print(paste("both AIC testing RMSE", AIC_both_testingRMSE))
print(paste("both BIC training RMSE", BIC_both_trainingRMSE))
print(paste("both BIC testing RMSE", BIC_both_testingRMSE))
print(paste("both AIC MAD", AIC_both_MAD))
print(paste("both BIC MAD", BIC_both_MAD))
print(paste("both AIC adjusted R-squared", AIC_both_rsquared))
print(paste("both BIC adjusted R-squared", BIC_both_rsquared))
print(paste("both AIC RSS", AIC_both_RSS))
print(paste("both BIC RSS", BIC_both_RSS))
print(paste("both AIC value", AIC_both_AIC))
print(paste("both BIC value", BIC_both_BIC))
```

## 7. Elastic Net Models (0.25, 0.5, 0.75)

```{r}
# Compute elastic models of 0.25, 0.5, and 0.75
model_cvglm_25 <- cv.glmnet(x=model.matrix(riot_count ~ (AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low) ,data = master_df), y = master_df$riot_count, nfolds = 10, nlambda = 200, alpha = 0.25)

model_cvglm_50 <- cv.glmnet(x=model.matrix(riot_count ~ (AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low) ,data = master_df), y = master_df$riot_count, nfolds = 10, nlambda = 200, alpha = 0.50)

model_cvglm_75 <- cv.glmnet(x=model.matrix(riot_count ~ (AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low) , data = master_df), y = master_df$riot_count, nfolds = 10, nlambda = 200, alpha = 0.75)

# Calculate R-squared for each model
# Code sourced from: https://stackoverflow.com/questions/50610895/how-to-calculate-r-squared-value-for-lasso-regression-using-glmnet-in-r
model_cvglm_25_rsquared <- model_cvglm_25$glmnet.fit$dev.ratio
model_cvglm_50_rsquared <- model_cvglm_50$glmnet.fit$dev.ratio
model_cvglm_75_rsquared <- model_cvglm_75$glmnet.fit$dev.ratio

# Generate R^2 plots
plot(model_cvglm_25$lambda,model_cvglm_25_rsquared, xlab = 'Lambda', ylab = 'R^2', main = '0.25 Elastic Model R^2')
plot(model_cvglm_50$lambda,model_cvglm_50_rsquared, xlab = 'Lambda', ylab = 'R^2', main = '0.50 Elastic Model R^2')
plot(model_cvglm_75$lambda,model_cvglm_75_rsquared, xlab = 'Lambda', ylab = 'R^2', main = '0.75 Elastic Model R^2')
```

```{r, echo = FALSE}
# Produce the coefficients of the elastic models
coef(model_cvglm_25)
coef(model_cvglm_50)
coef(model_cvglm_75)
```

```{r}
# Analyze model data
model_cvglm_25
model_cvglm_50
model_cvglm_75 

# Generate MSE
model_cvglm_25_mse <- model_cvglm_25$cvm[model_cvglm_25 $lambda == model_cvglm_25 $lambda.min]
model_cvglm_50_mse <- model_cvglm_50$cvm[model_cvglm_50 $lambda == model_cvglm_50 $lambda.min]
model_cvglm_75_mse <- model_cvglm_75$cvm[model_cvglm_75 $lambda == model_cvglm_75 $lambda.min]

# Plot
plot(model_cvglm_25)
plot(model_cvglm_50)
plot(model_cvglm_75)
```

## 8. LASSO Model

```{r}
# Compute a LASSO model
model_lasso <- cv.glmnet(x=model.matrix(riot_count ~ (AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low), data = master_df), y = master_df$riot_count, alpha = 1)

# Calculate R-squared
model_lasso_rsquared <- model_lasso$glmnet.fit$dev.ratio

# Plot r-squared for the LASSO model
plot20 <- plot(model_lasso$lambda,model_lasso_rsquared, xlab = 'Lambda', ylab = 'R^2', main = 'Lasso Model R^2')
```

```{r, echo = FALSE}
# Generate coefficients
coef(model_lasso)
```

```{r}
# Generate MSE
model_lasso_MSE <- model_lasso$cvm[model_lasso$lambda == model_lasso$lambda.min]

# Analyze model data
model_lasso

 # Plot
plot(model_lasso)
title(main = 'LASSO Model', adj = 0, line = -.001)
```

We will now apply Principal Component Analysis (PCA) to reduce the dimensionality.  We then create a new target variable using the loadings and create an AdaBoost model.

## 9. PCA & AdaBoost

```{r}
# Determine dimensions of dataframe
d <- dim(master_df) 

# Set a boundary to capture ACLED data
s <- (d[2]-33):d[2] 

# Create a subset of the data
events <- master_df[, s] 

# Run a summary
summary(events) 

 # Determine dimensions
dim(events)

# Determine which column/predictor numbers we want to analyze
colnames(events)

# We select five events to analyze
new_events <- events[, c(23,25,29,31,33)]

# Applying princomp() function to the dataset.
pca1 <- princomp(scale(new_events))

#
plot(pca1, ylim = c(0,5))

# Determine the 'loadings' i.e. weight of each variable
pca1$loadings

# Scree plot
plot(cumsum(pca1$sdev^2/sum(pca1$sdev^2)))

## Histogram Scree chart 
pca.var <- pca1$sdev^2
pca.var.per <- round(pca.var/sum(pca.var)*100, 1)
barplot(pca.var.per, main="Scree Plot", xlab="Principal Component", ylab="Percent Variation", ylim = c(0,100))

pc <- prcomp(new_events, scale=TRUE)

plot(pc)

plot(cumsum(pc$sdev^2/sum(pc$sdev^2)))

# First four principal components
comp <- data.frame(pc$x[,1:4])
# Plot
plot(comp, pch=16, col=rgb(0,0,0,0.5))

autoplot(pc, data=new_events, colour = 'riot_count')
```

Apply ADABOOST to our new created response variable as identified via PCA

```{r}
# Create a new predictor variable using the ACLED values (peaceful protests, etc) * their respective weights computed from PCA above
master_df$PCA_Value <- round(master_df$Peaceful_protest_count*pca1$loadings[1] + master_df$protest_count*pca1$loadings[2] + master_df$violent_demonstration_count*pca1$loadings[3] + master_df$riot_count*pca1$loadings[4] + as.numeric(master_df$riot_count)*pca1$loadings[5])

# Apply log transformation
master_df$PCA_Value <- log(master_df$PCA_Value +1)

#master_df$riot_count <- round(exp(master_df$riot_count))
master_df$PCA_Value <- as.factor(master_df$riot_count)

cvmodel = boosting.cv(PCA_Value ~ al_wafa_Retweets + al_wafa_Total_Posts + Coalition14_Total_Posts + Coalition14_Favorites + Alwatan_Live_Total_Posts + BahrainRights_Favorites + AJArabic_Total_Posts + AJArabic_Retweets + BBCArabic_Total_Posts + bh14feb2011_Favorites + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Favorites + Peaceful_protest_count + duraz_youth_Favorites + Iran_Favorites + Iran_Retweets + rouhani_Total_Posts, data = master_df, boos = TRUE, v = 10)

print(cvmodel[-1])
```

```{r, echo = FALSE}
data.frame(master_df$PCA_Value, cvmodel$class)
```

Despite these models performance, the team will create and explore time series models to include MARIMA, DYNLM, univariate, and rolling horizon & random forest.

# Time Series Models

## 10. MARIMA

```{r, echo = FALSE}
# Re-read in the dataframe 
master_df <- read.csv('master_df.csv')

# Determine the dimensions of the dataframe
ColNames_df <- as.data.frame(colnames(master_df))

# Determine the dimension of the dataframe
d <- dim(master_df)

# Subset the dataframe
total_violent_events <- master_df[,c(1, 2, 5, 8, 11, 17, 225)]

# Produce a summary of the dataframe
summary(total_violent_events)

# 
Model1 <- define.model(kvar=7, ar=c(1, 1, 1, 1, 1, 1, 1), ma=c(1), reg.var=3)

# Run MARIMA
Marima1 <- marima(ts(total_violent_events[1:900, ]), Model1$ar.pattern, Model1$ma.pattern, penalty=1)

# Identify the starting point
nstart <- 900

# Identify the step
nstep <- 1461 - 900

Forecasts <- arma.forecast(series=ts(total_violent_events), marima=Marima1, nstart=nstart, nstep=nstep )

One.step <- Forecasts$forecasts[, (nstart+1)]
One.step
Predict <- Forecasts$forecasts[7, 901:1461]
Predict
dates<-total_violent_events[901:1461,1]
stdv<-sqrt(Forecasts$pred.var[7, 7, ])
upper.lim=Predict+stdv*1.645
lower.lim=Predict-stdv*1.645
Out<-rbind(dates, Predict, upper.lim, lower.lim)

observations <- total_violent_events[901:1461, 7]
index <- which(observations == 0)
MAPE <- mean(abs(Predict[-index] - observations[-index])/observations[-index])
naive <- total_violent_events[901:1461, 7] - total_violent_events[871:1431, 7]
index2 <- which(naive == 0)
MASE <- mean(abs(Predict[-index2] - observations[-index2])/abs(naive[-index2]))

## Incorporate rolling horizon

FullObs <- ts(total_violent_events)
Training.Series<-list()
Naive.Forecast<-list()
MARIMA.model<-list()
MARIMA.Forecast<-list()
Observed<-list()

Naive.Forecast.Errors<-list()
MARIMA.Forecast.Errors<-list()
Test.Series <- list()

for(i in 901:1461){
  Training.Series[[i]] <- ts(total_violent_events[1:(i-1), ])
  Test.Series[[i]] <- ts(total_violent_events[1:(i+29), ])
  Naive.Forecast[[i]] <- total_violent_events[(i-30):(i-1), 7]
  MARIMA.model[[i]]<-marima(Training.Series[[i]], Model1$ar.pattern, Model1$ma.pattern, penalty=1)
  MARIMA.Forecast[[i]]<-arma.forecast(series=Test.Series[[i]], marima=MARIMA.model[[i]], nstart=(i-1), nstep=30)$forecasts[7, i:(i+29)]
  Observed[[i]] <- total_violent_events[i:(i+29), 7]
  Naive.Forecast.Errors[[i]] <- Observed[[i]] - Naive.Forecast[[i]]
  MARIMA.Forecast.Errors[[i]] <- Observed[[i]] - MARIMA.Forecast[[i]]
  #print(i)  #so we can see progress
}
```

```{r}
MARIMA.1Step.Forecast<-do.call(rbind, MARIMA.Forecast)[,1]
Naive.1Step.Forecast<-do.call(rbind, Naive.Forecast)[,1]
Observed.Table<-do.call(rbind, Observed)
Naive.Error.Table<-do.call(rbind, Naive.Forecast.Errors)
MARIMA.Error.Table<-do.call(rbind, MARIMA.Forecast.Errors)

index <- which(Observed.Table[,1] == 0)
Vector.Observed.Table <- as.vector(Observed.Table[1:532,])
Vector.Naive.Error.Table <- as.vector(Naive.Error.Table[1:532,])
Vector.MARIMA.Error.Table <- as.vector(MARIMA.Error.Table[1:532,])

index2 <- which(Vector.Observed.Table == 0)

Naive.1Step.MAPE<-mean(abs(Naive.Error.Table[-index,1])/Observed.Table[-index,1])
Naive.1Yr.MAPE<-mean(abs(Vector.Naive.Error.Table[-index2])/Vector.Observed.Table[-index2])
MARIMA.1Step.MAPE<-mean(abs(MARIMA.Error.Table[-index,1])/Observed.Table[-index,1])
MARIMA.1Yr.MAPE<-mean(abs(Vector.MARIMA.Error.Table[-index2])/Vector.Observed.Table[-index2])  

MARIMA.1Step.MASE<-mean(abs(MARIMA.Error.Table[-index,1]))/mean(abs(Naive.Error.Table[-index,1]))
MARIMA.1Yr.MASE<-mean(abs(Vector.MARIMA.Error.Table[-index2]))/mean(abs(Vector.Naive.Error.Table[-index2]))

#### Results

Naive.Performance<-cbind(Naive.1Step.MAPE, Naive.1Yr.MAPE, 1, 1)
MARIMA.Performance<-cbind(MARIMA.1Step.MAPE, MARIMA.1Yr.MAPE, MARIMA.1Step.MASE, MARIMA.1Yr.MASE)

# Create the table for display
Performance.Matrix<-rbind(Naive.Performance, MARIMA.Performance)
Performance.Matrix<-signif(Performance.Matrix, 2)
Performance.Matrix<-cbind(c("Naive", "MARIMA"), Performance.Matrix)
Performance.Matrix<-data.frame(Performance.Matrix)
colnames(Performance.Matrix)<-c("Model", "1 Step MAPE", "12 Step MAPE", "1 Step MASE", "12 Step MASE")
Performance.Matrix<-knitr::kable(Performance.Matrix, digits=2) 
Performance.Matrix
```

## 11. DYNLM

```{r}
master_df <- read.csv('master_df.csv')

master_df$event_date <- as.Date(master_df$event_date, format = '%m/%d/%Y')

#master_df$total_violent_events <- round(exp(master_df$total_violent_events)-1)

# Create a dataframe with individual column names
ColNames_df <- as.data.frame(colnames(master_df))

master_df$Holiday <- as.factor(master_df$Holiday)

# Create a time series for each variable in the data frame
for(i in 1:nrow(ColNames_df)){
  assign(paste0(ColNames_df[i, ]), ts(master_df[ColNames_df[i,]], start = c(2016, 1, 1), end = c(2019, 12, 31), frequency = 365))
}

# generate the term spread series
TSpread <- al_wafa_Total_Posts - riot_count

# Estimate both equations using 'dynlm()'
VAR_EQ1 <- dynlm(riot_count ~ L(riot_count, c(1,2,6,22,29,30)) + al_wafa_Total_Posts + AJArabic_Retweets + BBCArabic_Total_Posts +  Coalition14_Total_Posts+ duraz_youth_Total_Posts + NABEELRAJAB_Retweets + 	Brent_High + Brent_High:Iron_USA_Close + rice_Close + L(TSpread,2), start = c(2016, 1, 1), end = c(2019, 12, 31))

VAR_EQ2 <- dynlm(riot_count ~ L(riot_count, c(18,29,45,48,72))  +  al_wafa_Retweets + al_wafa_Total_Posts*Coalition14_Total_Posts + BAX_Close + BAX_Low + AJArabic_Retweets + BBCArabic_Total_Posts + bh14feb2011_Favorites + bna_ar_Favorites + bna_ar_Retweets +  Brent_Close + Brent_Low + Brent_Open + Coalition14_Favorites + coffee_Close + coffee_High + copper_Close + copper_High + duraz_youth_Favorites + feed_cattle_High + feed_cattle_Open +  Gold_Close + Holiday + Iran_Favorites + Iran_Retweets +  L(TSpread, c(1,14, 28, 47)) + Iron_USA_Close + litecoin_Low + litecoin_Open + live_cattle_Close + live_cattle_Low  + monero_Close + monero_High + monero_Open + MXSPD + nickel_Low + nickel_Open + platinum_Close + rice_Close  + rice_Open + rouhani_Total_Posts + soybean_High  +sugar_Close + TEMP + tin_Close + tin_Open +  WDSP + wheat_Low + wheat_Open + WTI_Close + WTI_Low, start = c(2016, 1, 1), end = c(2019, 12, 31))

summary(VAR_EQ2)

plot(VAR_EQ2)

test_df <- data.frame(predict(VAR_EQ2))

names(test_df)[1] <- 'Forecast'
test_df$Actual <- master_df[73:1107,223]

test_df_rmse <- sqrt(mean((test_df$Actual - test_df$Forecast)^2))
```

```{r, echo = FALSE}
print(paste("RMSE of DYNLM is", test_df_rmse))
```

## 12. Univariate Time Series (Week 3 Lab) 

```{r, message = FALSE, error = FALSE, warning = FALSE}
Series.Dates<-as.Date(raw_df$event_date, "%d-%b-%y")
Series.Dates<-data.table(Series.Dates)
Series.By.Day<-Series.Dates[,.N,by=.(mday(Series.Dates),month(Series.Dates),year(Series.Dates))]

######## Reorganize and Reformat Dates 
Series.Daily.Record <-data.frame(paste(rev(Series.By.Day$month), '/',
                             rev(Series.By.Day$mday), '/',
                             rev(Series.By.Day$year)),
                             as.numeric(rev(Series.By.Day$N)))

colnames(Series.Daily.Record)<-c('Date', 'total_violent_events')
Series.Daily.Record$Date<-as.Date(as.character(Series.Daily.Record$Date),  #Convert Text to Date
                                  format="%m / %d /%Y")
tail(Series.Daily.Record)                 #Note the missing dates

Date.Range<-seq(from = as.Date("2016-01-01"), to = as.Date("2019-12-31"), by = 'day')

Date.total_violent_events<-vector(mode="numeric", length=length(Date.Range))
for (i in 1:length(Date.Range)){
  if(Date.Range[i] %in% Series.Daily.Record$Date){
      Date.total_violent_events[i] <- Series.Daily.Record$total_violent_events[Series.Daily.Record$Date == Date.Range[i]]}
  else{Date.total_violent_events[i] <- 0}
}

Daily.Data.Frame <- data.frame(Date.Range, Date.total_violent_events)
tail(Daily.Data.Frame)#Confirm Problem Fixed
```

```{r}
Time<-paste(Daily.Data.Frame$Date.Range)
freq<-Date.total_violent_events
dates<-as.character(Date.Range)
plot.data<-data.frame(dates, freq)
n1 <- rCharts::Highcharts$new()
n1$yAxis(min=list(0),title=list(text='total_violent_events'))
n1$xAxis(categories = plot.data$dates, labels=list(rotation=-45, 
         align='right'), tickInterval=365, title=list(text='Date'))
n1$series(name='total_violent_events',type='column',data = as.list(plot.data$freq), 
          color = 'red')
n1$title(text = 'Daily Bahrain total_violent_events 01JAN16 - 31DEC19')
n1$chart(zoomType='x')  #Allows you to select sub-sections for zoom
n1

#### Get Time Series Components for Seasonal Additive Model
Series.By.Day.TS<-ts(Daily.Data.Frame$Date.total_violent_events, start=c(2016,1,1), freq=7)
seasonal.model<-stl(Series.By.Day.TS, s.window="periodic")
plot(seasonal.model, main = 'Seasonal Decomposition (Bahrain Riots January 2016 - December 2019)')

seasonal.model.trend<-as.vector(seasonal.model$time.series[,2])
seasonal.model.seasons<-seasonal.model$time.series[,1][1:365]
seasonal.fit<-as.vector(seasonal.model.trend+as.vector(seasonal.model$time.series[,1]))
#head(seasonal.model$time.series)

# Remove zeros from dataframe
not.equal.to.zero.Series.By.Day.TS <- Series.By.Day.TS[Series.By.Day.TS != 0]
which.zeros <- which(Series.By.Day.TS == 0)
not.equal.to.zero.seasonal.fit <- seasonal.fit[-which.zeros]

Seasonal.Decomp.MAPE<-mean(abs(not.equal.to.zero.Series.By.Day.TS-not.equal.to.zero.seasonal.fit)/not.equal.to.zero.Series.By.Day.TS)

Seasonal.Decomp.MASE<-mean(abs(not.equal.to.zero.Series.By.Day.TS[366:1242]-not.equal.to.zero.seasonal.fit[366:1242]))/mean(abs(not.equal.to.zero.Series.By.Day.TS[366:1242]-not.equal.to.zero.Series.By.Day.TS[1:877]))
```

```{r}
plot.data<-data.frame(Time, freq, seasonal.model.trend, seasonal.fit)
n3 <- rCharts::Highcharts$new()
n3$title(text="Daily Bahrain Violent Events January 2016 - December 2019")
n3$yAxis(min=list(0),title=list(text='Violent Events'))
n3$xAxis(categories = plot.data$Time, labels=list(rotation=-45, align='right'), tickInterval=24, title=list(text='Date'))
n3$series(name='Violent Event Count',type='column',data = as.list(plot.data$freq), color = 'red')
n3$series(name='Trend Line',type='line',data=as.list(plot.data$seasonal.model.trend), color='black')
n3$series(name='Fit Line',type='line',data=as.list(plot.data$seasonal.fit), color='grey')
n3$chart(zoomType='x')  #Allows you to select sub-sections for zoom
n3
```

```{r, echo = FALSE}
print(paste("The MAPE of the seasonal model is", Seasonal.Decomp.MAPE))
print(paste("The MASE of the seasonal model is", Seasonal.Decomp.MASE))
```

```{r}
seasonal.forecast<-forecast(seasonal.model, method='naive')
plot.ts(seasonal.forecast$mean, ylim=c(0,45), lwd=2,       # Plot forecast
        main='Seasonal Model 2 Week Forecast')              
lines(seasonal.forecast$lower[,1], lwd=2, lty=2)            # 80% PI 
lines(seasonal.forecast$upper[,1], lwd=2, lty=2)            # 80% PI 
lines(seasonal.forecast$lower[,2], lwd=1, lty=2)            # 90% PI
lines(seasonal.forecast$upper[,2], lwd=1, lty=2)            # 90% PI

toJSONArray2 <- function(obj, json = TRUE, names = TRUE, ...){
  value = lapply(1:nrow(obj), function(i) {
    res <- as.list(obj[i, ])
    if (!names) names(res) <- NULL  # remove names (e.g. {x = 1, y = 2} => {1, 2})
    return(res)
  })
  if (json){
    return(toJSON(value, .withNames = F, ...))
  } else {
    names(value) <- NULL;
    return(value)
  }
}
```

```{r}
### Create Series for Forecast Plots By Appending 'NA' data as needed
seasonal.forecast.mean<-c(rep(NA, length=length(Series.By.Day.TS)), seasonal.forecast$mean[1:14])
seasonal.forecast.lower<-c(rep(NA, length=length(Series.By.Day.TS)), seasonal.forecast$lower[1:14,1])
seasonal.forecast.upper<-c(rep(NA, length=length(Series.By.Day.TS)), seasonal.forecast$upper[1:14,1])
```

```{r}
Time.Add1<-paste0("2020-01-0", rep(1:9, each = 1), setp = "") 
Time.Add2<-paste0("2020-01-", rep(10:14, each =1), setp = "")
Time.new<-c(Time, Time.Add1, Time.Add2)                   
freq.new<-c(Daily.Data.Frame$Date.total_violent_events, rep(NA, 14))
seasonal.fit.new<-c(seasonal.fit, rep(NA, 14))

plot.data<-transform(data.frame(Time.new, freq.new, seasonal.fit.new, seasonal.forecast.mean,
              seasonal.forecast.lower, seasonal.forecast.upper))
```

```{r}
n2 <- rCharts::Highcharts$new()
n2$title(text="Daily Bahrain Violent Events January 2016 - December 2019")
n2$yAxis(min=list(0),title=list(text='Bahrain total_violent_events'))
n2$xAxis(categories = plot.data$Time.new, labels=list(rotation=-45, align='right'), tickInterval=365, title=list(text='Date'))
n2$series(
  name = '80% Forecast Interval',
  data = toJSONArray2(plot.data[,c('Time.new', 'seasonal.forecast.lower', 'seasonal.forecast.upper')], names = T, json = F),
  type = 'arearange',
  fillOpacity = 0.8,
  lineWidth = 0,
  color = 'lightgrey',
  zIndex = 0
)
n2$series(name='total_violent_events',type='column',data = as.list(plot.data$freq.new), color = 'red')
n2$series(name='Fit Line',type='line',data=as.list(plot.data$seasonal.fit.new), color='black')
n2$series(name='Forecast',type='line',data=as.list(plot.data$seasonal.forecast.mean), color='grey')
n2$chart(zoomType='x')  #Allows you to select sub-sections for zoom
n2
```

```{r}
HW.forecast <- HoltWinters(Series.By.Day.TS, alpha = TRUE, beta = TRUE, gamma = FALSE)

HW.predict <- predict(HW.forecast, prediction.interval = TRUE)
plot(HW.forecast, HW.predict)
```

```{r}
Training.Series<-list()
Seasonal.model<-list()
Seasonal.Forecast<-list()
Naive.Forecast<-list()
Observed<-list()
Seasonal.Forecast.Errors<-list()
Naive.Forecast.Errors<-list()
for(i in 1447:1461){
  Training.Series[[i]]<-ts(Series.By.Day.TS[1:(i-1)], start=c(2010,1, 1), freq=7)
  Naive.Forecast[[i]]<-as.vector(Series.By.Day.TS[(i-14):(i-1)])  #14 day forecast
  Seasonal.model[[i]]<-stl(Training.Series[[i]], s.window="periodic")
  Seasonal.Forecast[[i]]<-as.vector(forecast(Seasonal.model[[i]], method='naive')$mean)[1:14]
  Observed[[i]]<-as.vector(Series.By.Day.TS[i:(i+13)])
  Naive.Forecast.Errors[[i]]<-Observed[[i]]-Naive.Forecast[[i]] #14 days of error
  Seasonal.Forecast.Errors[[i]]<-Seasonal.Forecast[[i]]-Observed[[i]]
}
```

```{r}
### Seasonal Model Performance Evaluation
Seasonal.Error.Table<-do.call(rbind, Seasonal.Forecast.Errors)
Naive.Error.Table<-do.call(rbind, Naive.Forecast.Errors)
Observed.Table<-do.call(rbind, Observed)
Seasonal.1Step.MAPE<-mean(abs(Seasonal.Error.Table[,1])/Observed.Table[,1])
Seasonal.1Yr.MAPE<-mean(abs(Seasonal.Error.Table[1:2,])/Observed.Table[1:2,])
Seasonal.1Step.MASE<-mean(abs(Seasonal.Error.Table[,1]))/mean(abs(Naive.Error.Table[,1]))
Seasonal.1Yr.MASE<-mean(abs(Seasonal.Error.Table[1:2,]))/mean(abs(Naive.Error.Table[1:2,]))
Seasonal.Decomp.MASE<-mean(abs(Series.By.Day.TS[365:1461]-seasonal.fit[365:1461]))/mean(abs(Series.By.Day.TS[365:1461]-Series.By.Day.TS[1:1097]))
Seasonal.Fitted.Performance<-c(Seasonal.Decomp.MAPE, Seasonal.Decomp.MASE)
Seasonal.Forecast.Performance.1<-c(Seasonal.1Yr.MAPE, Seasonal.1Yr.MASE)
```

```{r, warning = FALSE, message = FALSE}
# One Step Ahead Rolling Horizon Prediction
Training.Series<-list()
Naive.Forecast<-list()
Seasonal.model<-list()
Seasonal.Forecast<-list()
ARIMA.model<-list()
ARIMA.Forecast<-list()
HW.model<-list()
HW.Forecast<-list()
Observed<-list()
Naive.Forecast.Errors<-list()
HW.Forecast.Errors<-list()
ARIMA.Forecast.Errors<-list()
for(i in 1447:1461){    # Need 3 years of observation for setup of seasonal models 
  Training.Series[[i]]<-ts(Series.By.Day.TS[1:(i-1)], start=c(2016,1, 1), freq=7)
  Naive.Forecast[[i]]<-as.vector(Series.By.Day.TS[(i-14):(i-1)])  #14 day forecast
  HW.model[[i]]<-HoltWinters(Training.Series[[i]])
  HW.Forecast[[i]]<-forecast(HW.model[[i]])$mean[1:14]  #14 day error
  Seasonal.model[[i]]<-stl(Training.Series[[i]], s.window="periodic")
  Seasonal.Forecast[[i]]<-as.vector(forecast(Seasonal.model[[i]], method='naive')$mean)[1:14]  
  ARIMA.model[[i]]<-auto.arima(Training.Series[[i]])
  ARIMA.Forecast[[i]]<-forecast(ARIMA.model[[i]])$mean[1:14]  #14 day forecast
  Observed[[i]]<-as.vector(Series.By.Day.TS[i:(i+13)])  #next 14 day observations
  Seasonal.Forecast.Errors[[i]]<-Seasonal.Forecast[[i]]-Observed[[i]]
  Naive.Forecast.Errors[[i]]<-Observed[[i]]-Naive.Forecast[[i]] #14 days of error
  HW.Forecast.Errors[[i]]<-Observed[[i]]-HW.Forecast[[i]]
  ARIMA.Forecast.Errors[[i]]<-Observed[[i]]-ARIMA.Forecast[[i]]
  #print(i)  #so we can see progress
}
ARIMA.1Step.Forecast<-do.call(rbind, ARIMA.Forecast)[,1]
HW.1Step.Forecast<-do.call(rbind, HW.Forecast)[,1]
Seasonal.1Step.Forecast<-do.call(rbind, Seasonal.Forecast)[,1]
Naive.1Step.Forecast<-do.call(rbind, Naive.Forecast)[,1]
```

```{r}
##### HighChart of Forecasting Model 1-Step Ahead Performance
Time<-Time[1447:1461]
freq<-Daily.Data.Frame$Date.total_violent_events[1447:1461]
x<-data.frame(Time, freq,  Seasonal.1Step.Forecast, HW.1Step.Forecast, ARIMA.1Step.Forecast)
n5 <- rCharts::Highcharts$new()
n5$yAxis(min=list(0),title=list(text='Bahrain Violent Events'))
n5$xAxis(categories = x$Time, labels=list(rotation=-45, align='right'), tickInterval=24, title=list(text='Date'))
n5$series(name='Violent Event Count',type='column',data = as.list(x$freq), color = 'red')
n5$series(name='Seasonal',type='line',data=as.list(x$Seasonal.1Step.Forecast), color='grey')
n5$series(name='ARIMA',type='line',data=as.list(x$ARIMA.1Step.Forecast), color='blue')
n5$series(name='Holt-Winters',type='line',data=as.list(x$HW.1Step.Forecast), color='green')
n5$chart(zoomType='x')  #Allows you to select sub-sections for zoom
n5
```

```{r}
### Calculate MAPE Performance for 1 Step and 1 YR Forecasts
Observed.Table<-do.call(rbind, Observed)
Naive.Error.Table<-do.call(rbind, Naive.Forecast.Errors)
HW.Error.Table<-do.call(rbind, HW.Forecast.Errors)
ARIMA.Error.Table<-do.call(rbind, ARIMA.Forecast.Errors)
index <- which(Observed.Table[,1] == 0)
index2 <- which(Observed.Table[1,] == 0)
index3 <- which(Observed.Table[2,] == 0)

Naive.1Step.MAPE<-mean(abs(Naive.Error.Table[-index,1])/Observed.Table[-index,1])
Naive.1Yr.MAPE<-mean(c(abs(Naive.Error.Table[1,-index2])/Observed.Table[1,-index2], abs(Naive.Error.Table[2,-index3])/Observed.Table[2,-index3]))
Seasonal.1Step.MAPE<-mean(abs(Seasonal.Error.Table[-index,1])/Observed.Table[-index,1])
Seasonal.1Yr.MAPE<-mean(c(abs(Seasonal.Error.Table[1,-index2])/Observed.Table[1,-index2], abs(Seasonal.Error.Table[2,-index3])/Observed.Table[2,-index3]))  

HW.1Step.MAPE<-mean(abs(HW.Error.Table[-index,1])/Observed.Table[-index,1])
HW.1Yr.MAPE<-mean(c(abs(HW.Error.Table[1,-index2])/Observed.Table[1,-index2], abs(HW.Error.Table[2,-index3])/Observed.Table[2,-index3]))  
ARIMA.1Step.MAPE<-mean(abs(ARIMA.Error.Table[-index,1])/Observed.Table[-index,1])
ARIMA.1Yr.MAPE<-mean(c(abs(ARIMA.Error.Table[1,-index2])/Observed.Table[1,-index2], abs(ARIMA.Error.Table[2,-index3])/Observed.Table[2,-index3]))

####### Calculate MASE Performance
Seasonal.1Step.MASE<-mean(abs(Seasonal.Error.Table[,1]))/mean(abs(Naive.Error.Table[,1]))
Seasonal.1Yr.MASE<-mean(abs(Seasonal.Error.Table[1:2,]))/mean(abs(Naive.Error.Table[1:2,]))
HW.1Step.MASE<-mean(abs(HW.Error.Table[,1]))/mean(abs(Naive.Error.Table[,1]))
HW.1Yr.MASE<-mean(abs(HW.Error.Table[1:2,]))/mean(abs(Naive.Error.Table[1:2,]))
ARIMA.1Step.MASE<-mean(abs(ARIMA.Error.Table[,1]))/mean(abs(Naive.Error.Table[,1]))
ARIMA.1Yr.MASE<-mean(abs(ARIMA.Error.Table[1:2,]))/mean(abs(Naive.Error.Table[1:2,]))

# Create the table rows
Naive.Performance<-cbind(Naive.1Step.MAPE, Naive.1Yr.MAPE, 1, 1)
Seasonal.Performance<-cbind(Seasonal.1Step.MAPE, Seasonal.1Yr.MAPE, Seasonal.1Step.MASE, Seasonal.1Yr.MASE)
HW.Performance<-cbind(HW.1Step.MAPE, HW.1Yr.MAPE, HW.1Step.MASE, HW.1Yr.MASE)
ARIMA.Performance<-cbind(ARIMA.1Step.MAPE, ARIMA.1Yr.MAPE, ARIMA.1Step.MASE, ARIMA.1Yr.MASE)

# Create the table for display
Performance.Matrix1<-rbind(Naive.Performance, Seasonal.Performance, HW.Performance, ARIMA.Performance)
Performance.Matrix1<-signif(Performance.Matrix1, 2)
Performance.Matrix1<-cbind(c("Naive", "Seasonal Decomposition", "Holt-Winters", "ARIMA"), Performance.Matrix1)
Performance.Matrix1<-data.frame(Performance.Matrix1)
colnames(Performance.Matrix1)<-c("Model", "1 Step MAPE", "12 Step MAPE", "1 Step MASE", "12 Step MASE")
Performance.Matrix1<-knitr::kable(Performance.Matrix1, digits=2) #prints a pretty table
Performance.Matrix1
```

```{r}
# Build and Evaluate an Ensemble Forecast
Seasonal.Forecast.Table<-do.call(rbind, Seasonal.Forecast)
HW.Forecast.Table<-do.call(rbind, HW.Forecast)
ARIMA.Forecast.Table<-do.call(rbind, ARIMA.Forecast)
Ensemble.Forecast.Table<-(Seasonal.Forecast.Table + HW.Forecast.Table + ARIMA.Forecast.Table)/3
Ensemble.1Step.Forecast<-Ensemble.Forecast.Table[,1]
Ensemble.Error.Table<-Observed.Table-Ensemble.Forecast.Table
Ensemble.1Step.MAPE<-mean(abs(Ensemble.Error.Table[-index,1])/Observed.Table[-index,1]) 
Ensemble.1Yr.MAPE<-mean(abs(Ensemble.Error.Table[1,-index2])/Observed.Table[1,-index2]) 
Ensemble.1Step.MASE<-mean(abs(Ensemble.Error.Table[,1]))/mean(abs(Naive.Error.Table[,1]))
Ensemble.1Yr.MASE<-mean(abs(Ensemble.Error.Table[1:2,]))/mean(abs(Naive.Error.Table[1:2,]))

# Building rows of table again
Naive.Performance<-cbind(Naive.1Step.MAPE, Naive.1Yr.MAPE, 1, 1)
Seasonal.Performance<-cbind(Seasonal.1Step.MAPE, Seasonal.1Yr.MAPE, Seasonal.1Step.MASE, Seasonal.1Yr.MASE)
HW.Performance<-cbind(HW.1Step.MAPE, HW.1Yr.MAPE, HW.1Step.MASE, HW.1Yr.MASE)
ARIMA.Performance<-cbind(ARIMA.1Step.MAPE, ARIMA.1Yr.MAPE, ARIMA.1Step.MASE, ARIMA.1Yr.MASE)
Ensemble.Performance<-cbind(Ensemble.1Step.MAPE, Ensemble.1Yr.MAPE, Ensemble.1Step.MASE, Ensemble.1Yr.MASE)

# Building full table again
Performance.Matrix<-rbind(Naive.Performance, Seasonal.Performance, HW.Performance, ARIMA.Performance, Ensemble.Performance)
Performance.Matrix<-signif(Performance.Matrix, 2)
Performance.Matrix<-cbind(c("Naive", "Seasonal Decomposition", "Holt-Winters", "ARIMA", 
                            "Ensemble"), Performance.Matrix)
Performance.Matrix<-data.frame(Performance.Matrix)
colnames(Performance.Matrix)<-c("Model", "1 Step MAPE", "12 Step MAPE", "1 Step MASE", "12 Step MASE")
Performance.Matrix<-knitr::kable(Performance.Matrix, digits=2, caption='Model Performance Comparison')
Performance.Matrix
```

We can see from the performance matrix that the MAPE is above 1 for a model, which would normally be an issue.  However, since we eliminated values that are equal to zero we are not getting an accurate depiction of the prediction power.

```{r}
n5$series(name='Ensemble',type='line',data=as.list(Ensemble.1Step.Forecast), color='black')
n5
```

## 13. Rolling Horizon/Random Forest

```{r, warning=FALSE, message = FALSE}
# Read in the master_df.csv that contains predictors and response
master_df <- read.csv('master_df.csv', header = TRUE)

d <- dim(master_df)

master_df1 <- master_df[,c(1, 5, 26, 29, 47, 68, 223)]

summary(master_df1)
```

```{r}
Series.Dates<-as.Date(master_df1$event_date, "%m/%d/%Y")
first_date <- min(Series.Dates)
last_date <- max(Series.Dates)
first_date
last_date
full_dates <- data.table(
  Series.Dates = seq(first_date, last_date, "1 day")
)

length(Series.Dates)
dim(full_dates)
```

Now we remove the column for dates:
```{r warning = FALSE}
master_df_new <- master_df1[, -1]
summary(master_df_new)
```

### Setting up for a rolling horizon model.

```{r}
### Define s
s <- 1

### Initial train set sample size
i.train.sample <- 700

### One time period
p <- 10

### Define t
t <- i.train.sample + s

### Defining a train set
# Define predictors
## For time t - 1
al_wafa_Total_Posts1 <- master_df_new[1:(t-1), 1]
Coalition14_Total_Posts1 <- master_df_new[1:(t-1), 2]
duraz_youth_Total_Posts1 <- master_df_new[1:(t-1), 3]
khamenei_Total_Posts1 <- master_df_new[1:(t-1), 4]
trump_Total_Posts1 <- master_df_new[1:(t-1), 5]
count1 <- master_df_new[1:(t-1), 6]

## For time t
al_wafa_Total_Posts2 <- master_df_new[2:t, 1]
Coalition14_Total_Posts2 <- master_df_new[2:t, 2]
duraz_youth_Total_Posts2 <- master_df_new[2:t, 3]
khamenei_Total_Posts2 <- master_df_new[2:t, 4]
trump_Total_Posts2 <- master_df_new[2:t, 5]
count2 <- master_df_new[2:t, 6]

# Now define the target
count3 <- master_df_new[(2+s):(t+s), 6]

train <- data.frame(al_wafa_Total_Posts1, Coalition14_Total_Posts1, duraz_youth_Total_Posts1, khamenei_Total_Posts1, trump_Total_Posts1, count1, al_wafa_Total_Posts2, Coalition14_Total_Posts2, duraz_youth_Total_Posts2, khamenei_Total_Posts2, trump_Total_Posts2, count2, count3)
summary(train)

### Defining a test set
# Define predictors
## For time t - 1
al_wafa_Total_Posts1 <- master_df_new[t:(t+p-1), 1]
Coalition14_Total_Posts1 <- master_df_new[t:(t+p-1), 2]
duraz_youth_Total_Posts1 <- master_df_new[t:(t+p-1), 3]
khamenei_Total_Posts1 <- master_df_new[t:(t+p-1), 4]
trump_Total_Posts1 <- master_df_new[t:(t+p-1), 5]
count1 <- master_df_new[t:(t+p-1), 6]

## For time t
al_wafa_Total_Posts2 <- master_df_new[(t+1):(t+p), 1]
Coalition14_Total_Posts2 <- master_df_new[(t+1):(t+p), 2]
duraz_youth_Total_Posts2 <- master_df_new[(t+1):(t+p), 3]
khamenei_Total_Posts2 <- master_df_new[(t+1):(t+p), 4]
trump_Total_Posts2 <- master_df_new[(t+1):(t+p), 5]
count2 <- master_df_new[(t+1):(t+p), 6]

# Now define the target
count3 <- master_df_new[(t+1+s):(t+p+s), 6]

test <- data.frame(al_wafa_Total_Posts1, Coalition14_Total_Posts1, duraz_youth_Total_Posts1, khamenei_Total_Posts1, trump_Total_Posts1, count1, al_wafa_Total_Posts2, Coalition14_Total_Posts2, duraz_youth_Total_Posts2, khamenei_Total_Posts2, trump_Total_Posts2, count2, count3)
summary(test)

## Applying RF

RandomForest <- randomForest(count3 ~ ., data=train, importance = TRUE, ntrees = 500)
predRF <- predict(RandomForest, newdata = test, type = "response")
summary(predRF)
## MSE
mse <- sum((predRF - test$count3)^2)/length(test$count3)
mse
## MAPE
## Finding zero count
index <- which(test$count3 == 0)
## MAPE
mape <- sum(abs(predRF[-index] - test$count3[-index]) / test$count3[-index])/length(test$count3[-index])
```

```{r, echo = FALSE}
print(paste("MASE is", round(mse,4)))
print(paste("MAPE is", round(mape,4)))
```

First, we plot how it did with the train set.  Black line is the truth and red line is the prediction.

```{r}
plot(1:length(train$count3), train$count3, type="l")
lines(1:length(RandomForest$predicted), round(RandomForest$predicted), col = "red")
```

Now we plot how it did with the test set.  Black line is the truth and red line is the prediction.

```{r}
plot(1:length(test$count3), test$count3, type="l")
lines(1:length(predRF), round(predRF), col = "red")
```

### Rolling Holizon Design

We will do the rolling horizon model.

```{r warning = FALSE}
RF.MSE <- list()
RF.MAPE <- list()
RF.MSE[[1]] <- mse
RF.MAPE[[1]] <- mape
k <- 1

for(t in (i.train.sample + s + 1):(d[1]-p-s)){
#for(t in (i.train.sample + s + 1):(i.train.sample + s + 11)){
  k <- k + 1
  ### Defining a train set
  # Define predictors
  ## For time t - 1
  al_wafa_Total_Posts1 <- master_df_new [1:(t-1), 1]
  Coalition14_Total_Posts1 <- master_df_new [1:(t-1), 2]
  duraz_youth_Total_Posts1 <- master_df_new [1:(t-1), 3]
  khamenei_Total_Posts1 <- master_df_new [1:(t-1), 4]
  trump_Total_Posts1 <- master_df_new [1:(t-1), 5]
  riot_count1 <- master_df_new [1:(t-1), 6]

  ## For time t
  al_wafa_Total_Posts2 <- master_df_new [2:t, 1]
  Coalition14_Total_Posts2 <- master_df_new [2:t, 2]
  duraz_youth_Total_Posts2 <- master_df_new [2:t, 3]
  khamenei_Total_Posts2 <- master_df_new [2:t, 4]
  trump_Total_Posts2 <- master_df_new [2:t, 5]
  riot_count2 <- master_df_new [2:t, 6]

  # Now define the target
  riot_count3 <- master_df_new [(2+s):(t+s), 6]

  train <- data.frame(al_wafa_Total_Posts1, Coalition14_Total_Posts1, duraz_youth_Total_Posts1, khamenei_Total_Posts1, trump_Total_Posts1, riot_count1, al_wafa_Total_Posts2, Coalition14_Total_Posts2, duraz_youth_Total_Posts2, khamenei_Total_Posts2, trump_Total_Posts2, riot_count2, riot_count3)
  summary(train)

  ### Defining a test set
  # Define predictors
  ## For time t - 1
  al_wafa_Total_Posts1 <- master_df_new [t:(t+p-1), 1]
  Coalition14_Total_Posts1 <- master_df_new [t:(t+p-1), 2]
  duraz_youth_Total_Posts1 <- master_df_new [t:(t+p-1), 3]
  khamenei_Total_Posts1 <- master_df_new [t:(t+p-1), 4]
  trump_Total_Posts1 <- master_df_new [t:(t+p-1), 5]
  riot_count1 <- master_df_new [t:(t+p-1), 6]

  ## For time t
  al_wafa_Total_Posts2 <- master_df_new [(t+1):(t+p), 1]
  Coalition14_Total_Posts2 <- master_df_new [(t+1):(t+p), 2]
  duraz_youth_Total_Posts2 <- master_df_new [(t+1):(t+p), 3]
  khamenei_Total_Posts2 <- master_df_new [(t+1):(t+p), 4]
  trump_Total_Posts2 <- master_df_new [(t+1):(t+p), 5]
  riot_count2 <- master_df_new [(t+1):(t+p), 6]

  # Now define the target
  riot_count3 <- master_df_new [(t+1+s):(t+p+s), 6]

  test <- data.frame(al_wafa_Total_Posts1, Coalition14_Total_Posts1, duraz_youth_Total_Posts1, khamenei_Total_Posts1, trump_Total_Posts1, riot_count1, al_wafa_Total_Posts2, Coalition14_Total_Posts2, duraz_youth_Total_Posts2, khamenei_Total_Posts2, trump_Total_Posts2, riot_count2, riot_count3)
summary(test)

  ## Applying RF

  RandomForest <- randomForest(riot_count3 ~ ., data=train, importance = TRUE, ntrees = 500)
  predRF <- predict(RandomForest, newdata = test, type = "response")
  summary(predRF)
  ## MSE
  mse <- sum((predRF - test$riot_count3)^2)/length(test$riot_count3)
  mse
  ## MAPE
  ## Finding zero riot_count
  index <- which(test$riot_count3 == 0)
  ## MAPE
  mape <- sum(abs(predRF[-index] - test$riot_count3[-index])/test$riot_count3[-index])/length(test$riot_count3[-index])
  mape
  RF.MSE[[k]] <- mse
  RF.MAPE[[k]] <- mape
}

### Computing the overall MSE and MAPE
RF.MSE.Table <- do.call(rbind, RF.MSE)
RF.MAPE.Table <- do.call(rbind, RF.MAPE)
```

```{r, echo = FALSE}
print(paste("The overal MASE is", round(mean(RF.MSE.Table),4)))
print(paste("The overal MAPE is", round(mean(RF.MAPE.Table, na.rm = TRUE),4)))
```

First, we plot how it did with the train set.  Black line is the truth and red line is the prediction.

```{r}
plot(1:length(train$riot_count3), train$riot_count3, type="l", main = 'Rolling Horizon Bahrain Riots (01JAN16 - 31DEC19)', xlab = 'Date', ylab = 'Count')
lines(1:length(RandomForest$predicted), RandomForest$predicted, col = "red")
legend(900, 29, legend=c("True Count", "Rolling Hoizon/RF Forecast"),
       col=c("black", "red"),  lty=1:1, cex=0.8)
```

Now we plot how it did with the test set.  Black line is the truth and red line is the prediction.

```{r}
plot(1:length(test$riot_count3), test$riot_count3, type="l", main = 'Rolling Horizon Bahrain Riots (Test Set)', xlab = 'Date', ylab = 'Count')
lines(1:length(predRF), round(predRF), col = "red")
legend(1, 2, legend=c("True Count", "Rolling Hoizon/RF Forecast"),
       col=c("black", "red"),  lty=1:1, cex=0.8)
```

## 14 PCA & RegSubsets/Random Forest/Rolling Horizon

The team utilizes a reg Subsets to determine the optimal model with our new PCA value and we will utilize all explanatory variables.

```{r}
# Read in the file
master_df <- read.csv('master_df.csv')

# Determine dimensions of dataframe
d <- dim(master_df) 

# Set a boundary to capture ACLED data
s <- (d[2]-33):d[2] 

# Create a subset of the data
events <- master_df[, s] 

# Run a summary
summary(events) 

 # Determine dimensions
dim(events)

# Determine which column/predictor numbers we want to analyze
colnames(events)

# We select five events to analyze
new_events <- events[, c(23,25,29,31,33)]

# Applying princomp() function to the dataset.
pca1 <- princomp(scale(new_events))

# Determine the 'loadings' i.e. weight of each variable
pca1$loadings

## Histogram Scree chart 
pca.var <- pca1$sdev^2
pca.var.per <- round(pca.var/sum(pca.var)*100, 1)

pc <- prcomp(new_events, scale=TRUE)

# First four principal components
comp <- data.frame(pc$x[,1:4])

# Create a new predictor variable using the ACLED values (peaceful protests, etc) * their respective weights computed from PCA above
master_df$PCA_Value <- round(master_df$Peaceful_protest_count*pca1$loadings[1] + master_df$protest_count*pca1$loadings[2] + master_df$violent_demonstration_count*pca1$loadings[3] + master_df$riot_count*pca1$loadings[4] + as.numeric(master_df$riot_count)*pca1$loadings[5])
```

```{r}
# Determine which coefficients produce the most accurate model
regfit.backward.full <- regsubsets(PCA_Value ~ AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low, data = master_df, nvmax = 500, really.big =  TRUE, method = 'backward')

# Produce a summary of the full model
res.backward.sum <- summary(regfit.backward.full)

# Determine which model has the highest R-squared
backward.adjr2 <- which.max(res.backward.sum$adjr2)

# Determine which model has the lowest Mallow's CP
backward.cp <- which.min(res.backward.sum$cp)

# Determine which model has the lowest BIC
backward.bic <- which.min(res.backward.sum$bic)
```

```{r, echo = FALSE}
print(paste("The backwards model with the highest R-squared is", backward.adjr2,"with a value of", round(max(res.backward.sum$adjr2),4)))

print(paste("The backwards model with the lowest Mallow's CP is", backward.cp, "with a value of", round(min(res.backward.sum$cp),4)))

print(paste("The backwards model with the lowest BIC is", backward.bic , "with a value of", round(min(res.backward.sum$bic),4)))
```

```{r}
## Backwards model

# Determines which features we should select according to our three measures of effectiveness: R-squared, Mallow's CP, and BIC
backward.adjr2.formula <- get_model_formula(backward.adjr2, regfit.backward.full, "PCA_Value")
backward.cp.formula <- get_model_formula(backward.cp, regfit.backward.full, "PCA_Value")
backward.bic.formula <- get_model_formula(backward.bic, regfit.backward.full, "PCA_Value")
```

```{r}
# Determine which coefficients produce the most accurate model
regfit.forward.full <- regsubsets(PCA_Value ~ AJArabic_Total_Posts + AJArabic_Favorites + AJArabic_Retweets + al_wafa_Total_Posts + al_wafa_Favorites + al_wafa_Retweets + Alwatan_Live_Total_Posts  + Alwatan_Live_Favorites +  Alwatan_Live_Retweets + bahrain_moi_Total_Posts + bahrain_moi_Favorites + bahrain_moi_Retweets + BahrainRights_Total_Posts + BahrainRights_Favorites + BahrainRights_Retweets + BBCArabic_Total_Posts  + BBCArabic_Favorites + BBCArabic_Retweets + bh14feb2011_Total_Posts + bh14feb2011_Favorites + bh14feb2011_Retweets + bna_ar_Total_Posts + bna_ar_Favorites + bna_ar_Retweets + Coalition14_Total_Posts + Coalition14_Favorites + Coalition14_Retweets + duraz_youth_Total_Posts + duraz_youth_Favorites + duraz_youth_Retweets + feb14revolution_Total_Posts + feb14revolution_Favorites +    feb14revolution_Retweets + GDNonline_Total_Posts + GDNonline_Favorites + GDNonline_Retweets + Iran_Total_Posts + Iran_Favorites + Iran_Retweets + IranNW_Total_Posts + IranNW_Favorites + IranNW_Retweets  + khalidalkhalifa_Total_Posts + khalidalkhalifa_Favorites + khalidalkhalifa_Retweets + khamenei_Total_Posts  + khamenei_Favorites + khamenei_Retweets + KUhp2222_Total_Posts + KUhp2222_Favorites +  KUhp2222_Retweets + malarab1_Total_Posts + malarab1_Favorites + malarab1_Retweets + NABEELRAJAB_Total_Posts + NABEELRAJAB_Favorites + NABEELRAJAB_Retweets + netanyahu_Total_Posts + netanyahu_Favorites + netanyahu_Retweets + NSA_Bahrain_Total_Posts + NSA_Bahrain_Favorites + NSA_Bahrain_Retweets + rouhani_Total_Posts + rouhani_Favorites + rouhani_Retweets + trump_Total_Posts + trump_Favorites + trump_Retweets + USEmbassyManama_Total_Posts + USEmbassyManama_Favorites + USEmbassyManama_Retweets + TEMP + DEWP + WDSP + MXSPD + PRCP + zinc_Close + zinc_Open + zinc_High + zinc_Low + WTI_Close + WTI_Open + WTI_High + WTI_Low + wheat_Close + wheat_Open + wheat_High + wheat_Low + tin_Close + tin_Open + tin_High + tin_Low + sugar_Close + sugar_Open + sugar_High + sugar_Low + soybean_Close + soybean_Open + soybean_High + soybean_Low + silver_Close + silver_Open + silver_High + silver_Low + rice_Close + rice_Open + rice_High + rice_Low + platinum_Close + platinum_Open + platinum_High + platinum_Low + nickel_Close + nickel_Open + nickel_High + nickel_Low + natural_gas_Close + natural_gas_Open + natural_gas_High + natural_gas_Low + monero_Close + monero_Open + monero_High + monero_Low + litecoin_Close + litecoin_Open + litecoin_High + litecoin_Low + lead_Close + lead_Open + lead_High + lead_Low + Iron_USA_Close + Iron_USA_Open + Iron_USA_High + Iron_USA_Low + Gold_Close + Gold_Open + Gold_High + Gold_Low +GBP_BHD_Close + GBP_BHD_Open+ GBP_BHD_High + GBP_BHD_Low + cotton_Close + cotton_Open + cotton_High + cotton_Low +  corn_Close +  corn_Open + corn_High + corn_Low + copper_Close + copper_Open + copper_High + copper_Low + coffee_Close + coffee_Open + coffee_High + coffee_Low + live_cattle_Close + live_cattle_Open + live_cattle_High + live_cattle_Low + feed_cattle_Close + feed_cattle_Open + feed_cattle_High + feed_cattle_Low + Brent_Close + Brent_Open + Brent_High + Brent_Low + Bitcoin_Close + Bitcoin_Open + Bitcoin_High + Bitcoin_Low + BHD_EUR_Close + BHD_EUR_Open + BHD_EUR_High + BHD_EUR_Low + BAX_Close + BAX_Open + BAX_High + BAX_Low, data = master_df, nvmax = 500, really.big =  TRUE, method = 'forward')

# Produce a summary of the full model
res.forward.sum <- summary(regfit.forward.full)

# Determine which model has the highest R-squared
forward.adjr2 <- which.max(res.forward.sum$adjr2)

# Determine which model has the lowest Mallow's CP
forward.cp <- which.min(res.forward.sum$cp)

# Determine which model has the lowest BIC
forward.bic <- which.min(res.forward.sum$bic)
```

```{r, echo = FALSE}
print(paste("The forwards model with the highest R-squared is", forward.adjr2,"with a value of", round(max(res.forward.sum$adjr2),4)))

print(paste("The forwards model with the lowest Mallow's CP is", forward.cp, "with a value of", round(min(res.forward.sum$cp),4)))

print(paste("The forwards model with the lowest BIC is", forward.bic , "with a value of", round(min(res.forward.sum$bic),4)))
```

```{r}
## Forwards model

# Determines which features we should select according to our three measures of effectiveness: R-squared, Mallow's CP, and BIC
forward.adjr2.formula <- get_model_formula(forward.adjr2, regfit.forward.full, "PCA_Value")
forward.cp.formula <- get_model_formula(forward.cp, regfit.forward.full, "PCA_Value")
forward.bic.formula <- get_model_formula(forward.bic, regfit.forward.full, "PCA_Value")
```

```{r}
# Subset the dataframe
riots_new <- master_df[, c(backward.adjr2.formula, "PCA_Value")]
```

```{r}
# First: 1:(t-1)

i <- 1 # Initialize a counter
while(i <= length(backward.adjr2.formula)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(backward.adjr2.formula[i],"1 <- riots_new[1:(t-1),", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r}
# Second: 2:t

i <- 1 # Initialize a counter
while(i <= length(backward.adjr2.formula)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(backward.adjr2.formula[i],"2 <- riots_new[2:t,", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r}
# Third: First part of training dataframe

i <- 1 # Initialize a counter
while(i <= length(backward.adjr2.formula)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(backward.adjr2.formula[i],"1, "))
  i = i + 1 # Increment a counter
}
```

```{r}
# Fourth: Second part of training dataframe

i <- 1 # Initialize a counter
while(i <= length(backward.adjr2.formula)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(backward.adjr2.formula[i],"2, "))
  i = i + 1 # Increment a counter
}
```

```{r}
# Fifth: t:(t+p-1)

i <- 1 # Initialize a counter
while(i <= length(backward.adjr2.formula)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(backward.adjr2.formula[i],"1 <- riots_new[t:(t+p-1),", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r}
# Sixth: (t+1):(t+p)

i <- 1 # Initialize a counter
while(i <= length(backward.adjr2.formula)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(backward.adjr2.formula[i],"2 <- riots_new[(t+1):(t+p),", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r warning = FALSE}
# Delete test and train dataframes as they were used previously
test <- NULL
train <- NULL

### Define s
s <- 1

### Initial train set sample size
i.train.sample <- 1435

### One time period
p <- 7

### Define t
t <- i.train.sample + s

### Defining a train set
# Define predictors
## For time t - 1
al_wafa_Total_Posts1 <- riots_new[1:(t-1),1] 
bahrain_moi_Total_Posts1 <- riots_new[1:(t-1),2] 
BahrainRights_Favorites1 <- riots_new[1:(t-1),3] 
BahrainRights_Retweets1 <- riots_new[1:(t-1),4] 
BBCArabic_Total_Posts1 <- riots_new[1:(t-1),5] 
BBCArabic_Favorites1 <- riots_new[1:(t-1),6] 
BBCArabic_Retweets1 <- riots_new[1:(t-1),7] 
bh14feb2011_Total_Posts1 <- riots_new[1:(t-1),8] 
bh14feb2011_Favorites1 <- riots_new[1:(t-1),9] 
bh14feb2011_Retweets1 <- riots_new[1:(t-1),10] 
bna_ar_Total_Posts1 <- riots_new[1:(t-1),11] 
bna_ar_Retweets1 <- riots_new[1:(t-1),12] 
Coalition14_Total_Posts1 <- riots_new[1:(t-1),13] 
Coalition14_Favorites1 <- riots_new[1:(t-1),14] 
duraz_youth_Total_Posts1 <- riots_new[1:(t-1),15] 
duraz_youth_Favorites1 <- riots_new[1:(t-1),16] 
duraz_youth_Retweets1 <- riots_new[1:(t-1),17] 
feb14revolution_Retweets1 <- riots_new[1:(t-1),18] 
GDNonline_Total_Posts1 <- riots_new[1:(t-1),19] 
GDNonline_Favorites1 <- riots_new[1:(t-1),20] 
GDNonline_Retweets1 <- riots_new[1:(t-1),21] 
Iran_Total_Posts1 <- riots_new[1:(t-1),22] 
Iran_Favorites1 <- riots_new[1:(t-1),23] 
IranNW_Retweets1 <- riots_new[1:(t-1),24] 
malarab1_Favorites1 <- riots_new[1:(t-1),25] 
NABEELRAJAB_Favorites1 <- riots_new[1:(t-1),26] 
netanyahu_Favorites1 <- riots_new[1:(t-1),27] 
netanyahu_Retweets1 <- riots_new[1:(t-1),28] 
rouhani_Total_Posts1 <- riots_new[1:(t-1),29] 
rouhani_Favorites1 <- riots_new[1:(t-1),30] 
USEmbassyManama_Retweets1 <- riots_new[1:(t-1),31] 
TEMP1 <- riots_new[1:(t-1),32] 
DEWP1 <- riots_new[1:(t-1),33] 
WDSP1 <- riots_new[1:(t-1),34] 
PRCP1 <- riots_new[1:(t-1),35] 
zinc_Open1 <- riots_new[1:(t-1),36] 
zinc_Low1 <- riots_new[1:(t-1),37] 
WTI_Close1 <- riots_new[1:(t-1),38] 
WTI_Low1 <- riots_new[1:(t-1),39] 
wheat_Open1 <- riots_new[1:(t-1),40] 
wheat_High1 <- riots_new[1:(t-1),41] 
wheat_Low1 <- riots_new[1:(t-1),42] 
tin_Close1 <- riots_new[1:(t-1),43] 
tin_High1 <- riots_new[1:(t-1),44] 
tin_Low1 <- riots_new[1:(t-1),45] 
sugar_Close1 <- riots_new[1:(t-1),46] 
sugar_Open1 <- riots_new[1:(t-1),47] 
sugar_Low1 <- riots_new[1:(t-1),48] 
soybean_Close1 <- riots_new[1:(t-1),49] 
soybean_Open1 <- riots_new[1:(t-1),50] 
soybean_High1 <- riots_new[1:(t-1),51] 
soybean_Low1 <- riots_new[1:(t-1),52] 
silver_High1 <- riots_new[1:(t-1),53] 
rice_Close1 <- riots_new[1:(t-1),54] 
rice_High1 <- riots_new[1:(t-1),55] 
platinum_Close1 <- riots_new[1:(t-1),56] 
natural_gas_Close1 <- riots_new[1:(t-1),57] 
monero_Close1 <- riots_new[1:(t-1),58] 
monero_High1 <- riots_new[1:(t-1),59] 
litecoin_Close1 <- riots_new[1:(t-1),60] 
litecoin_Open1 <- riots_new[1:(t-1),61] 
litecoin_Low1 <- riots_new[1:(t-1),62] 
lead_High1 <- riots_new[1:(t-1),63] 
lead_Low1 <- riots_new[1:(t-1),64] 
Gold_Low1 <- riots_new[1:(t-1),65] 
cotton_Low1 <- riots_new[1:(t-1),66] 
corn_High1 <- riots_new[1:(t-1),67] 
corn_Low1 <- riots_new[1:(t-1),68] 
copper_Close1 <- riots_new[1:(t-1),69] 
copper_High1 <- riots_new[1:(t-1),70] 
coffee_Close1 <- riots_new[1:(t-1),71] 
coffee_High1 <- riots_new[1:(t-1),72] 
live_cattle_Close1 <- riots_new[1:(t-1),73] 
live_cattle_High1 <- riots_new[1:(t-1),74] 
live_cattle_Low1 <- riots_new[1:(t-1),75] 
feed_cattle_Close1 <- riots_new[1:(t-1),76] 
feed_cattle_Open1 <- riots_new[1:(t-1),77] 
Brent_Close1 <- riots_new[1:(t-1),78] 
Brent_Open1 <- riots_new[1:(t-1),79] 
Bitcoin_Open1 <- riots_new[1:(t-1),80] 
Bitcoin_Low1 <- riots_new[1:(t-1),81] 
BAX_Open1 <- riots_new[1:(t-1),82] 
BAX_High1 <- riots_new[1:(t-1),83] 
count1 <- riots_new[1:(t-1), 84]

## For time t
al_wafa_Total_Posts2 <- riots_new[2:t,1] 
bahrain_moi_Total_Posts2 <- riots_new[2:t,2] 
BahrainRights_Favorites2 <- riots_new[2:t,3] 
BahrainRights_Retweets2 <- riots_new[2:t,4] 
BBCArabic_Total_Posts2 <- riots_new[2:t,5] 
BBCArabic_Favorites2 <- riots_new[2:t,6] 
BBCArabic_Retweets2 <- riots_new[2:t,7] 
bh14feb2011_Total_Posts2 <- riots_new[2:t,8] 
bh14feb2011_Favorites2 <- riots_new[2:t,9] 
bh14feb2011_Retweets2 <- riots_new[2:t,10] 
bna_ar_Total_Posts2 <- riots_new[2:t,11] 
bna_ar_Retweets2 <- riots_new[2:t,12] 
Coalition14_Total_Posts2 <- riots_new[2:t,13] 
Coalition14_Favorites2 <- riots_new[2:t,14] 
duraz_youth_Total_Posts2 <- riots_new[2:t,15] 
duraz_youth_Favorites2 <- riots_new[2:t,16] 
duraz_youth_Retweets2 <- riots_new[2:t,17] 
feb14revolution_Retweets2 <- riots_new[2:t,18] 
GDNonline_Total_Posts2 <- riots_new[2:t,19] 
GDNonline_Favorites2 <- riots_new[2:t,20] 
GDNonline_Retweets2 <- riots_new[2:t,21] 
Iran_Total_Posts2 <- riots_new[2:t,22] 
Iran_Favorites2 <- riots_new[2:t,23] 
IranNW_Retweets2 <- riots_new[2:t,24] 
malarab1_Favorites2 <- riots_new[2:t,25] 
NABEELRAJAB_Favorites2 <- riots_new[2:t,26] 
netanyahu_Favorites2 <- riots_new[2:t,27] 
netanyahu_Retweets2 <- riots_new[2:t,28] 
rouhani_Total_Posts2 <- riots_new[2:t,29] 
rouhani_Favorites2 <- riots_new[2:t,30] 
USEmbassyManama_Retweets2 <- riots_new[2:t,31] 
TEMP2 <- riots_new[2:t,32] 
DEWP2 <- riots_new[2:t,33] 
WDSP2 <- riots_new[2:t,34] 
PRCP2 <- riots_new[2:t,35] 
zinc_Open2 <- riots_new[2:t,36] 
zinc_Low2 <- riots_new[2:t,37] 
WTI_Close2 <- riots_new[2:t,38] 
WTI_Low2 <- riots_new[2:t,39] 
wheat_Open2 <- riots_new[2:t,40] 
wheat_High2 <- riots_new[2:t,41] 
wheat_Low2 <- riots_new[2:t,42] 
tin_Close2 <- riots_new[2:t,43] 
tin_High2 <- riots_new[2:t,44] 
tin_Low2 <- riots_new[2:t,45] 
sugar_Close2 <- riots_new[2:t,46] 
sugar_Open2 <- riots_new[2:t,47] 
sugar_Low2 <- riots_new[2:t,48] 
soybean_Close2 <- riots_new[2:t,49] 
soybean_Open2 <- riots_new[2:t,50] 
soybean_High2 <- riots_new[2:t,51] 
soybean_Low2 <- riots_new[2:t,52] 
silver_High2 <- riots_new[2:t,53] 
rice_Close2 <- riots_new[2:t,54] 
rice_High2 <- riots_new[2:t,55] 
platinum_Close2 <- riots_new[2:t,56] 
natural_gas_Close2 <- riots_new[2:t,57] 
monero_Close2 <- riots_new[2:t,58] 
monero_High2 <- riots_new[2:t,59] 
litecoin_Close2 <- riots_new[2:t,60] 
litecoin_Open2 <- riots_new[2:t,61] 
litecoin_Low2 <- riots_new[2:t,62] 
lead_High2 <- riots_new[2:t,63] 
lead_Low2 <- riots_new[2:t,64] 
Gold_Low2 <- riots_new[2:t,65] 
cotton_Low2 <- riots_new[2:t,66] 
corn_High2 <- riots_new[2:t,67] 
corn_Low2 <- riots_new[2:t,68] 
copper_Close2 <- riots_new[2:t,69] 
copper_High2 <- riots_new[2:t,70] 
coffee_Close2 <- riots_new[2:t,71] 
coffee_High2 <- riots_new[2:t,72] 
live_cattle_Close2 <- riots_new[2:t,73] 
live_cattle_High2 <- riots_new[2:t,74] 
live_cattle_Low2 <- riots_new[2:t,75] 
feed_cattle_Close2 <- riots_new[2:t,76] 
feed_cattle_Open2 <- riots_new[2:t,77] 
Brent_Close2 <- riots_new[2:t,78] 
Brent_Open2 <- riots_new[2:t,79] 
Bitcoin_Open2 <- riots_new[2:t,80] 
Bitcoin_Low2 <- riots_new[2:t,81] 
BAX_Open2 <- riots_new[2:t,82] 
BAX_High2 <- riots_new[2:t,83] 
count2 <- riots_new[2:t, 84]

# Now define the target
count3 <- riots_new[(2+s):(t+s), 84]

train <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, count1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, count2, count3)

#summary(train)

### Defining a test set
# Define predictors
## For time t - 1
al_wafa_Total_Posts1 <- riots_new[t:(t+p-1),1] 
bahrain_moi_Total_Posts1 <- riots_new[t:(t+p-1),2] 
BahrainRights_Favorites1 <- riots_new[t:(t+p-1),3] 
BahrainRights_Retweets1 <- riots_new[t:(t+p-1),4] 
BBCArabic_Total_Posts1 <- riots_new[t:(t+p-1),5] 
BBCArabic_Favorites1 <- riots_new[t:(t+p-1),6] 
BBCArabic_Retweets1 <- riots_new[t:(t+p-1),7] 
bh14feb2011_Total_Posts1 <- riots_new[t:(t+p-1),8] 
bh14feb2011_Favorites1 <- riots_new[t:(t+p-1),9] 
bh14feb2011_Retweets1 <- riots_new[t:(t+p-1),10] 
bna_ar_Total_Posts1 <- riots_new[t:(t+p-1),11] 
bna_ar_Retweets1 <- riots_new[t:(t+p-1),12] 
Coalition14_Total_Posts1 <- riots_new[t:(t+p-1),13] 
Coalition14_Favorites1 <- riots_new[t:(t+p-1),14] 
duraz_youth_Total_Posts1 <- riots_new[t:(t+p-1),15] 
duraz_youth_Favorites1 <- riots_new[t:(t+p-1),16] 
duraz_youth_Retweets1 <- riots_new[t:(t+p-1),17] 
feb14revolution_Retweets1 <- riots_new[t:(t+p-1),18] 
GDNonline_Total_Posts1 <- riots_new[t:(t+p-1),19] 
GDNonline_Favorites1 <- riots_new[t:(t+p-1),20] 
GDNonline_Retweets1 <- riots_new[t:(t+p-1),21] 
Iran_Total_Posts1 <- riots_new[t:(t+p-1),22] 
Iran_Favorites1 <- riots_new[t:(t+p-1),23] 
IranNW_Retweets1 <- riots_new[t:(t+p-1),24] 
malarab1_Favorites1 <- riots_new[t:(t+p-1),25] 
NABEELRAJAB_Favorites1 <- riots_new[t:(t+p-1),26] 
netanyahu_Favorites1 <- riots_new[t:(t+p-1),27] 
netanyahu_Retweets1 <- riots_new[t:(t+p-1),28] 
rouhani_Total_Posts1 <- riots_new[t:(t+p-1),29] 
rouhani_Favorites1 <- riots_new[t:(t+p-1),30] 
USEmbassyManama_Retweets1 <- riots_new[t:(t+p-1),31] 
TEMP1 <- riots_new[t:(t+p-1),32] 
DEWP1 <- riots_new[t:(t+p-1),33] 
WDSP1 <- riots_new[t:(t+p-1),34] 
PRCP1 <- riots_new[t:(t+p-1),35] 
zinc_Open1 <- riots_new[t:(t+p-1),36] 
zinc_Low1 <- riots_new[t:(t+p-1),37] 
WTI_Close1 <- riots_new[t:(t+p-1),38] 
WTI_Low1 <- riots_new[t:(t+p-1),39] 
wheat_Open1 <- riots_new[t:(t+p-1),40] 
wheat_High1 <- riots_new[t:(t+p-1),41] 
wheat_Low1 <- riots_new[t:(t+p-1),42] 
tin_Close1 <- riots_new[t:(t+p-1),43] 
tin_High1 <- riots_new[t:(t+p-1),44] 
tin_Low1 <- riots_new[t:(t+p-1),45] 
sugar_Close1 <- riots_new[t:(t+p-1),46] 
sugar_Open1 <- riots_new[t:(t+p-1),47] 
sugar_Low1 <- riots_new[t:(t+p-1),48] 
soybean_Close1 <- riots_new[t:(t+p-1),49] 
soybean_Open1 <- riots_new[t:(t+p-1),50] 
soybean_High1 <- riots_new[t:(t+p-1),51] 
soybean_Low1 <- riots_new[t:(t+p-1),52] 
silver_High1 <- riots_new[t:(t+p-1),53] 
rice_Close1 <- riots_new[t:(t+p-1),54] 
rice_High1 <- riots_new[t:(t+p-1),55] 
platinum_Close1 <- riots_new[t:(t+p-1),56] 
natural_gas_Close1 <- riots_new[t:(t+p-1),57] 
monero_Close1 <- riots_new[t:(t+p-1),58] 
monero_High1 <- riots_new[t:(t+p-1),59] 
litecoin_Close1 <- riots_new[t:(t+p-1),60] 
litecoin_Open1 <- riots_new[t:(t+p-1),61] 
litecoin_Low1 <- riots_new[t:(t+p-1),62] 
lead_High1 <- riots_new[t:(t+p-1),63] 
lead_Low1 <- riots_new[t:(t+p-1),64] 
Gold_Low1 <- riots_new[t:(t+p-1),65] 
cotton_Low1 <- riots_new[t:(t+p-1),66] 
corn_High1 <- riots_new[t:(t+p-1),67] 
corn_Low1 <- riots_new[t:(t+p-1),68] 
copper_Close1 <- riots_new[t:(t+p-1),69] 
copper_High1 <- riots_new[t:(t+p-1),70] 
coffee_Close1 <- riots_new[t:(t+p-1),71] 
coffee_High1 <- riots_new[t:(t+p-1),72] 
live_cattle_Close1 <- riots_new[t:(t+p-1),73] 
live_cattle_High1 <- riots_new[t:(t+p-1),74] 
live_cattle_Low1 <- riots_new[t:(t+p-1),75] 
feed_cattle_Close1 <- riots_new[t:(t+p-1),76] 
feed_cattle_Open1 <- riots_new[t:(t+p-1),77] 
Brent_Close1 <- riots_new[t:(t+p-1),78] 
Brent_Open1 <- riots_new[t:(t+p-1),79] 
Bitcoin_Open1 <- riots_new[t:(t+p-1),80] 
Bitcoin_Low1 <- riots_new[t:(t+p-1),81] 
BAX_Open1 <- riots_new[t:(t+p-1),82] 
BAX_High1 <- riots_new[t:(t+p-1),83] 
count1 <- riots_new[t:(t+p-1), 84]

## For time t
al_wafa_Total_Posts2 <- riots_new[(t+1):(t+p),1] 
bahrain_moi_Total_Posts2 <- riots_new[(t+1):(t+p),2] 
BahrainRights_Favorites2 <- riots_new[(t+1):(t+p),3] 
BahrainRights_Retweets2 <- riots_new[(t+1):(t+p),4] 
BBCArabic_Total_Posts2 <- riots_new[(t+1):(t+p),5] 
BBCArabic_Favorites2 <- riots_new[(t+1):(t+p),6] 
BBCArabic_Retweets2 <- riots_new[(t+1):(t+p),7] 
bh14feb2011_Total_Posts2 <- riots_new[(t+1):(t+p),8] 
bh14feb2011_Favorites2 <- riots_new[(t+1):(t+p),9] 
bh14feb2011_Retweets2 <- riots_new[(t+1):(t+p),10] 
bna_ar_Total_Posts2 <- riots_new[(t+1):(t+p),11] 
bna_ar_Retweets2 <- riots_new[(t+1):(t+p),12] 
Coalition14_Total_Posts2 <- riots_new[(t+1):(t+p),13] 
Coalition14_Favorites2 <- riots_new[(t+1):(t+p),14] 
duraz_youth_Total_Posts2 <- riots_new[(t+1):(t+p),15] 
duraz_youth_Favorites2 <- riots_new[(t+1):(t+p),16] 
duraz_youth_Retweets2 <- riots_new[(t+1):(t+p),17] 
feb14revolution_Retweets2 <- riots_new[(t+1):(t+p),18] 
GDNonline_Total_Posts2 <- riots_new[(t+1):(t+p),19] 
GDNonline_Favorites2 <- riots_new[(t+1):(t+p),20] 
GDNonline_Retweets2 <- riots_new[(t+1):(t+p),21] 
Iran_Total_Posts2 <- riots_new[(t+1):(t+p),22] 
Iran_Favorites2 <- riots_new[(t+1):(t+p),23] 
IranNW_Retweets2 <- riots_new[(t+1):(t+p),24] 
malarab1_Favorites2 <- riots_new[(t+1):(t+p),25] 
NABEELRAJAB_Favorites2 <- riots_new[(t+1):(t+p),26] 
netanyahu_Favorites2 <- riots_new[(t+1):(t+p),27] 
netanyahu_Retweets2 <- riots_new[(t+1):(t+p),28] 
rouhani_Total_Posts2 <- riots_new[(t+1):(t+p),29] 
rouhani_Favorites2 <- riots_new[(t+1):(t+p),30] 
USEmbassyManama_Retweets2 <- riots_new[(t+1):(t+p),31] 
TEMP2 <- riots_new[(t+1):(t+p),32] 
DEWP2 <- riots_new[(t+1):(t+p),33] 
WDSP2 <- riots_new[(t+1):(t+p),34] 
PRCP2 <- riots_new[(t+1):(t+p),35] 
zinc_Open2 <- riots_new[(t+1):(t+p),36] 
zinc_Low2 <- riots_new[(t+1):(t+p),37] 
WTI_Close2 <- riots_new[(t+1):(t+p),38] 
WTI_Low2 <- riots_new[(t+1):(t+p),39] 
wheat_Open2 <- riots_new[(t+1):(t+p),40] 
wheat_High2 <- riots_new[(t+1):(t+p),41] 
wheat_Low2 <- riots_new[(t+1):(t+p),42] 
tin_Close2 <- riots_new[(t+1):(t+p),43] 
tin_High2 <- riots_new[(t+1):(t+p),44] 
tin_Low2 <- riots_new[(t+1):(t+p),45] 
sugar_Close2 <- riots_new[(t+1):(t+p),46] 
sugar_Open2 <- riots_new[(t+1):(t+p),47] 
sugar_Low2 <- riots_new[(t+1):(t+p),48] 
soybean_Close2 <- riots_new[(t+1):(t+p),49] 
soybean_Open2 <- riots_new[(t+1):(t+p),50] 
soybean_High2 <- riots_new[(t+1):(t+p),51] 
soybean_Low2 <- riots_new[(t+1):(t+p),52] 
silver_High2 <- riots_new[(t+1):(t+p),53] 
rice_Close2 <- riots_new[(t+1):(t+p),54] 
rice_High2 <- riots_new[(t+1):(t+p),55] 
platinum_Close2 <- riots_new[(t+1):(t+p),56] 
natural_gas_Close2 <- riots_new[(t+1):(t+p),57] 
monero_Close2 <- riots_new[(t+1):(t+p),58] 
monero_High2 <- riots_new[(t+1):(t+p),59] 
litecoin_Close2 <- riots_new[(t+1):(t+p),60] 
litecoin_Open2 <- riots_new[(t+1):(t+p),61] 
litecoin_Low2 <- riots_new[(t+1):(t+p),62] 
lead_High2 <- riots_new[(t+1):(t+p),63] 
lead_Low2 <- riots_new[(t+1):(t+p),64] 
Gold_Low2 <- riots_new[(t+1):(t+p),65] 
cotton_Low2 <- riots_new[(t+1):(t+p),66] 
corn_High2 <- riots_new[(t+1):(t+p),67] 
corn_Low2 <- riots_new[(t+1):(t+p),68] 
copper_Close2 <- riots_new[(t+1):(t+p),69] 
copper_High2 <- riots_new[(t+1):(t+p),70] 
coffee_Close2 <- riots_new[(t+1):(t+p),71] 
coffee_High2 <- riots_new[(t+1):(t+p),72] 
live_cattle_Close2 <- riots_new[(t+1):(t+p),73] 
live_cattle_High2 <- riots_new[(t+1):(t+p),74] 
live_cattle_Low2 <- riots_new[(t+1):(t+p),75] 
feed_cattle_Close2 <- riots_new[(t+1):(t+p),76] 
feed_cattle_Open2 <- riots_new[(t+1):(t+p),77] 
Brent_Close2 <- riots_new[(t+1):(t+p),78] 
Brent_Open2 <- riots_new[(t+1):(t+p),79] 
Bitcoin_Open2 <- riots_new[(t+1):(t+p),80] 
Bitcoin_Low2 <- riots_new[(t+1):(t+p),81] 
BAX_Open2 <- riots_new[(t+1):(t+p),82] 
BAX_High2 <- riots_new[(t+1):(t+p),83]
count2 <- riots_new[(t+1):(t+p), 84]

# Now define the target
count3 <- riots_new[(t+1+s):(t+p+s), 84]

test <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, count1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, count2, count3)

#summary(test)

## Applying RF
RandomForest <- randomForest(count3 ~ ., data=train, importance = TRUE, ntrees = nrow(train))

predRF <- predict(RandomForest, newdata = test, type = "response")
#summary(predRF)

### MSE
mse_PCA <- sum((predRF - test$count3)^2)/length(test$count3)

## MAPE
## Finding zero count
index <- which(test$count3 == 0)
## MAPE
mape_PCA <- sum(abs(predRF[-index] - test$count3[-index])/test$count3[-index])/length(test$count3[-index])
```

```{r, echo = FALSE}
print(paste("MASE for the PCA target variable is", round(mse_PCA,4)))
print(paste("MAPE for the PCA target variable is", round(mape_PCA,4)))
```

First, we plot how it did with the train set.  Black line is the truth and red line is the prediction.
```{r}
plot(1:length(train$count3), train$count3, type="l", main = 'Rolling Horizon Bahrain PCA (01JAN16 - 31DEC19)', xlab = 'Date', ylab = 'Count')
lines(1:length(RandomForest$predicted), RandomForest$predicted, col = "red")
legend(900, 29, legend=c("True Count", "Rolling Hoizon/RF Forecast"),
       col=c("black", "red"),  lty=1:1, cex=0.8)
```

Now we plot how it did with the test set.  Black line is the truth and red line is the prediction.
```{r}
plot(1:length(test$count3), test$count3, type="l", ylim = c(0,3.5), main = 'Rolling Horizon Bahrain PCA (Test Set)', xlab = 'Date', ylab = 'Count')
lines(1:length(predRF), predRF, col = "red")
legend(1, 1, legend=c("True Count", "Rolling Hoizon/RF Forecast"),
       col=c("black", "red"),  lty=1:1, cex=0.8)
```

Rolling Horizon & Random Forest Design (Numerical Data)

```{r warning = FALSE}
RF.Pre <- list()
RF.MSE <- list()
RF.MAPE <- list()
RF.Pre[[1]] <- predRF
RF.MSE[[1]] <- mse_PCA
RF.MAPE[[1]] <- mape_PCA
k <- 1

#for(t in (i.train.sample + s + 1):(d[1]-p-s)){
for(t in (i.train.sample + s + 1):(i.train.sample + s + 11)){
  k <- k + 1
  ### Defining a train set
  # Define predictors
  ## For time t - 1
  al_wafa_Total_Posts1 <- riots_new[1:(t-1),1] 
  bahrain_moi_Total_Posts1 <- riots_new[1:(t-1),2] 
  BahrainRights_Favorites1 <- riots_new[1:(t-1),3] 
  BahrainRights_Retweets1 <- riots_new[1:(t-1),4] 
  BBCArabic_Total_Posts1 <- riots_new[1:(t-1),5] 
  BBCArabic_Favorites1 <- riots_new[1:(t-1),6] 
  BBCArabic_Retweets1 <- riots_new[1:(t-1),7] 
  bh14feb2011_Total_Posts1 <- riots_new[1:(t-1),8] 
  bh14feb2011_Favorites1 <- riots_new[1:(t-1),9] 
  bh14feb2011_Retweets1 <- riots_new[1:(t-1),10] 
  bna_ar_Total_Posts1 <- riots_new[1:(t-1),11] 
  bna_ar_Retweets1 <- riots_new[1:(t-1),12] 
  Coalition14_Total_Posts1 <- riots_new[1:(t-1),13] 
  Coalition14_Favorites1 <- riots_new[1:(t-1),14] 
  duraz_youth_Total_Posts1 <- riots_new[1:(t-1),15] 
  duraz_youth_Favorites1 <- riots_new[1:(t-1),16] 
  duraz_youth_Retweets1 <- riots_new[1:(t-1),17] 
  feb14revolution_Retweets1 <- riots_new[1:(t-1),18] 
  GDNonline_Total_Posts1 <- riots_new[1:(t-1),19] 
  GDNonline_Favorites1 <- riots_new[1:(t-1),20] 
  GDNonline_Retweets1 <- riots_new[1:(t-1),21] 
  Iran_Total_Posts1 <- riots_new[1:(t-1),22] 
  Iran_Favorites1 <- riots_new[1:(t-1),23] 
  IranNW_Retweets1 <- riots_new[1:(t-1),24] 
  malarab1_Favorites1 <- riots_new[1:(t-1),25] 
  NABEELRAJAB_Favorites1 <- riots_new[1:(t-1),26] 
  netanyahu_Favorites1 <- riots_new[1:(t-1),27] 
  netanyahu_Retweets1 <- riots_new[1:(t-1),28] 
  rouhani_Total_Posts1 <- riots_new[1:(t-1),29] 
  rouhani_Favorites1 <- riots_new[1:(t-1),30] 
  USEmbassyManama_Retweets1 <- riots_new[1:(t-1),31] 
  TEMP1 <- riots_new[1:(t-1),32] 
  DEWP1 <- riots_new[1:(t-1),33] 
  WDSP1 <- riots_new[1:(t-1),34] 
  PRCP1 <- riots_new[1:(t-1),35] 
  zinc_Open1 <- riots_new[1:(t-1),36] 
  zinc_Low1 <- riots_new[1:(t-1),37] 
  WTI_Close1 <- riots_new[1:(t-1),38] 
  WTI_Low1 <- riots_new[1:(t-1),39] 
  wheat_Open1 <- riots_new[1:(t-1),40] 
  wheat_High1 <- riots_new[1:(t-1),41] 
  wheat_Low1 <- riots_new[1:(t-1),42] 
  tin_Close1 <- riots_new[1:(t-1),43] 
  tin_High1 <- riots_new[1:(t-1),44] 
  tin_Low1 <- riots_new[1:(t-1),45] 
  sugar_Close1 <- riots_new[1:(t-1),46] 
  sugar_Open1 <- riots_new[1:(t-1),47] 
  sugar_Low1 <- riots_new[1:(t-1),48] 
  soybean_Close1 <- riots_new[1:(t-1),49] 
  soybean_Open1 <- riots_new[1:(t-1),50] 
  soybean_High1 <- riots_new[1:(t-1),51] 
  soybean_Low1 <- riots_new[1:(t-1),52] 
  silver_High1 <- riots_new[1:(t-1),53] 
  rice_Close1 <- riots_new[1:(t-1),54] 
  rice_High1 <- riots_new[1:(t-1),55] 
  platinum_Close1 <- riots_new[1:(t-1),56] 
  natural_gas_Close1 <- riots_new[1:(t-1),57] 
  monero_Close1 <- riots_new[1:(t-1),58] 
  monero_High1 <- riots_new[1:(t-1),59] 
  litecoin_Close1 <- riots_new[1:(t-1),60] 
  litecoin_Open1 <- riots_new[1:(t-1),61] 
  litecoin_Low1 <- riots_new[1:(t-1),62] 
  lead_High1 <- riots_new[1:(t-1),63] 
  lead_Low1 <- riots_new[1:(t-1),64] 
  Gold_Low1 <- riots_new[1:(t-1),65] 
  cotton_Low1 <- riots_new[1:(t-1),66] 
  corn_High1 <- riots_new[1:(t-1),67] 
  corn_Low1 <- riots_new[1:(t-1),68] 
  copper_Close1 <- riots_new[1:(t-1),69] 
  copper_High1 <- riots_new[1:(t-1),70] 
  coffee_Close1 <- riots_new[1:(t-1),71] 
  coffee_High1 <- riots_new[1:(t-1),72] 
  live_cattle_Close1 <- riots_new[1:(t-1),73] 
  live_cattle_High1 <- riots_new[1:(t-1),74] 
  live_cattle_Low1 <- riots_new[1:(t-1),75] 
  feed_cattle_Close1 <- riots_new[1:(t-1),76] 
  feed_cattle_Open1 <- riots_new[1:(t-1),77] 
  Brent_Close1 <- riots_new[1:(t-1),78] 
  Brent_Open1 <- riots_new[1:(t-1),79] 
  Bitcoin_Open1 <- riots_new[1:(t-1),80] 
  Bitcoin_Low1 <- riots_new[1:(t-1),81] 
  BAX_Open1 <- riots_new[1:(t-1),82] 
  BAX_High1 <- riots_new[1:(t-1),83] 
  pca_count1 <- riots_new[1:(t-1), 84]
  
  ## For time t
  al_wafa_Total_Posts2 <- riots_new[2:t,1] 
  bahrain_moi_Total_Posts2 <- riots_new[2:t,2] 
  BahrainRights_Favorites2 <- riots_new[2:t,3] 
  BahrainRights_Retweets2 <- riots_new[2:t,4] 
  BBCArabic_Total_Posts2 <- riots_new[2:t,5] 
  BBCArabic_Favorites2 <- riots_new[2:t,6] 
  BBCArabic_Retweets2 <- riots_new[2:t,7] 
  bh14feb2011_Total_Posts2 <- riots_new[2:t,8] 
  bh14feb2011_Favorites2 <- riots_new[2:t,9] 
  bh14feb2011_Retweets2 <- riots_new[2:t,10] 
  bna_ar_Total_Posts2 <- riots_new[2:t,11] 
  bna_ar_Retweets2 <- riots_new[2:t,12] 
  Coalition14_Total_Posts2 <- riots_new[2:t,13] 
  Coalition14_Favorites2 <- riots_new[2:t,14] 
  duraz_youth_Total_Posts2 <- riots_new[2:t,15] 
  duraz_youth_Favorites2 <- riots_new[2:t,16] 
  duraz_youth_Retweets2 <- riots_new[2:t,17] 
  feb14revolution_Retweets2 <- riots_new[2:t,18] 
  GDNonline_Total_Posts2 <- riots_new[2:t,19] 
  GDNonline_Favorites2 <- riots_new[2:t,20] 
  GDNonline_Retweets2 <- riots_new[2:t,21] 
  Iran_Total_Posts2 <- riots_new[2:t,22] 
  Iran_Favorites2 <- riots_new[2:t,23] 
  IranNW_Retweets2 <- riots_new[2:t,24] 
  malarab1_Favorites2 <- riots_new[2:t,25] 
  NABEELRAJAB_Favorites2 <- riots_new[2:t,26] 
  netanyahu_Favorites2 <- riots_new[2:t,27] 
  netanyahu_Retweets2 <- riots_new[2:t,28] 
  rouhani_Total_Posts2 <- riots_new[2:t,29] 
  rouhani_Favorites2 <- riots_new[2:t,30] 
  USEmbassyManama_Retweets2 <- riots_new[2:t,31] 
  TEMP2 <- riots_new[2:t,32] 
  DEWP2 <- riots_new[2:t,33] 
  WDSP2 <- riots_new[2:t,34] 
  PRCP2 <- riots_new[2:t,35] 
  zinc_Open2 <- riots_new[2:t,36] 
  zinc_Low2 <- riots_new[2:t,37] 
  WTI_Close2 <- riots_new[2:t,38] 
  WTI_Low2 <- riots_new[2:t,39] 
  wheat_Open2 <- riots_new[2:t,40] 
  wheat_High2 <- riots_new[2:t,41] 
  wheat_Low2 <- riots_new[2:t,42] 
  tin_Close2 <- riots_new[2:t,43] 
  tin_High2 <- riots_new[2:t,44] 
  tin_Low2 <- riots_new[2:t,45] 
  sugar_Close2 <- riots_new[2:t,46] 
  sugar_Open2 <- riots_new[2:t,47] 
  sugar_Low2 <- riots_new[2:t,48] 
  soybean_Close2 <- riots_new[2:t,49] 
  soybean_Open2 <- riots_new[2:t,50] 
  soybean_High2 <- riots_new[2:t,51] 
  soybean_Low2 <- riots_new[2:t,52] 
  silver_High2 <- riots_new[2:t,53] 
  rice_Close2 <- riots_new[2:t,54] 
  rice_High2 <- riots_new[2:t,55] 
  platinum_Close2 <- riots_new[2:t,56] 
  natural_gas_Close2 <- riots_new[2:t,57] 
  monero_Close2 <- riots_new[2:t,58] 
  monero_High2 <- riots_new[2:t,59] 
  litecoin_Close2 <- riots_new[2:t,60] 
  litecoin_Open2 <- riots_new[2:t,61] 
  litecoin_Low2 <- riots_new[2:t,62] 
  lead_High2 <- riots_new[2:t,63] 
  lead_Low2 <- riots_new[2:t,64] 
  Gold_Low2 <- riots_new[2:t,65] 
  cotton_Low2 <- riots_new[2:t,66] 
  corn_High2 <- riots_new[2:t,67] 
  corn_Low2 <- riots_new[2:t,68] 
  copper_Close2 <- riots_new[2:t,69] 
  copper_High2 <- riots_new[2:t,70] 
  coffee_Close2 <- riots_new[2:t,71] 
  coffee_High2 <- riots_new[2:t,72] 
  live_cattle_Close2 <- riots_new[2:t,73] 
  live_cattle_High2 <- riots_new[2:t,74] 
  live_cattle_Low2 <- riots_new[2:t,75] 
  feed_cattle_Close2 <- riots_new[2:t,76] 
  feed_cattle_Open2 <- riots_new[2:t,77] 
  Brent_Close2 <- riots_new[2:t,78] 
  Brent_Open2 <- riots_new[2:t,79] 
  Bitcoin_Open2 <- riots_new[2:t,80] 
  Bitcoin_Low2 <- riots_new[2:t,81] 
  BAX_Open2 <- riots_new[2:t,82] 
  BAX_High2 <- riots_new[2:t,83] 
  pca_count2 <- riots_new[2:t, 84]
  
  # Now define the target
  pca_count3 <- riots_new[(2+s):(t+s), 84]
  
  train <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, pca_count1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, pca_count2, pca_count3)
  
  #summary(train)
  
  ### Defining a test set
  # Define predictors
  ## For time t - 1
  al_wafa_Total_Posts1 <- riots_new[t:(t+p-1),1] 
  bahrain_moi_Total_Posts1 <- riots_new[t:(t+p-1),2] 
  BahrainRights_Favorites1 <- riots_new[t:(t+p-1),3] 
  BahrainRights_Retweets1 <- riots_new[t:(t+p-1),4] 
  BBCArabic_Total_Posts1 <- riots_new[t:(t+p-1),5] 
  BBCArabic_Favorites1 <- riots_new[t:(t+p-1),6] 
  BBCArabic_Retweets1 <- riots_new[t:(t+p-1),7] 
  bh14feb2011_Total_Posts1 <- riots_new[t:(t+p-1),8] 
  bh14feb2011_Favorites1 <- riots_new[t:(t+p-1),9] 
  bh14feb2011_Retweets1 <- riots_new[t:(t+p-1),10] 
  bna_ar_Total_Posts1 <- riots_new[t:(t+p-1),11] 
  bna_ar_Retweets1 <- riots_new[t:(t+p-1),12] 
  Coalition14_Total_Posts1 <- riots_new[t:(t+p-1),13] 
  Coalition14_Favorites1 <- riots_new[t:(t+p-1),14] 
  duraz_youth_Total_Posts1 <- riots_new[t:(t+p-1),15] 
  duraz_youth_Favorites1 <- riots_new[t:(t+p-1),16] 
  duraz_youth_Retweets1 <- riots_new[t:(t+p-1),17] 
  feb14revolution_Retweets1 <- riots_new[t:(t+p-1),18] 
  GDNonline_Total_Posts1 <- riots_new[t:(t+p-1),19] 
  GDNonline_Favorites1 <- riots_new[t:(t+p-1),20] 
  GDNonline_Retweets1 <- riots_new[t:(t+p-1),21] 
  Iran_Total_Posts1 <- riots_new[t:(t+p-1),22] 
  Iran_Favorites1 <- riots_new[t:(t+p-1),23] 
  IranNW_Retweets1 <- riots_new[t:(t+p-1),24] 
  malarab1_Favorites1 <- riots_new[t:(t+p-1),25] 
  NABEELRAJAB_Favorites1 <- riots_new[t:(t+p-1),26] 
  netanyahu_Favorites1 <- riots_new[t:(t+p-1),27] 
  netanyahu_Retweets1 <- riots_new[t:(t+p-1),28] 
  rouhani_Total_Posts1 <- riots_new[t:(t+p-1),29] 
  rouhani_Favorites1 <- riots_new[t:(t+p-1),30] 
  USEmbassyManama_Retweets1 <- riots_new[t:(t+p-1),31] 
  TEMP1 <- riots_new[t:(t+p-1),32] 
  DEWP1 <- riots_new[t:(t+p-1),33] 
  WDSP1 <- riots_new[t:(t+p-1),34] 
  PRCP1 <- riots_new[t:(t+p-1),35] 
  zinc_Open1 <- riots_new[t:(t+p-1),36] 
  zinc_Low1 <- riots_new[t:(t+p-1),37] 
  WTI_Close1 <- riots_new[t:(t+p-1),38] 
  WTI_Low1 <- riots_new[t:(t+p-1),39] 
  wheat_Open1 <- riots_new[t:(t+p-1),40] 
  wheat_High1 <- riots_new[t:(t+p-1),41] 
  wheat_Low1 <- riots_new[t:(t+p-1),42] 
  tin_Close1 <- riots_new[t:(t+p-1),43] 
  tin_High1 <- riots_new[t:(t+p-1),44] 
  tin_Low1 <- riots_new[t:(t+p-1),45] 
  sugar_Close1 <- riots_new[t:(t+p-1),46] 
  sugar_Open1 <- riots_new[t:(t+p-1),47] 
  sugar_Low1 <- riots_new[t:(t+p-1),48] 
  soybean_Close1 <- riots_new[t:(t+p-1),49] 
  soybean_Open1 <- riots_new[t:(t+p-1),50] 
  soybean_High1 <- riots_new[t:(t+p-1),51] 
  soybean_Low1 <- riots_new[t:(t+p-1),52] 
  silver_High1 <- riots_new[t:(t+p-1),53] 
  rice_Close1 <- riots_new[t:(t+p-1),54] 
  rice_High1 <- riots_new[t:(t+p-1),55] 
  platinum_Close1 <- riots_new[t:(t+p-1),56] 
  natural_gas_Close1 <- riots_new[t:(t+p-1),57] 
  monero_Close1 <- riots_new[t:(t+p-1),58] 
  monero_High1 <- riots_new[t:(t+p-1),59] 
  litecoin_Close1 <- riots_new[t:(t+p-1),60] 
  litecoin_Open1 <- riots_new[t:(t+p-1),61] 
  litecoin_Low1 <- riots_new[t:(t+p-1),62] 
  lead_High1 <- riots_new[t:(t+p-1),63] 
  lead_Low1 <- riots_new[t:(t+p-1),64] 
  Gold_Low1 <- riots_new[t:(t+p-1),65] 
  cotton_Low1 <- riots_new[t:(t+p-1),66] 
  corn_High1 <- riots_new[t:(t+p-1),67] 
  corn_Low1 <- riots_new[t:(t+p-1),68] 
  copper_Close1 <- riots_new[t:(t+p-1),69] 
  copper_High1 <- riots_new[t:(t+p-1),70] 
  coffee_Close1 <- riots_new[t:(t+p-1),71] 
  coffee_High1 <- riots_new[t:(t+p-1),72] 
  live_cattle_Close1 <- riots_new[t:(t+p-1),73] 
  live_cattle_High1 <- riots_new[t:(t+p-1),74] 
  live_cattle_Low1 <- riots_new[t:(t+p-1),75] 
  feed_cattle_Close1 <- riots_new[t:(t+p-1),76] 
  feed_cattle_Open1 <- riots_new[t:(t+p-1),77] 
  Brent_Close1 <- riots_new[t:(t+p-1),78] 
  Brent_Open1 <- riots_new[t:(t+p-1),79] 
  Bitcoin_Open1 <- riots_new[t:(t+p-1),80] 
  Bitcoin_Low1 <- riots_new[t:(t+p-1),81] 
  BAX_Open1 <- riots_new[t:(t+p-1),82] 
  BAX_High1 <- riots_new[t:(t+p-1),83] 
  pca_count1 <- riots_new[t:(t+p-1), 84]
  
  ## For time t
  al_wafa_Total_Posts2 <- riots_new[(t+1):(t+p),1] 
  bahrain_moi_Total_Posts2 <- riots_new[(t+1):(t+p),2] 
  BahrainRights_Favorites2 <- riots_new[(t+1):(t+p),3] 
  BahrainRights_Retweets2 <- riots_new[(t+1):(t+p),4] 
  BBCArabic_Total_Posts2 <- riots_new[(t+1):(t+p),5] 
  BBCArabic_Favorites2 <- riots_new[(t+1):(t+p),6] 
  BBCArabic_Retweets2 <- riots_new[(t+1):(t+p),7] 
  bh14feb2011_Total_Posts2 <- riots_new[(t+1):(t+p),8] 
  bh14feb2011_Favorites2 <- riots_new[(t+1):(t+p),9] 
  bh14feb2011_Retweets2 <- riots_new[(t+1):(t+p),10] 
  bna_ar_Total_Posts2 <- riots_new[(t+1):(t+p),11] 
  bna_ar_Retweets2 <- riots_new[(t+1):(t+p),12] 
  Coalition14_Total_Posts2 <- riots_new[(t+1):(t+p),13] 
  Coalition14_Favorites2 <- riots_new[(t+1):(t+p),14] 
  duraz_youth_Total_Posts2 <- riots_new[(t+1):(t+p),15] 
  duraz_youth_Favorites2 <- riots_new[(t+1):(t+p),16] 
  duraz_youth_Retweets2 <- riots_new[(t+1):(t+p),17] 
  feb14revolution_Retweets2 <- riots_new[(t+1):(t+p),18] 
  GDNonline_Total_Posts2 <- riots_new[(t+1):(t+p),19] 
  GDNonline_Favorites2 <- riots_new[(t+1):(t+p),20] 
  GDNonline_Retweets2 <- riots_new[(t+1):(t+p),21] 
  Iran_Total_Posts2 <- riots_new[(t+1):(t+p),22] 
  Iran_Favorites2 <- riots_new[(t+1):(t+p),23] 
  IranNW_Retweets2 <- riots_new[(t+1):(t+p),24] 
  malarab1_Favorites2 <- riots_new[(t+1):(t+p),25] 
  NABEELRAJAB_Favorites2 <- riots_new[(t+1):(t+p),26] 
  netanyahu_Favorites2 <- riots_new[(t+1):(t+p),27] 
  netanyahu_Retweets2 <- riots_new[(t+1):(t+p),28] 
  rouhani_Total_Posts2 <- riots_new[(t+1):(t+p),29] 
  rouhani_Favorites2 <- riots_new[(t+1):(t+p),30] 
  USEmbassyManama_Retweets2 <- riots_new[(t+1):(t+p),31] 
  TEMP2 <- riots_new[(t+1):(t+p),32] 
  DEWP2 <- riots_new[(t+1):(t+p),33] 
  WDSP2 <- riots_new[(t+1):(t+p),34] 
  PRCP2 <- riots_new[(t+1):(t+p),35] 
  zinc_Open2 <- riots_new[(t+1):(t+p),36] 
  zinc_Low2 <- riots_new[(t+1):(t+p),37] 
  WTI_Close2 <- riots_new[(t+1):(t+p),38] 
  WTI_Low2 <- riots_new[(t+1):(t+p),39] 
  wheat_Open2 <- riots_new[(t+1):(t+p),40] 
  wheat_High2 <- riots_new[(t+1):(t+p),41] 
  wheat_Low2 <- riots_new[(t+1):(t+p),42] 
  tin_Close2 <- riots_new[(t+1):(t+p),43] 
  tin_High2 <- riots_new[(t+1):(t+p),44] 
  tin_Low2 <- riots_new[(t+1):(t+p),45] 
  sugar_Close2 <- riots_new[(t+1):(t+p),46] 
  sugar_Open2 <- riots_new[(t+1):(t+p),47] 
  sugar_Low2 <- riots_new[(t+1):(t+p),48] 
  soybean_Close2 <- riots_new[(t+1):(t+p),49] 
  soybean_Open2 <- riots_new[(t+1):(t+p),50] 
  soybean_High2 <- riots_new[(t+1):(t+p),51] 
  soybean_Low2 <- riots_new[(t+1):(t+p),52] 
  silver_High2 <- riots_new[(t+1):(t+p),53] 
  rice_Close2 <- riots_new[(t+1):(t+p),54] 
  rice_High2 <- riots_new[(t+1):(t+p),55] 
  platinum_Close2 <- riots_new[(t+1):(t+p),56] 
  natural_gas_Close2 <- riots_new[(t+1):(t+p),57] 
  monero_Close2 <- riots_new[(t+1):(t+p),58] 
  monero_High2 <- riots_new[(t+1):(t+p),59] 
  litecoin_Close2 <- riots_new[(t+1):(t+p),60] 
  litecoin_Open2 <- riots_new[(t+1):(t+p),61] 
  litecoin_Low2 <- riots_new[(t+1):(t+p),62] 
  lead_High2 <- riots_new[(t+1):(t+p),63] 
  lead_Low2 <- riots_new[(t+1):(t+p),64] 
  Gold_Low2 <- riots_new[(t+1):(t+p),65] 
  cotton_Low2 <- riots_new[(t+1):(t+p),66] 
  corn_High2 <- riots_new[(t+1):(t+p),67] 
  corn_Low2 <- riots_new[(t+1):(t+p),68] 
  copper_Close2 <- riots_new[(t+1):(t+p),69] 
  copper_High2 <- riots_new[(t+1):(t+p),70] 
  coffee_Close2 <- riots_new[(t+1):(t+p),71] 
  coffee_High2 <- riots_new[(t+1):(t+p),72] 
  live_cattle_Close2 <- riots_new[(t+1):(t+p),73] 
  live_cattle_High2 <- riots_new[(t+1):(t+p),74] 
  live_cattle_Low2 <- riots_new[(t+1):(t+p),75] 
  feed_cattle_Close2 <- riots_new[(t+1):(t+p),76] 
  feed_cattle_Open2 <- riots_new[(t+1):(t+p),77] 
  Brent_Close2 <- riots_new[(t+1):(t+p),78] 
  Brent_Open2 <- riots_new[(t+1):(t+p),79] 
  Bitcoin_Open2 <- riots_new[(t+1):(t+p),80] 
  Bitcoin_Low2 <- riots_new[(t+1):(t+p),81] 
  BAX_Open2 <- riots_new[(t+1):(t+p),82] 
  BAX_High2 <- riots_new[(t+1):(t+p),83]
  pca_count2 <- riots_new[(t+1):(t+p), 84]
  
  # Now define the target
  pca_count3 <- riots_new[(t+1+s):(t+p+s), 84]
  
  test <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, pca_count1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, pca_count2, pca_count3)
  
  ## Applying RF

  RandomForest <- randomForest(pca_count3 ~ ., data=train, importance = TRUE, ntrees = 500)
  predRF <- predict(RandomForest, newdata = test, type = "response")
  summary(predRF)
  ## MSE
  mse <- sum((predRF - test$pca_count3)^2)/length(test$pca_count3)
  mse
  ## MAPE
  ## Finding zero riot_count
  index <- which(test$pca_count3 == 0)
  ## MAPE
  mape <- sum(abs(predRF[-index] - test$pca_count3[-index])/test$pca_ount3[-index])/length(test$pca_count3[-index])
  mape
  RF.MSE[[k]] <- mse
  RF.MAPE[[k]] <- mape
}

### Computing the overall MSE and MAPE
RF.MSE.Table <- do.call(rbind, RF.MSE)
RF.MAPE.Table <- do.call(rbind, RF.MAPE)
```

The overall MSE and MAPE are:
```{r, echo = FALSE}
print(paste("The overall MASE is", round(mean(RF.MSE.Table),4)))
print(paste("The overall MAPE is", round(mean(RF.MAPE.Table), 4)))
```

First, we plot how it did with the train set.  Black line is the truth and red line is the prediction.
```{r}
plot(1:length(train$pca_count3), round(train$pca_count3), type="l", main = 'Rolling Horizon Bahrain PCA (01JAN16 - 15DEC19)', xlab = 'Date', ylab = 'Count')
lines(1:length(RandomForest$predicted), round(RandomForest$predicted), col = "red")
legend(900, 29, legend=c("True Count", "Rolling Hoizon/RF Forecast"),
       col=c("black", "red"),  lty=1:1, cex=0.8)
```

Now we plot how it did with the test set.  Black line is the truth and red line is the prediction.
```{r}
plot(1:length(test$pca_count3), test$pca_count3, type="l", ylim = c(0,5), main = 'Rolling Horizon Bahrain PCA (Test Set)', xlab = 'Date', ylab = 'Count')
lines(1:length(predRF), predRF, col = "red")
legend(4.5, 1, legend=c("True Count", "Rolling Hoizon/RF Forecast"),
       col=c("black", "red"),  lty=1:1, cex=0.8)
```

Despite the very low MAPE for the PCA model, our model performs poorly when forecasting on either the training set or the test set.

# 15 Random Forest (Categorical Data)

```{r}
# Code sourced from: https://stackoverflow.com/questions/61955696/calculating-true-false-positive-and-true-false-negative-values-from-matrix-in-r

# Creates a dataframe and determines the true positive, true negative, false positive, and false negative statistics of a confusion matrix
multi_class_rates <- function(confusion_matrix) {
    true_positives  <- diag(confusion_matrix)
    false_positives <- colSums(confusion_matrix) - true_positives
    false_negatives <- rowSums(confusion_matrix) - true_positives
    true_negatives  <- sum(confusion_matrix) - true_positives -
        false_positives - false_negatives
    return(data.frame(true_positives, false_positives, true_negatives,
                      false_negatives, row.names = names(true_positives)))
}
```

```{r, message = FALSE, warning = FALSE}
# Read in the file
master_df <- read.csv('master_df.csv')

# Deletes the event date column
master_df$event_date <- NULL
```

```{r}
# Code sourced from: https://stackoverflow.com/questions/40380112/categorize-continuous-variable-with-dplyr
# Establishes categorical boundaries of:
# very low risk: -Infinity (0) to 2
# low risk 3 to 6
# moderate risk 7 to 10
# high risk 11 to 16
# very high risk 17 to Infinity
master_df$category <- as.factor(as.character(cut(master_df$riot_count, breaks=c(-Inf, 1.9, 7.9, Inf), labels=c("Low_risk", "Moderate_risk", "High_risk"))))

# Determine the sum for each category
sum1 <- sum(master_df$category=='Low_risk')
sum2 <- sum(master_df$category=='Moderate_risk')
sum3 <- sum(master_df$category=='High_risk')

# Create a bar plot depicting the categories
xx <- barplot(c(sum1, sum2, sum3), ylim = c(0, 900), ylab = "Numerical Count", xlab = "Category",  col = c('darkgreen', 'lightgreen', 'yellow', 'red', 'darkred'), axes = TRUE, main = "Bar Plot for Categorical Data for Bahrain Riots (2016-2019)", names.arg = c("Low Risk", "Moderate Risk", "High Risk"))

# Code sourced from: https://subscription.packtpub.com/book/big_data_and_business_intelligence/9781783988785/6/ch06lvl1sec69/displaying-values-on-top-of-or-next-to-the-bars
# Create a matrix with the sum of each category
y<-as.matrix(c(sum1, sum2, sum3))

# Create a text block to depict the sum above each column on the bar plot
text(xx,y+50,labels=as.character(y))

# Partition of data set into 80% Train and 20% Test datasets
sampler <- sample(nrow(master_df),trunc(nrow(master_df)*.80))

# Subset the dataframe
riots_new <- master_df[,c(backward.adjr2.formula,"protest_count", "VAC_count", "total_fatalities", "category")]

# Create train and test splits
master_df.Train <- riots_new[sampler,]
master_df.Test <- riots_new[-sampler,]

# Apply random forests model having category target and rest as predictors
RandomForest <- randomForest(category ~ ., data=master_df.Train, importance = TRUE, ntrees = nrow(master_df.Train))

# Get the predicted category
predClassRF <- predict(RandomForest, newdata = master_df.Test, type = "response")

# Report confusion matrix from on the test dataset
confusionMatrix(predClassRF, master_df.Test$category)

# Plot the results of random forest
plot(master_df.Test$category, predClassRF)

# Generate a summary of the Random Forest summary
summary(RandomForest)
```

```{r}
# First: 1:(t-1)

i <- 1 # Initialize a counter
while(i <= length(riots_new)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(colnames(riots_new)[i],"1 <- riots_new[1:(t-1),", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r}
# Second: 2:t

i <- 1 # Initialize a counter
while(i <= length(riots_new)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(colnames(riots_new)[i],"2 <- riots_new[2:t,", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r}
# Third: First part of training dataframe

i <- 1 # Initialize a counter
while(i <= length(riots_new)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(colnames(riots_new)[i],"1, "))
  i = i + 1 # Increment a counter
}
```

```{r}
# Fourth: Second part of training dataframe

i <- 1 # Initialize a counter
while(i <= length(riots_new)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(colnames(riots_new)[i],"2, "))
  i = i + 1 # Increment a counter
}
```

```{r}
# Fifth: t:(t+p-1)

i <- 1 # Initialize a counter
while(i <= length(riots_new)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(colnames(riots_new)[i],"1 <- riots_new[t:(t+p-1),", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

```{r}
# Sixth: (t+1):(t+p)

i <- 1 # Initialize a counter
while(i <= length(riots_new)){ # Iterate over the length of the formula
  # Create print statements that are easily copy and pasted below
  cat(paste0(colnames(riots_new)[i],"2 <- riots_new[(t+1):(t+p),", i, "]"), "\n") 
  i = i + 1 # Increment a counter
}
```

## Rolling Horizon & Random Forest Design (Categorical Data)

```{r warning = FALSE}
### Define s
s <- 1

### Initial train set sample size
i.train.sample <- 700

### One time period
p <- 31

### Define t
t <- i.train.sample + s

### Defining a train set
# Define predictors
## For time t - 1
al_wafa_Total_Posts1 <- riots_new[1:(t-1),1] 
bahrain_moi_Total_Posts1 <- riots_new[1:(t-1),2] 
BahrainRights_Favorites1 <- riots_new[1:(t-1),3] 
BahrainRights_Retweets1 <- riots_new[1:(t-1),4] 
BBCArabic_Total_Posts1 <- riots_new[1:(t-1),5] 
BBCArabic_Favorites1 <- riots_new[1:(t-1),6] 
BBCArabic_Retweets1 <- riots_new[1:(t-1),7] 
bh14feb2011_Total_Posts1 <- riots_new[1:(t-1),8] 
bh14feb2011_Favorites1 <- riots_new[1:(t-1),9] 
bh14feb2011_Retweets1 <- riots_new[1:(t-1),10] 
bna_ar_Total_Posts1 <- riots_new[1:(t-1),11] 
bna_ar_Retweets1 <- riots_new[1:(t-1),12] 
Coalition14_Total_Posts1 <- riots_new[1:(t-1),13] 
Coalition14_Favorites1 <- riots_new[1:(t-1),14] 
duraz_youth_Total_Posts1 <- riots_new[1:(t-1),15] 
duraz_youth_Favorites1 <- riots_new[1:(t-1),16] 
duraz_youth_Retweets1 <- riots_new[1:(t-1),17] 
feb14revolution_Retweets1 <- riots_new[1:(t-1),18] 
GDNonline_Total_Posts1 <- riots_new[1:(t-1),19] 
GDNonline_Favorites1 <- riots_new[1:(t-1),20] 
GDNonline_Retweets1 <- riots_new[1:(t-1),21] 
Iran_Total_Posts1 <- riots_new[1:(t-1),22] 
Iran_Favorites1 <- riots_new[1:(t-1),23] 
IranNW_Retweets1 <- riots_new[1:(t-1),24] 
malarab1_Favorites1 <- riots_new[1:(t-1),25] 
NABEELRAJAB_Favorites1 <- riots_new[1:(t-1),26] 
netanyahu_Favorites1 <- riots_new[1:(t-1),27] 
netanyahu_Retweets1 <- riots_new[1:(t-1),28] 
rouhani_Total_Posts1 <- riots_new[1:(t-1),29] 
rouhani_Favorites1 <- riots_new[1:(t-1),30] 
USEmbassyManama_Retweets1 <- riots_new[1:(t-1),31] 
TEMP1 <- riots_new[1:(t-1),32] 
DEWP1 <- riots_new[1:(t-1),33] 
WDSP1 <- riots_new[1:(t-1),34] 
PRCP1 <- riots_new[1:(t-1),35] 
zinc_Open1 <- riots_new[1:(t-1),36] 
zinc_Low1 <- riots_new[1:(t-1),37] 
WTI_Close1 <- riots_new[1:(t-1),38] 
WTI_Low1 <- riots_new[1:(t-1),39] 
wheat_Open1 <- riots_new[1:(t-1),40] 
wheat_High1 <- riots_new[1:(t-1),41] 
wheat_Low1 <- riots_new[1:(t-1),42] 
tin_Close1 <- riots_new[1:(t-1),43] 
tin_High1 <- riots_new[1:(t-1),44] 
tin_Low1 <- riots_new[1:(t-1),45] 
sugar_Close1 <- riots_new[1:(t-1),46] 
sugar_Open1 <- riots_new[1:(t-1),47] 
sugar_Low1 <- riots_new[1:(t-1),48] 
soybean_Close1 <- riots_new[1:(t-1),49] 
soybean_Open1 <- riots_new[1:(t-1),50] 
soybean_High1 <- riots_new[1:(t-1),51] 
soybean_Low1 <- riots_new[1:(t-1),52] 
silver_High1 <- riots_new[1:(t-1),53] 
rice_Close1 <- riots_new[1:(t-1),54] 
rice_High1 <- riots_new[1:(t-1),55] 
platinum_Close1 <- riots_new[1:(t-1),56] 
natural_gas_Close1 <- riots_new[1:(t-1),57] 
monero_Close1 <- riots_new[1:(t-1),58] 
monero_High1 <- riots_new[1:(t-1),59] 
litecoin_Close1 <- riots_new[1:(t-1),60] 
litecoin_Open1 <- riots_new[1:(t-1),61] 
litecoin_Low1 <- riots_new[1:(t-1),62] 
lead_High1 <- riots_new[1:(t-1),63] 
lead_Low1 <- riots_new[1:(t-1),64] 
Gold_Low1 <- riots_new[1:(t-1),65] 
cotton_Low1 <- riots_new[1:(t-1),66] 
corn_High1 <- riots_new[1:(t-1),67] 
corn_Low1 <- riots_new[1:(t-1),68] 
copper_Close1 <- riots_new[1:(t-1),69] 
copper_High1 <- riots_new[1:(t-1),70] 
coffee_Close1 <- riots_new[1:(t-1),71] 
coffee_High1 <- riots_new[1:(t-1),72] 
live_cattle_Close1 <- riots_new[1:(t-1),73] 
live_cattle_High1 <- riots_new[1:(t-1),74] 
live_cattle_Low1 <- riots_new[1:(t-1),75] 
feed_cattle_Close1 <- riots_new[1:(t-1),76] 
feed_cattle_Open1 <- riots_new[1:(t-1),77] 
Brent_Close1 <- riots_new[1:(t-1),78] 
Brent_Open1 <- riots_new[1:(t-1),79] 
Bitcoin_Open1 <- riots_new[1:(t-1),80] 
Bitcoin_Low1 <- riots_new[1:(t-1),81] 
BAX_Open1 <- riots_new[1:(t-1),82] 
BAX_High1 <- riots_new[1:(t-1),83] 
protest_count1 <- riots_new[1:(t-1),84] 
VAC_count1 <- riots_new[1:(t-1),85] 
total_fatalities1 <- riots_new[1:(t-1),86] 
category1 <- riots_new[1:(t-1),87] 

## For time t
al_wafa_Total_Posts2 <- riots_new[2:t,1] 
bahrain_moi_Total_Posts2 <- riots_new[2:t,2] 
BahrainRights_Favorites2 <- riots_new[2:t,3] 
BahrainRights_Retweets2 <- riots_new[2:t,4] 
BBCArabic_Total_Posts2 <- riots_new[2:t,5] 
BBCArabic_Favorites2 <- riots_new[2:t,6] 
BBCArabic_Retweets2 <- riots_new[2:t,7] 
bh14feb2011_Total_Posts2 <- riots_new[2:t,8] 
bh14feb2011_Favorites2 <- riots_new[2:t,9] 
bh14feb2011_Retweets2 <- riots_new[2:t,10] 
bna_ar_Total_Posts2 <- riots_new[2:t,11] 
bna_ar_Retweets2 <- riots_new[2:t,12] 
Coalition14_Total_Posts2 <- riots_new[2:t,13] 
Coalition14_Favorites2 <- riots_new[2:t,14] 
duraz_youth_Total_Posts2 <- riots_new[2:t,15] 
duraz_youth_Favorites2 <- riots_new[2:t,16] 
duraz_youth_Retweets2 <- riots_new[2:t,17] 
feb14revolution_Retweets2 <- riots_new[2:t,18] 
GDNonline_Total_Posts2 <- riots_new[2:t,19] 
GDNonline_Favorites2 <- riots_new[2:t,20] 
GDNonline_Retweets2 <- riots_new[2:t,21] 
Iran_Total_Posts2 <- riots_new[2:t,22] 
Iran_Favorites2 <- riots_new[2:t,23] 
IranNW_Retweets2 <- riots_new[2:t,24] 
malarab1_Favorites2 <- riots_new[2:t,25] 
NABEELRAJAB_Favorites2 <- riots_new[2:t,26] 
netanyahu_Favorites2 <- riots_new[2:t,27] 
netanyahu_Retweets2 <- riots_new[2:t,28] 
rouhani_Total_Posts2 <- riots_new[2:t,29] 
rouhani_Favorites2 <- riots_new[2:t,30] 
USEmbassyManama_Retweets2 <- riots_new[2:t,31] 
TEMP2 <- riots_new[2:t,32] 
DEWP2 <- riots_new[2:t,33] 
WDSP2 <- riots_new[2:t,34] 
PRCP2 <- riots_new[2:t,35] 
zinc_Open2 <- riots_new[2:t,36] 
zinc_Low2 <- riots_new[2:t,37] 
WTI_Close2 <- riots_new[2:t,38] 
WTI_Low2 <- riots_new[2:t,39] 
wheat_Open2 <- riots_new[2:t,40] 
wheat_High2 <- riots_new[2:t,41] 
wheat_Low2 <- riots_new[2:t,42] 
tin_Close2 <- riots_new[2:t,43] 
tin_High2 <- riots_new[2:t,44] 
tin_Low2 <- riots_new[2:t,45] 
sugar_Close2 <- riots_new[2:t,46] 
sugar_Open2 <- riots_new[2:t,47] 
sugar_Low2 <- riots_new[2:t,48] 
soybean_Close2 <- riots_new[2:t,49] 
soybean_Open2 <- riots_new[2:t,50] 
soybean_High2 <- riots_new[2:t,51] 
soybean_Low2 <- riots_new[2:t,52] 
silver_High2 <- riots_new[2:t,53] 
rice_Close2 <- riots_new[2:t,54] 
rice_High2 <- riots_new[2:t,55] 
platinum_Close2 <- riots_new[2:t,56] 
natural_gas_Close2 <- riots_new[2:t,57] 
monero_Close2 <- riots_new[2:t,58] 
monero_High2 <- riots_new[2:t,59] 
litecoin_Close2 <- riots_new[2:t,60] 
litecoin_Open2 <- riots_new[2:t,61] 
litecoin_Low2 <- riots_new[2:t,62] 
lead_High2 <- riots_new[2:t,63] 
lead_Low2 <- riots_new[2:t,64] 
Gold_Low2 <- riots_new[2:t,65] 
cotton_Low2 <- riots_new[2:t,66] 
corn_High2 <- riots_new[2:t,67] 
corn_Low2 <- riots_new[2:t,68] 
copper_Close2 <- riots_new[2:t,69] 
copper_High2 <- riots_new[2:t,70] 
coffee_Close2 <- riots_new[2:t,71] 
coffee_High2 <- riots_new[2:t,72] 
live_cattle_Close2 <- riots_new[2:t,73] 
live_cattle_High2 <- riots_new[2:t,74] 
live_cattle_Low2 <- riots_new[2:t,75] 
feed_cattle_Close2 <- riots_new[2:t,76] 
feed_cattle_Open2 <- riots_new[2:t,77] 
Brent_Close2 <- riots_new[2:t,78] 
Brent_Open2 <- riots_new[2:t,79] 
Bitcoin_Open2 <- riots_new[2:t,80] 
Bitcoin_Low2 <- riots_new[2:t,81] 
BAX_Open2 <- riots_new[2:t,82] 
BAX_High2 <- riots_new[2:t,83] 
protest_count2 <- riots_new[2:t,84] 
VAC_count2 <- riots_new[2:t,85] 
total_fatalities2 <- riots_new[2:t,86] 
category2 <- riots_new[2:t,87]

# Now define the target
category3 <- riots_new[(2+s):(t+s), 87]

train <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, protest_count1, VAC_count1, total_fatalities1, category1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, protest_count2, VAC_count2, total_fatalities2, category2, category3)

#summary(train)

### Defining a test set
# Define predictors
## For time t - 1
al_wafa_Total_Posts1 <- riots_new[t:(t+p-1),1] 
bahrain_moi_Total_Posts1 <- riots_new[t:(t+p-1),2] 
BahrainRights_Favorites1 <- riots_new[t:(t+p-1),3] 
BahrainRights_Retweets1 <- riots_new[t:(t+p-1),4] 
BBCArabic_Total_Posts1 <- riots_new[t:(t+p-1),5] 
BBCArabic_Favorites1 <- riots_new[t:(t+p-1),6] 
BBCArabic_Retweets1 <- riots_new[t:(t+p-1),7] 
bh14feb2011_Total_Posts1 <- riots_new[t:(t+p-1),8] 
bh14feb2011_Favorites1 <- riots_new[t:(t+p-1),9] 
bh14feb2011_Retweets1 <- riots_new[t:(t+p-1),10] 
bna_ar_Total_Posts1 <- riots_new[t:(t+p-1),11] 
bna_ar_Retweets1 <- riots_new[t:(t+p-1),12] 
Coalition14_Total_Posts1 <- riots_new[t:(t+p-1),13] 
Coalition14_Favorites1 <- riots_new[t:(t+p-1),14] 
duraz_youth_Total_Posts1 <- riots_new[t:(t+p-1),15] 
duraz_youth_Favorites1 <- riots_new[t:(t+p-1),16] 
duraz_youth_Retweets1 <- riots_new[t:(t+p-1),17] 
feb14revolution_Retweets1 <- riots_new[t:(t+p-1),18] 
GDNonline_Total_Posts1 <- riots_new[t:(t+p-1),19] 
GDNonline_Favorites1 <- riots_new[t:(t+p-1),20] 
GDNonline_Retweets1 <- riots_new[t:(t+p-1),21] 
Iran_Total_Posts1 <- riots_new[t:(t+p-1),22] 
Iran_Favorites1 <- riots_new[t:(t+p-1),23] 
IranNW_Retweets1 <- riots_new[t:(t+p-1),24] 
malarab1_Favorites1 <- riots_new[t:(t+p-1),25] 
NABEELRAJAB_Favorites1 <- riots_new[t:(t+p-1),26] 
netanyahu_Favorites1 <- riots_new[t:(t+p-1),27] 
netanyahu_Retweets1 <- riots_new[t:(t+p-1),28] 
rouhani_Total_Posts1 <- riots_new[t:(t+p-1),29] 
rouhani_Favorites1 <- riots_new[t:(t+p-1),30] 
USEmbassyManama_Retweets1 <- riots_new[t:(t+p-1),31] 
TEMP1 <- riots_new[t:(t+p-1),32] 
DEWP1 <- riots_new[t:(t+p-1),33] 
WDSP1 <- riots_new[t:(t+p-1),34] 
PRCP1 <- riots_new[t:(t+p-1),35] 
zinc_Open1 <- riots_new[t:(t+p-1),36] 
zinc_Low1 <- riots_new[t:(t+p-1),37] 
WTI_Close1 <- riots_new[t:(t+p-1),38] 
WTI_Low1 <- riots_new[t:(t+p-1),39] 
wheat_Open1 <- riots_new[t:(t+p-1),40] 
wheat_High1 <- riots_new[t:(t+p-1),41] 
wheat_Low1 <- riots_new[t:(t+p-1),42] 
tin_Close1 <- riots_new[t:(t+p-1),43] 
tin_High1 <- riots_new[t:(t+p-1),44] 
tin_Low1 <- riots_new[t:(t+p-1),45] 
sugar_Close1 <- riots_new[t:(t+p-1),46] 
sugar_Open1 <- riots_new[t:(t+p-1),47] 
sugar_Low1 <- riots_new[t:(t+p-1),48] 
soybean_Close1 <- riots_new[t:(t+p-1),49] 
soybean_Open1 <- riots_new[t:(t+p-1),50] 
soybean_High1 <- riots_new[t:(t+p-1),51] 
soybean_Low1 <- riots_new[t:(t+p-1),52] 
silver_High1 <- riots_new[t:(t+p-1),53] 
rice_Close1 <- riots_new[t:(t+p-1),54] 
rice_High1 <- riots_new[t:(t+p-1),55] 
platinum_Close1 <- riots_new[t:(t+p-1),56] 
natural_gas_Close1 <- riots_new[t:(t+p-1),57] 
monero_Close1 <- riots_new[t:(t+p-1),58] 
monero_High1 <- riots_new[t:(t+p-1),59] 
litecoin_Close1 <- riots_new[t:(t+p-1),60] 
litecoin_Open1 <- riots_new[t:(t+p-1),61] 
litecoin_Low1 <- riots_new[t:(t+p-1),62] 
lead_High1 <- riots_new[t:(t+p-1),63] 
lead_Low1 <- riots_new[t:(t+p-1),64] 
Gold_Low1 <- riots_new[t:(t+p-1),65] 
cotton_Low1 <- riots_new[t:(t+p-1),66] 
corn_High1 <- riots_new[t:(t+p-1),67] 
corn_Low1 <- riots_new[t:(t+p-1),68] 
copper_Close1 <- riots_new[t:(t+p-1),69] 
copper_High1 <- riots_new[t:(t+p-1),70] 
coffee_Close1 <- riots_new[t:(t+p-1),71] 
coffee_High1 <- riots_new[t:(t+p-1),72] 
live_cattle_Close1 <- riots_new[t:(t+p-1),73] 
live_cattle_High1 <- riots_new[t:(t+p-1),74] 
live_cattle_Low1 <- riots_new[t:(t+p-1),75] 
feed_cattle_Close1 <- riots_new[t:(t+p-1),76] 
feed_cattle_Open1 <- riots_new[t:(t+p-1),77] 
Brent_Close1 <- riots_new[t:(t+p-1),78] 
Brent_Open1 <- riots_new[t:(t+p-1),79] 
Bitcoin_Open1 <- riots_new[t:(t+p-1),80] 
Bitcoin_Low1 <- riots_new[t:(t+p-1),81] 
BAX_Open1 <- riots_new[t:(t+p-1),82] 
BAX_High1 <- riots_new[t:(t+p-1),83] 
protest_count1 <- riots_new[t:(t+p-1),84] 
VAC_count1 <- riots_new[t:(t+p-1),85] 
total_fatalities1 <- riots_new[t:(t+p-1),86] 
category1 <- riots_new[t:(t+p-1),87]

## For time t
al_wafa_Total_Posts2 <- riots_new[(t+1):(t+p),1] 
bahrain_moi_Total_Posts2 <- riots_new[(t+1):(t+p),2] 
BahrainRights_Favorites2 <- riots_new[(t+1):(t+p),3] 
BahrainRights_Retweets2 <- riots_new[(t+1):(t+p),4] 
BBCArabic_Total_Posts2 <- riots_new[(t+1):(t+p),5] 
BBCArabic_Favorites2 <- riots_new[(t+1):(t+p),6] 
BBCArabic_Retweets2 <- riots_new[(t+1):(t+p),7] 
bh14feb2011_Total_Posts2 <- riots_new[(t+1):(t+p),8] 
bh14feb2011_Favorites2 <- riots_new[(t+1):(t+p),9] 
bh14feb2011_Retweets2 <- riots_new[(t+1):(t+p),10] 
bna_ar_Total_Posts2 <- riots_new[(t+1):(t+p),11] 
bna_ar_Retweets2 <- riots_new[(t+1):(t+p),12] 
Coalition14_Total_Posts2 <- riots_new[(t+1):(t+p),13] 
Coalition14_Favorites2 <- riots_new[(t+1):(t+p),14] 
duraz_youth_Total_Posts2 <- riots_new[(t+1):(t+p),15] 
duraz_youth_Favorites2 <- riots_new[(t+1):(t+p),16] 
duraz_youth_Retweets2 <- riots_new[(t+1):(t+p),17] 
feb14revolution_Retweets2 <- riots_new[(t+1):(t+p),18] 
GDNonline_Total_Posts2 <- riots_new[(t+1):(t+p),19] 
GDNonline_Favorites2 <- riots_new[(t+1):(t+p),20] 
GDNonline_Retweets2 <- riots_new[(t+1):(t+p),21] 
Iran_Total_Posts2 <- riots_new[(t+1):(t+p),22] 
Iran_Favorites2 <- riots_new[(t+1):(t+p),23] 
IranNW_Retweets2 <- riots_new[(t+1):(t+p),24] 
malarab1_Favorites2 <- riots_new[(t+1):(t+p),25] 
NABEELRAJAB_Favorites2 <- riots_new[(t+1):(t+p),26] 
netanyahu_Favorites2 <- riots_new[(t+1):(t+p),27] 
netanyahu_Retweets2 <- riots_new[(t+1):(t+p),28] 
rouhani_Total_Posts2 <- riots_new[(t+1):(t+p),29] 
rouhani_Favorites2 <- riots_new[(t+1):(t+p),30] 
USEmbassyManama_Retweets2 <- riots_new[(t+1):(t+p),31] 
TEMP2 <- riots_new[(t+1):(t+p),32] 
DEWP2 <- riots_new[(t+1):(t+p),33] 
WDSP2 <- riots_new[(t+1):(t+p),34] 
PRCP2 <- riots_new[(t+1):(t+p),35] 
zinc_Open2 <- riots_new[(t+1):(t+p),36] 
zinc_Low2 <- riots_new[(t+1):(t+p),37] 
WTI_Close2 <- riots_new[(t+1):(t+p),38] 
WTI_Low2 <- riots_new[(t+1):(t+p),39] 
wheat_Open2 <- riots_new[(t+1):(t+p),40] 
wheat_High2 <- riots_new[(t+1):(t+p),41] 
wheat_Low2 <- riots_new[(t+1):(t+p),42] 
tin_Close2 <- riots_new[(t+1):(t+p),43] 
tin_High2 <- riots_new[(t+1):(t+p),44] 
tin_Low2 <- riots_new[(t+1):(t+p),45] 
sugar_Close2 <- riots_new[(t+1):(t+p),46] 
sugar_Open2 <- riots_new[(t+1):(t+p),47] 
sugar_Low2 <- riots_new[(t+1):(t+p),48] 
soybean_Close2 <- riots_new[(t+1):(t+p),49] 
soybean_Open2 <- riots_new[(t+1):(t+p),50] 
soybean_High2 <- riots_new[(t+1):(t+p),51] 
soybean_Low2 <- riots_new[(t+1):(t+p),52] 
silver_High2 <- riots_new[(t+1):(t+p),53] 
rice_Close2 <- riots_new[(t+1):(t+p),54] 
rice_High2 <- riots_new[(t+1):(t+p),55] 
platinum_Close2 <- riots_new[(t+1):(t+p),56] 
natural_gas_Close2 <- riots_new[(t+1):(t+p),57] 
monero_Close2 <- riots_new[(t+1):(t+p),58] 
monero_High2 <- riots_new[(t+1):(t+p),59] 
litecoin_Close2 <- riots_new[(t+1):(t+p),60] 
litecoin_Open2 <- riots_new[(t+1):(t+p),61] 
litecoin_Low2 <- riots_new[(t+1):(t+p),62] 
lead_High2 <- riots_new[(t+1):(t+p),63] 
lead_Low2 <- riots_new[(t+1):(t+p),64] 
Gold_Low2 <- riots_new[(t+1):(t+p),65] 
cotton_Low2 <- riots_new[(t+1):(t+p),66] 
corn_High2 <- riots_new[(t+1):(t+p),67] 
corn_Low2 <- riots_new[(t+1):(t+p),68] 
copper_Close2 <- riots_new[(t+1):(t+p),69] 
copper_High2 <- riots_new[(t+1):(t+p),70] 
coffee_Close2 <- riots_new[(t+1):(t+p),71] 
coffee_High2 <- riots_new[(t+1):(t+p),72] 
live_cattle_Close2 <- riots_new[(t+1):(t+p),73] 
live_cattle_High2 <- riots_new[(t+1):(t+p),74] 
live_cattle_Low2 <- riots_new[(t+1):(t+p),75] 
feed_cattle_Close2 <- riots_new[(t+1):(t+p),76] 
feed_cattle_Open2 <- riots_new[(t+1):(t+p),77] 
Brent_Close2 <- riots_new[(t+1):(t+p),78] 
Brent_Open2 <- riots_new[(t+1):(t+p),79] 
Bitcoin_Open2 <- riots_new[(t+1):(t+p),80] 
Bitcoin_Low2 <- riots_new[(t+1):(t+p),81] 
BAX_Open2 <- riots_new[(t+1):(t+p),82] 
BAX_High2 <- riots_new[(t+1):(t+p),83] 
protest_count2 <- riots_new[(t+1):(t+p),84] 
VAC_count2 <- riots_new[(t+1):(t+p),85] 
total_fatalities2 <- riots_new[(t+1):(t+p),86] 
category2 <- riots_new[(t+1):(t+p),87]

# Now define the target
category3 <- riots_new[(t+1+s):(t+p+s), 87]

test <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, protest_count1, VAC_count1, total_fatalities1, category1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, protest_count2, VAC_count2, total_fatalities2, category2, category3)

#summary(test)

## Applying RF
RandomForest <- randomForest(category3 ~ ., data=train, importance = TRUE, ntrees = nrow(train), weights = 1000/table(train$category))

predRF <- predict(RandomForest, newdata = test, type = "response")
# Get the predicted category
predClassRF <- predict(RandomForest, newdata = test, type = "response")

# Report confusion matrix from on the test dataset
confusionMatrix(predClassRF, test$category3)
```

```{r warning = FALSE}
RF.Pre <- list()
RF.accuracy <- list()
RF.CM.List <- list()
RF.Pre[[1]] <- predRF
k <- 1

#for(t in (i.train.sample + s + 1):(d[1]-p-s)){
for(t in (i.train.sample + s + 1):(i.train.sample + s + 11)){
  k <- k + 1
  ### Defining a train set
  # Define predictors
  ## For time t - 1
  al_wafa_Total_Posts1 <- riots_new[1:(t-1),1] 
  bahrain_moi_Total_Posts1 <- riots_new[1:(t-1),2] 
  BahrainRights_Favorites1 <- riots_new[1:(t-1),3] 
  BahrainRights_Retweets1 <- riots_new[1:(t-1),4] 
  BBCArabic_Total_Posts1 <- riots_new[1:(t-1),5] 
  BBCArabic_Favorites1 <- riots_new[1:(t-1),6] 
  BBCArabic_Retweets1 <- riots_new[1:(t-1),7] 
  bh14feb2011_Total_Posts1 <- riots_new[1:(t-1),8] 
  bh14feb2011_Favorites1 <- riots_new[1:(t-1),9] 
  bh14feb2011_Retweets1 <- riots_new[1:(t-1),10] 
  bna_ar_Total_Posts1 <- riots_new[1:(t-1),11] 
  bna_ar_Retweets1 <- riots_new[1:(t-1),12] 
  Coalition14_Total_Posts1 <- riots_new[1:(t-1),13] 
  Coalition14_Favorites1 <- riots_new[1:(t-1),14] 
  duraz_youth_Total_Posts1 <- riots_new[1:(t-1),15] 
  duraz_youth_Favorites1 <- riots_new[1:(t-1),16] 
  duraz_youth_Retweets1 <- riots_new[1:(t-1),17] 
  feb14revolution_Retweets1 <- riots_new[1:(t-1),18] 
  GDNonline_Total_Posts1 <- riots_new[1:(t-1),19] 
  GDNonline_Favorites1 <- riots_new[1:(t-1),20] 
  GDNonline_Retweets1 <- riots_new[1:(t-1),21] 
  Iran_Total_Posts1 <- riots_new[1:(t-1),22] 
  Iran_Favorites1 <- riots_new[1:(t-1),23] 
  IranNW_Retweets1 <- riots_new[1:(t-1),24] 
  malarab1_Favorites1 <- riots_new[1:(t-1),25] 
  NABEELRAJAB_Favorites1 <- riots_new[1:(t-1),26] 
  netanyahu_Favorites1 <- riots_new[1:(t-1),27] 
  netanyahu_Retweets1 <- riots_new[1:(t-1),28] 
  rouhani_Total_Posts1 <- riots_new[1:(t-1),29] 
  rouhani_Favorites1 <- riots_new[1:(t-1),30] 
  USEmbassyManama_Retweets1 <- riots_new[1:(t-1),31] 
  TEMP1 <- riots_new[1:(t-1),32] 
  DEWP1 <- riots_new[1:(t-1),33] 
  WDSP1 <- riots_new[1:(t-1),34] 
  PRCP1 <- riots_new[1:(t-1),35] 
  zinc_Open1 <- riots_new[1:(t-1),36] 
  zinc_Low1 <- riots_new[1:(t-1),37] 
  WTI_Close1 <- riots_new[1:(t-1),38] 
  WTI_Low1 <- riots_new[1:(t-1),39] 
  wheat_Open1 <- riots_new[1:(t-1),40] 
  wheat_High1 <- riots_new[1:(t-1),41] 
  wheat_Low1 <- riots_new[1:(t-1),42] 
  tin_Close1 <- riots_new[1:(t-1),43] 
  tin_High1 <- riots_new[1:(t-1),44] 
  tin_Low1 <- riots_new[1:(t-1),45] 
  sugar_Close1 <- riots_new[1:(t-1),46] 
  sugar_Open1 <- riots_new[1:(t-1),47] 
  sugar_Low1 <- riots_new[1:(t-1),48] 
  soybean_Close1 <- riots_new[1:(t-1),49] 
  soybean_Open1 <- riots_new[1:(t-1),50] 
  soybean_High1 <- riots_new[1:(t-1),51] 
  soybean_Low1 <- riots_new[1:(t-1),52] 
  silver_High1 <- riots_new[1:(t-1),53] 
  rice_Close1 <- riots_new[1:(t-1),54] 
  rice_High1 <- riots_new[1:(t-1),55] 
  platinum_Close1 <- riots_new[1:(t-1),56] 
  natural_gas_Close1 <- riots_new[1:(t-1),57] 
  monero_Close1 <- riots_new[1:(t-1),58] 
  monero_High1 <- riots_new[1:(t-1),59] 
  litecoin_Close1 <- riots_new[1:(t-1),60] 
  litecoin_Open1 <- riots_new[1:(t-1),61] 
  litecoin_Low1 <- riots_new[1:(t-1),62] 
  lead_High1 <- riots_new[1:(t-1),63] 
  lead_Low1 <- riots_new[1:(t-1),64] 
  Gold_Low1 <- riots_new[1:(t-1),65] 
  cotton_Low1 <- riots_new[1:(t-1),66] 
  corn_High1 <- riots_new[1:(t-1),67] 
  corn_Low1 <- riots_new[1:(t-1),68] 
  copper_Close1 <- riots_new[1:(t-1),69] 
  copper_High1 <- riots_new[1:(t-1),70] 
  coffee_Close1 <- riots_new[1:(t-1),71] 
  coffee_High1 <- riots_new[1:(t-1),72] 
  live_cattle_Close1 <- riots_new[1:(t-1),73] 
  live_cattle_High1 <- riots_new[1:(t-1),74] 
  live_cattle_Low1 <- riots_new[1:(t-1),75] 
  feed_cattle_Close1 <- riots_new[1:(t-1),76] 
  feed_cattle_Open1 <- riots_new[1:(t-1),77] 
  Brent_Close1 <- riots_new[1:(t-1),78] 
  Brent_Open1 <- riots_new[1:(t-1),79] 
  Bitcoin_Open1 <- riots_new[1:(t-1),80] 
  Bitcoin_Low1 <- riots_new[1:(t-1),81] 
  BAX_Open1 <- riots_new[1:(t-1),82] 
  BAX_High1 <- riots_new[1:(t-1),83] 
  protest_count1 <- riots_new[1:(t-1),84] 
  VAC_count1 <- riots_new[1:(t-1),85] 
  total_fatalities1 <- riots_new[1:(t-1),86] 
  category1 <- riots_new[1:(t-1),87] 
  
  ## For time t
  al_wafa_Total_Posts2 <- riots_new[2:t,1] 
  bahrain_moi_Total_Posts2 <- riots_new[2:t,2] 
  BahrainRights_Favorites2 <- riots_new[2:t,3] 
  BahrainRights_Retweets2 <- riots_new[2:t,4] 
  BBCArabic_Total_Posts2 <- riots_new[2:t,5] 
  BBCArabic_Favorites2 <- riots_new[2:t,6] 
  BBCArabic_Retweets2 <- riots_new[2:t,7] 
  bh14feb2011_Total_Posts2 <- riots_new[2:t,8] 
  bh14feb2011_Favorites2 <- riots_new[2:t,9] 
  bh14feb2011_Retweets2 <- riots_new[2:t,10] 
  bna_ar_Total_Posts2 <- riots_new[2:t,11] 
  bna_ar_Retweets2 <- riots_new[2:t,12] 
  Coalition14_Total_Posts2 <- riots_new[2:t,13] 
  Coalition14_Favorites2 <- riots_new[2:t,14] 
  duraz_youth_Total_Posts2 <- riots_new[2:t,15] 
  duraz_youth_Favorites2 <- riots_new[2:t,16] 
  duraz_youth_Retweets2 <- riots_new[2:t,17] 
  feb14revolution_Retweets2 <- riots_new[2:t,18] 
  GDNonline_Total_Posts2 <- riots_new[2:t,19] 
  GDNonline_Favorites2 <- riots_new[2:t,20] 
  GDNonline_Retweets2 <- riots_new[2:t,21] 
  Iran_Total_Posts2 <- riots_new[2:t,22] 
  Iran_Favorites2 <- riots_new[2:t,23] 
  IranNW_Retweets2 <- riots_new[2:t,24] 
  malarab1_Favorites2 <- riots_new[2:t,25] 
  NABEELRAJAB_Favorites2 <- riots_new[2:t,26] 
  netanyahu_Favorites2 <- riots_new[2:t,27] 
  netanyahu_Retweets2 <- riots_new[2:t,28] 
  rouhani_Total_Posts2 <- riots_new[2:t,29] 
  rouhani_Favorites2 <- riots_new[2:t,30] 
  USEmbassyManama_Retweets2 <- riots_new[2:t,31] 
  TEMP2 <- riots_new[2:t,32] 
  DEWP2 <- riots_new[2:t,33] 
  WDSP2 <- riots_new[2:t,34] 
  PRCP2 <- riots_new[2:t,35] 
  zinc_Open2 <- riots_new[2:t,36] 
  zinc_Low2 <- riots_new[2:t,37] 
  WTI_Close2 <- riots_new[2:t,38] 
  WTI_Low2 <- riots_new[2:t,39] 
  wheat_Open2 <- riots_new[2:t,40] 
  wheat_High2 <- riots_new[2:t,41] 
  wheat_Low2 <- riots_new[2:t,42] 
  tin_Close2 <- riots_new[2:t,43] 
  tin_High2 <- riots_new[2:t,44] 
  tin_Low2 <- riots_new[2:t,45] 
  sugar_Close2 <- riots_new[2:t,46] 
  sugar_Open2 <- riots_new[2:t,47] 
  sugar_Low2 <- riots_new[2:t,48] 
  soybean_Close2 <- riots_new[2:t,49] 
  soybean_Open2 <- riots_new[2:t,50] 
  soybean_High2 <- riots_new[2:t,51] 
  soybean_Low2 <- riots_new[2:t,52] 
  silver_High2 <- riots_new[2:t,53] 
  rice_Close2 <- riots_new[2:t,54] 
  rice_High2 <- riots_new[2:t,55] 
  platinum_Close2 <- riots_new[2:t,56] 
  natural_gas_Close2 <- riots_new[2:t,57] 
  monero_Close2 <- riots_new[2:t,58] 
  monero_High2 <- riots_new[2:t,59] 
  litecoin_Close2 <- riots_new[2:t,60] 
  litecoin_Open2 <- riots_new[2:t,61] 
  litecoin_Low2 <- riots_new[2:t,62] 
  lead_High2 <- riots_new[2:t,63] 
  lead_Low2 <- riots_new[2:t,64] 
  Gold_Low2 <- riots_new[2:t,65] 
  cotton_Low2 <- riots_new[2:t,66] 
  corn_High2 <- riots_new[2:t,67] 
  corn_Low2 <- riots_new[2:t,68] 
  copper_Close2 <- riots_new[2:t,69] 
  copper_High2 <- riots_new[2:t,70] 
  coffee_Close2 <- riots_new[2:t,71] 
  coffee_High2 <- riots_new[2:t,72] 
  live_cattle_Close2 <- riots_new[2:t,73] 
  live_cattle_High2 <- riots_new[2:t,74] 
  live_cattle_Low2 <- riots_new[2:t,75] 
  feed_cattle_Close2 <- riots_new[2:t,76] 
  feed_cattle_Open2 <- riots_new[2:t,77] 
  Brent_Close2 <- riots_new[2:t,78] 
  Brent_Open2 <- riots_new[2:t,79] 
  Bitcoin_Open2 <- riots_new[2:t,80] 
  Bitcoin_Low2 <- riots_new[2:t,81] 
  BAX_Open2 <- riots_new[2:t,82] 
  BAX_High2 <- riots_new[2:t,83] 
  protest_count2 <- riots_new[2:t,84] 
  VAC_count2 <- riots_new[2:t,85] 
  total_fatalities2 <- riots_new[2:t,86] 
  category2 <- riots_new[2:t,87]
  
  # Now define the target
  category3 <- riots_new[(2+s):(t+s), 87]
  
  train <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, protest_count1, VAC_count1, total_fatalities1, category1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, protest_count2, VAC_count2, total_fatalities2, category2, category3)
  
  #summary(train)
  
  ### Defining a test set
  # Define predictors
  ## For time t - 1
  al_wafa_Total_Posts1 <- riots_new[t:(t+p-1),1] 
  bahrain_moi_Total_Posts1 <- riots_new[t:(t+p-1),2] 
  BahrainRights_Favorites1 <- riots_new[t:(t+p-1),3] 
  BahrainRights_Retweets1 <- riots_new[t:(t+p-1),4] 
  BBCArabic_Total_Posts1 <- riots_new[t:(t+p-1),5] 
  BBCArabic_Favorites1 <- riots_new[t:(t+p-1),6] 
  BBCArabic_Retweets1 <- riots_new[t:(t+p-1),7] 
  bh14feb2011_Total_Posts1 <- riots_new[t:(t+p-1),8] 
  bh14feb2011_Favorites1 <- riots_new[t:(t+p-1),9] 
  bh14feb2011_Retweets1 <- riots_new[t:(t+p-1),10] 
  bna_ar_Total_Posts1 <- riots_new[t:(t+p-1),11] 
  bna_ar_Retweets1 <- riots_new[t:(t+p-1),12] 
  Coalition14_Total_Posts1 <- riots_new[t:(t+p-1),13] 
  Coalition14_Favorites1 <- riots_new[t:(t+p-1),14] 
  duraz_youth_Total_Posts1 <- riots_new[t:(t+p-1),15] 
  duraz_youth_Favorites1 <- riots_new[t:(t+p-1),16] 
  duraz_youth_Retweets1 <- riots_new[t:(t+p-1),17] 
  feb14revolution_Retweets1 <- riots_new[t:(t+p-1),18] 
  GDNonline_Total_Posts1 <- riots_new[t:(t+p-1),19] 
  GDNonline_Favorites1 <- riots_new[t:(t+p-1),20] 
  GDNonline_Retweets1 <- riots_new[t:(t+p-1),21] 
  Iran_Total_Posts1 <- riots_new[t:(t+p-1),22] 
  Iran_Favorites1 <- riots_new[t:(t+p-1),23] 
  IranNW_Retweets1 <- riots_new[t:(t+p-1),24] 
  malarab1_Favorites1 <- riots_new[t:(t+p-1),25] 
  NABEELRAJAB_Favorites1 <- riots_new[t:(t+p-1),26] 
  netanyahu_Favorites1 <- riots_new[t:(t+p-1),27] 
  netanyahu_Retweets1 <- riots_new[t:(t+p-1),28] 
  rouhani_Total_Posts1 <- riots_new[t:(t+p-1),29] 
  rouhani_Favorites1 <- riots_new[t:(t+p-1),30] 
  USEmbassyManama_Retweets1 <- riots_new[t:(t+p-1),31] 
  TEMP1 <- riots_new[t:(t+p-1),32] 
  DEWP1 <- riots_new[t:(t+p-1),33] 
  WDSP1 <- riots_new[t:(t+p-1),34] 
  PRCP1 <- riots_new[t:(t+p-1),35] 
  zinc_Open1 <- riots_new[t:(t+p-1),36] 
  zinc_Low1 <- riots_new[t:(t+p-1),37] 
  WTI_Close1 <- riots_new[t:(t+p-1),38] 
  WTI_Low1 <- riots_new[t:(t+p-1),39] 
  wheat_Open1 <- riots_new[t:(t+p-1),40] 
  wheat_High1 <- riots_new[t:(t+p-1),41] 
  wheat_Low1 <- riots_new[t:(t+p-1),42] 
  tin_Close1 <- riots_new[t:(t+p-1),43] 
  tin_High1 <- riots_new[t:(t+p-1),44] 
  tin_Low1 <- riots_new[t:(t+p-1),45] 
  sugar_Close1 <- riots_new[t:(t+p-1),46] 
  sugar_Open1 <- riots_new[t:(t+p-1),47] 
  sugar_Low1 <- riots_new[t:(t+p-1),48] 
  soybean_Close1 <- riots_new[t:(t+p-1),49] 
  soybean_Open1 <- riots_new[t:(t+p-1),50] 
  soybean_High1 <- riots_new[t:(t+p-1),51] 
  soybean_Low1 <- riots_new[t:(t+p-1),52] 
  silver_High1 <- riots_new[t:(t+p-1),53] 
  rice_Close1 <- riots_new[t:(t+p-1),54] 
  rice_High1 <- riots_new[t:(t+p-1),55] 
  platinum_Close1 <- riots_new[t:(t+p-1),56] 
  natural_gas_Close1 <- riots_new[t:(t+p-1),57] 
  monero_Close1 <- riots_new[t:(t+p-1),58] 
  monero_High1 <- riots_new[t:(t+p-1),59] 
  litecoin_Close1 <- riots_new[t:(t+p-1),60] 
  litecoin_Open1 <- riots_new[t:(t+p-1),61] 
  litecoin_Low1 <- riots_new[t:(t+p-1),62] 
  lead_High1 <- riots_new[t:(t+p-1),63] 
  lead_Low1 <- riots_new[t:(t+p-1),64] 
  Gold_Low1 <- riots_new[t:(t+p-1),65] 
  cotton_Low1 <- riots_new[t:(t+p-1),66] 
  corn_High1 <- riots_new[t:(t+p-1),67] 
  corn_Low1 <- riots_new[t:(t+p-1),68] 
  copper_Close1 <- riots_new[t:(t+p-1),69] 
  copper_High1 <- riots_new[t:(t+p-1),70] 
  coffee_Close1 <- riots_new[t:(t+p-1),71] 
  coffee_High1 <- riots_new[t:(t+p-1),72] 
  live_cattle_Close1 <- riots_new[t:(t+p-1),73] 
  live_cattle_High1 <- riots_new[t:(t+p-1),74] 
  live_cattle_Low1 <- riots_new[t:(t+p-1),75] 
  feed_cattle_Close1 <- riots_new[t:(t+p-1),76] 
  feed_cattle_Open1 <- riots_new[t:(t+p-1),77] 
  Brent_Close1 <- riots_new[t:(t+p-1),78] 
  Brent_Open1 <- riots_new[t:(t+p-1),79] 
  Bitcoin_Open1 <- riots_new[t:(t+p-1),80] 
  Bitcoin_Low1 <- riots_new[t:(t+p-1),81] 
  BAX_Open1 <- riots_new[t:(t+p-1),82] 
  BAX_High1 <- riots_new[t:(t+p-1),83] 
  protest_count1 <- riots_new[t:(t+p-1),84] 
  VAC_count1 <- riots_new[t:(t+p-1),85] 
  total_fatalities1 <- riots_new[t:(t+p-1),86] 
  category1 <- riots_new[t:(t+p-1),87]
  
  ## For time t
  al_wafa_Total_Posts2 <- riots_new[(t+1):(t+p),1] 
  bahrain_moi_Total_Posts2 <- riots_new[(t+1):(t+p),2] 
  BahrainRights_Favorites2 <- riots_new[(t+1):(t+p),3] 
  BahrainRights_Retweets2 <- riots_new[(t+1):(t+p),4] 
  BBCArabic_Total_Posts2 <- riots_new[(t+1):(t+p),5] 
  BBCArabic_Favorites2 <- riots_new[(t+1):(t+p),6] 
  BBCArabic_Retweets2 <- riots_new[(t+1):(t+p),7] 
  bh14feb2011_Total_Posts2 <- riots_new[(t+1):(t+p),8] 
  bh14feb2011_Favorites2 <- riots_new[(t+1):(t+p),9] 
  bh14feb2011_Retweets2 <- riots_new[(t+1):(t+p),10] 
  bna_ar_Total_Posts2 <- riots_new[(t+1):(t+p),11] 
  bna_ar_Retweets2 <- riots_new[(t+1):(t+p),12] 
  Coalition14_Total_Posts2 <- riots_new[(t+1):(t+p),13] 
  Coalition14_Favorites2 <- riots_new[(t+1):(t+p),14] 
  duraz_youth_Total_Posts2 <- riots_new[(t+1):(t+p),15] 
  duraz_youth_Favorites2 <- riots_new[(t+1):(t+p),16] 
  duraz_youth_Retweets2 <- riots_new[(t+1):(t+p),17] 
  feb14revolution_Retweets2 <- riots_new[(t+1):(t+p),18] 
  GDNonline_Total_Posts2 <- riots_new[(t+1):(t+p),19] 
  GDNonline_Favorites2 <- riots_new[(t+1):(t+p),20] 
  GDNonline_Retweets2 <- riots_new[(t+1):(t+p),21] 
  Iran_Total_Posts2 <- riots_new[(t+1):(t+p),22] 
  Iran_Favorites2 <- riots_new[(t+1):(t+p),23] 
  IranNW_Retweets2 <- riots_new[(t+1):(t+p),24] 
  malarab1_Favorites2 <- riots_new[(t+1):(t+p),25] 
  NABEELRAJAB_Favorites2 <- riots_new[(t+1):(t+p),26] 
  netanyahu_Favorites2 <- riots_new[(t+1):(t+p),27] 
  netanyahu_Retweets2 <- riots_new[(t+1):(t+p),28] 
  rouhani_Total_Posts2 <- riots_new[(t+1):(t+p),29] 
  rouhani_Favorites2 <- riots_new[(t+1):(t+p),30] 
  USEmbassyManama_Retweets2 <- riots_new[(t+1):(t+p),31] 
  TEMP2 <- riots_new[(t+1):(t+p),32] 
  DEWP2 <- riots_new[(t+1):(t+p),33] 
  WDSP2 <- riots_new[(t+1):(t+p),34] 
  PRCP2 <- riots_new[(t+1):(t+p),35] 
  zinc_Open2 <- riots_new[(t+1):(t+p),36] 
  zinc_Low2 <- riots_new[(t+1):(t+p),37] 
  WTI_Close2 <- riots_new[(t+1):(t+p),38] 
  WTI_Low2 <- riots_new[(t+1):(t+p),39] 
  wheat_Open2 <- riots_new[(t+1):(t+p),40] 
  wheat_High2 <- riots_new[(t+1):(t+p),41] 
  wheat_Low2 <- riots_new[(t+1):(t+p),42] 
  tin_Close2 <- riots_new[(t+1):(t+p),43] 
  tin_High2 <- riots_new[(t+1):(t+p),44] 
  tin_Low2 <- riots_new[(t+1):(t+p),45] 
  sugar_Close2 <- riots_new[(t+1):(t+p),46] 
  sugar_Open2 <- riots_new[(t+1):(t+p),47] 
  sugar_Low2 <- riots_new[(t+1):(t+p),48] 
  soybean_Close2 <- riots_new[(t+1):(t+p),49] 
  soybean_Open2 <- riots_new[(t+1):(t+p),50] 
  soybean_High2 <- riots_new[(t+1):(t+p),51] 
  soybean_Low2 <- riots_new[(t+1):(t+p),52] 
  silver_High2 <- riots_new[(t+1):(t+p),53] 
  rice_Close2 <- riots_new[(t+1):(t+p),54] 
  rice_High2 <- riots_new[(t+1):(t+p),55] 
  platinum_Close2 <- riots_new[(t+1):(t+p),56] 
  natural_gas_Close2 <- riots_new[(t+1):(t+p),57] 
  monero_Close2 <- riots_new[(t+1):(t+p),58] 
  monero_High2 <- riots_new[(t+1):(t+p),59] 
  litecoin_Close2 <- riots_new[(t+1):(t+p),60] 
  litecoin_Open2 <- riots_new[(t+1):(t+p),61] 
  litecoin_Low2 <- riots_new[(t+1):(t+p),62] 
  lead_High2 <- riots_new[(t+1):(t+p),63] 
  lead_Low2 <- riots_new[(t+1):(t+p),64] 
  Gold_Low2 <- riots_new[(t+1):(t+p),65] 
  cotton_Low2 <- riots_new[(t+1):(t+p),66] 
  corn_High2 <- riots_new[(t+1):(t+p),67] 
  corn_Low2 <- riots_new[(t+1):(t+p),68] 
  copper_Close2 <- riots_new[(t+1):(t+p),69] 
  copper_High2 <- riots_new[(t+1):(t+p),70] 
  coffee_Close2 <- riots_new[(t+1):(t+p),71] 
  coffee_High2 <- riots_new[(t+1):(t+p),72] 
  live_cattle_Close2 <- riots_new[(t+1):(t+p),73] 
  live_cattle_High2 <- riots_new[(t+1):(t+p),74] 
  live_cattle_Low2 <- riots_new[(t+1):(t+p),75] 
  feed_cattle_Close2 <- riots_new[(t+1):(t+p),76] 
  feed_cattle_Open2 <- riots_new[(t+1):(t+p),77] 
  Brent_Close2 <- riots_new[(t+1):(t+p),78] 
  Brent_Open2 <- riots_new[(t+1):(t+p),79] 
  Bitcoin_Open2 <- riots_new[(t+1):(t+p),80] 
  Bitcoin_Low2 <- riots_new[(t+1):(t+p),81] 
  BAX_Open2 <- riots_new[(t+1):(t+p),82] 
  BAX_High2 <- riots_new[(t+1):(t+p),83] 
  protest_count2 <- riots_new[(t+1):(t+p),84] 
  VAC_count2 <- riots_new[(t+1):(t+p),85] 
  total_fatalities2 <- riots_new[(t+1):(t+p),86] 
  category2 <- riots_new[(t+1):(t+p),87]
  
  # Now define the target
  category3 <- riots_new[(t+1+s):(t+p+s), 87]
  
  test <- data.frame(al_wafa_Total_Posts1, bahrain_moi_Total_Posts1, BahrainRights_Favorites1, BahrainRights_Retweets1, BBCArabic_Total_Posts1, BBCArabic_Favorites1, BBCArabic_Retweets1, bh14feb2011_Total_Posts1, bh14feb2011_Favorites1, bh14feb2011_Retweets1, bna_ar_Total_Posts1, bna_ar_Retweets1, Coalition14_Total_Posts1, Coalition14_Favorites1, duraz_youth_Total_Posts1, duraz_youth_Favorites1, duraz_youth_Retweets1, feb14revolution_Retweets1, GDNonline_Total_Posts1, GDNonline_Favorites1, GDNonline_Retweets1, Iran_Total_Posts1, Iran_Favorites1, IranNW_Retweets1, malarab1_Favorites1, NABEELRAJAB_Favorites1, netanyahu_Favorites1, netanyahu_Retweets1, rouhani_Total_Posts1, rouhani_Favorites1, USEmbassyManama_Retweets1, TEMP1, DEWP1, WDSP1, PRCP1, zinc_Open1, zinc_Low1, WTI_Close1, WTI_Low1, wheat_Open1, wheat_High1, wheat_Low1, tin_Close1, tin_High1, tin_Low1, sugar_Close1, sugar_Open1, sugar_Low1, soybean_Close1, soybean_Open1, soybean_High1, soybean_Low1, silver_High1, rice_Close1, rice_High1, platinum_Close1, natural_gas_Close1, monero_Close1, monero_High1, litecoin_Close1, litecoin_Open1, litecoin_Low1, lead_High1, lead_Low1, Gold_Low1, cotton_Low1, corn_High1, corn_Low1, copper_Close1, copper_High1, coffee_Close1, coffee_High1, live_cattle_Close1, live_cattle_High1, live_cattle_Low1, feed_cattle_Close1, feed_cattle_Open1, Brent_Close1, Brent_Open1, Bitcoin_Open1, Bitcoin_Low1, BAX_Open1, BAX_High1, protest_count1, VAC_count1, total_fatalities1, category1, al_wafa_Total_Posts2, bahrain_moi_Total_Posts2, BahrainRights_Favorites2, BahrainRights_Retweets2, BBCArabic_Total_Posts2, BBCArabic_Favorites2, BBCArabic_Retweets2, bh14feb2011_Total_Posts2, bh14feb2011_Favorites2, bh14feb2011_Retweets2, bna_ar_Total_Posts2, bna_ar_Retweets2, Coalition14_Total_Posts2, Coalition14_Favorites2, duraz_youth_Total_Posts2, duraz_youth_Favorites2, duraz_youth_Retweets2, feb14revolution_Retweets2, GDNonline_Total_Posts2, GDNonline_Favorites2, GDNonline_Retweets2, Iran_Total_Posts2, Iran_Favorites2, IranNW_Retweets2, malarab1_Favorites2, NABEELRAJAB_Favorites2, netanyahu_Favorites2, netanyahu_Retweets2, rouhani_Total_Posts2, rouhani_Favorites2, USEmbassyManama_Retweets2, TEMP2, DEWP2, WDSP2, PRCP2, zinc_Open2, zinc_Low2, WTI_Close2, WTI_Low2, wheat_Open2, wheat_High2, wheat_Low2, tin_Close2, tin_High2, tin_Low2, sugar_Close2, sugar_Open2, sugar_Low2, soybean_Close2, soybean_Open2, soybean_High2, soybean_Low2, silver_High2, rice_Close2, rice_High2, platinum_Close2, natural_gas_Close2, monero_Close2, monero_High2, litecoin_Close2, litecoin_Open2, litecoin_Low2, lead_High2, lead_Low2, Gold_Low2, cotton_Low2, corn_High2, corn_Low2, copper_Close2, copper_High2, coffee_Close2, coffee_High2, live_cattle_Close2, live_cattle_High2, live_cattle_Low2, feed_cattle_Close2, feed_cattle_Open2, Brent_Close2, Brent_Open2, Bitcoin_Open2, Bitcoin_Low2, BAX_Open2, BAX_High2, protest_count2, VAC_count2, total_fatalities2, category2, category3)

  ## Applying RF
  RandomForest <- randomForest(category3 ~ ., data=train, importance = TRUE, ntrees = nrow(train), weights = 1000/table(train$category))
  predRF <- predict(RandomForest, newdata = test, type = "response")
      
  RF.Pre[[k]] <- predRF
  confusion_matrix <- confusionMatrix(predClassRF, test$category3)
  
  RF.accuracy[[k]] <- confusion_matrix$overall[1]
  RF.CM.List[[k]] <- multi_class_rates(as.matrix(confusion_matrix))
}
```

```{r}
# Create variables to calculate the mean of each element inside the dataframe 
# True positives
TP.HR <- list()
TP.LR <- list()
TP.MR <- list()

# False positives
FP.HR <- list()
FP.LR <- list()
FP.MR <- list()

# True negatives
TN.LR <- list()
TN.MR <- list()
TN.HR <- list()

# False negatives
FN.LR <- list()
FN.MR <- list()
FN.HR <- list()

i <- 1 # Initialize a counter
while(i <= length(RF.CM.List)){ # Iterate over every dataframe
  TP.HR[[i]] <- RF.CM.List[[i]][[1,1]]
  TP.LR[[i]] <- RF.CM.List[[i]][[2,1]]
  TP.MR[[i]] <- RF.CM.List[[i]][[3,1]]
  
  # False positives
  FP.HR[[i]] <- RF.CM.List[[i]][[1,2]]
  FP.LR[[i]] <- RF.CM.List[[i]][[2,2]]
  FP.MR[[i]] <- RF.CM.List[[i]][[3,2]]
  
  # True negatives
  TN.HR[[i]] <- RF.CM.List[[i]][[1,3]]
  TN.LR[[i]] <- RF.CM.List[[i]][[2,3]]
  TN.MR[[i]] <- RF.CM.List[[i]][[3,3]]
  
  # False negatives
  FN.HR[[i]] <- RF.CM.List[[i]][[1,4]] 
  FN.LR[[i]] <- RF.CM.List[[i]][[2,4]]
  FN.MR[[i]] <- RF.CM.List[[i]][[3,4]]
  
  i = i + 1 # Increment the counter
}

# Remove null elements from list
TP.HR <- TP.HR[!sapply(TP.HR, is.null)]
TP.LR <- TP.LR[!sapply(TP.LR, is.null)]
TP.MR <- TP.MR[!sapply(TP.MR, is.null)]

FP.HR <- FP.HR[!sapply(FP.HR, is.null)]
FP.LR <- FP.LR[!sapply(FP.LR, is.null)]
FP.MR <- FP.MR[!sapply(FP.MR, is.null)]

TN.HR <- TN.HR[!sapply(TN.HR, is.null)]
TN.LR <- TN.LR[!sapply(TN.LR, is.null)]
TN.MR <- TN.MR[!sapply(TN.MR, is.null)]

FN.HR <- FN.HR[!sapply(FN.HR, is.null)]
FN.LR <- FN.LR[!sapply(FN.LR, is.null)]
FN.MR <- FN.MR[!sapply(FN.MR, is.null)]
```

```{r}
# Create a matrix that averages true positives, true negatives, false positives, and false negatives
final_matrix <-matrix(data = NA, nrow = 3, ncol = 4)
colnames(final_matrix) <- c("True Positive", "False Positive", "True Negative", "False Negative")
rownames(final_matrix) <- c("High Risk", "Low Risk", "Moderate Risk")
final_matrix[1,1] <- mean(sapply(TP.HR, mean))
final_matrix[2,1] <- mean(sapply(TP.LR, mean))
final_matrix[3,1] <- mean(sapply(TP.MR, mean))
final_matrix[1,2] <- mean(sapply(FP.HR, mean))
final_matrix[2,2] <- mean(sapply(FP.LR, mean))
final_matrix[3,2] <- mean(sapply(FP.MR, mean))
final_matrix[1,3] <- mean(sapply(TN.HR, mean))
final_matrix[2,3] <- mean(sapply(TN.LR, mean))
final_matrix[3,3] <- mean(sapply(TN.MR, mean))
final_matrix[1,4] <- mean(sapply(FN.HR, mean))
final_matrix[2,4] <- mean(sapply(FN.LR, mean))
final_matrix[3,4] <- mean(sapply(FN.MR, mean))

# Call to the final matrix
final_matrix

# Calculate ratios for true positive, true negative, false positive, and false negative
TPR <- (final_matrix[1,1] + final_matrix[2,1] + final_matrix[3,1])/(final_matrix[1,1] + final_matrix[2,1] + final_matrix[3,1] + final_matrix[1,2] + final_matrix[2,2] + final_matrix[3,2])

TNR <- (final_matrix[1,3] + final_matrix[2,3] + final_matrix[3,3])/(final_matrix[1,3] + final_matrix[2,3] + final_matrix[3,3] + final_matrix[1,4] + final_matrix[2,4] + final_matrix[3,4])

FPR <- (final_matrix[1,2] + final_matrix[2,2] + final_matrix[3,2])/(final_matrix[1,1] + final_matrix[2,1] + final_matrix[3,1] + final_matrix[1,2] + final_matrix[2,2] + final_matrix[3,2])
  
FNR <- (final_matrix[1,4] + final_matrix[2,4] + final_matrix[3,4])/(final_matrix[1,3] + final_matrix[2,3] + final_matrix[3,3] + final_matrix[1,4] + final_matrix[2,4] + final_matrix[3,4])
```

```{r, echo = FALSE}
print(paste0("The overall accuracy of the model is ", round(mean(do.call(rbind, RF.accuracy)),4)*100, "%."))
print(paste0("The overall false positive rate of the model is ", round(FPR,4)*100, "%."))
print(paste0("The overall false negative rate of the model is ", round(FNR,4)*100, "%."))
print(paste0("The overall true negative rate of the model is ", round(TNR,4)*100, "%."))
print(paste0("The overall true positive rate of the model is ", round(TPR,4)*100, "%."))

save.image(file = '03SEP20.RData')
```

# Questions
 + Write each member's name and clearly write each member's contribution to the project [5 points]
 CPT David Wren: Developed data collection/collation codebook, created various models, created the presentation, and compiled the R Markdown document.
 LT Vanny Angeles: Assisted in debugging efforts and verified model formulation.
 Capt Quentin Biles: Assisted in debugging efforts and verified model formulation. 
 
 + Explain the data set.  Why is it interesting/important to analyze? [10 points]
  o Bahrain is of strategic importance due to NSA Bahrain, which is home to USNAVCENT/5th Fleet headquarters.  It is also a Saudi Arabian proxy with a minority Sunni ruling over a Shi'a majority.  Saudi Arabia's east coast is predominately Shi’a and their actions do reach across the causeway connecting the two countries.  Due to its proximity to both Iran and Saudi Arabia, Bahrain causes strife between regional hegemonic powers and serves as one of two locations for proxy wars.
  o Bahrain had their own version of the Arab Spring that started on 14 February 2011.  Since then both violent and non-violent demonstrations have been a daily occurrence.
  o Certain actions by either side, to include their benefactors, will cause spikes in the daily number of events.
  o Today, opposition groups are loosely associated under the banner ‘14 February’.  These groups are mostly military age males who mostly participate in rioting while all ages and genders participate in non-violent demonstrations.

 + How did you obtain the data?  How did you clear the data? [5 points]
  o The team collected data from open source websites that track stock prices for commodities, Twitter for social media data, Armed Conflict Location & Event Data Project, and the National Oceanic and Atmospheric Administration.  Economic data required a simple user name and password to access historical data.  Twitter data required a developer account and both NOAA and ACLED provide their data openly.
  o Although market speculation occurs outside of trading hours, economic data had to be set to the last trading day.  For example, since Labor Day is always on a Monday, Friday’s data set the values for Saturday, Sunday, and Monday.
  o Twitter data often had missing information when no posts were made.  A date sequence was created from the start to finish and then merged with the respective Twitter handles.  If there were NA values in this new dataframe, they were set to zero.
  o Physical environment data had some gaps so manual lookup of those dates was required.
  o ACLED reporting often miscategorized individual events within the data.  For example, ‘mob violence’ and ‘violent demonstrations’ are sub-events under ‘riots.’  However, the definition delineating the two can be difficult to apply across any theater.  As a result, ACLED often categorized Bahraini riots as ‘violent demonstrations’ in 2016-2018 but then categorized riots as ‘mob violence’ in 2019.  The team created aggregated ‘mob violence’ and ‘violent demonstrations’ into one new event category ‘riot_count.’  This techniques was applied to all sub-events to create, for example, ‘VAC_count,’ or ‘Violence Against Civilians count.

 + Describe your research objective, i.e., are you predicting? or are you classifying? How you analyze your data? [10 points]
 o The research objective for this problem set is to accurately predict the daily number of riots that occur in Bahrain, which have the potential to disrupt US & Allied naval operations within the region.
 o The team's initial reaction is to accurately predict the total number of events.  However, this proved to be challenging as the data is heavily right-skewed.  The team ran iterations both not attempting and attempting to correct the skewedness by taking a log(value + 1) transformation.  While this did transform the data into a more linear fashion, it ultimately did not decrease the MAPE and MASE to satisfactory levels.
 
 + How did you select model?  [5 points]
 o As previously discussed, the team set out to try and accurately predict the number of riots on any given day under the assumption that daily riots were independent events.  The team implemented models from OA3103 to include LASSO, Elastic Net, Forward, Backward, and Both stepwise regression.  However, assuming daily events are independent is a very broad assumption that is often incorrect as was our case.  The team then created time series models such as DYNLM, MARIMA, univariate, and Rolling Horizon models.   However, as the MAPE and MASE above were less than satisfactory.  The team began to wonder about its objective and is there a better way to design a model.  The team then changed course to classification and attempting to predict a category of riot risk for any given day.  Lastly, the team combined Rolling Horizon with Random Forest to classify this risk.
 
 + Why are you using these methods for model selection and why did it pick the model? [5 points]
 o Since this data is a time series, we needed to incorporate a time series model.  Despite the various methods available and explored above such as MARIMA and DYNLM, Rolling Horizon proved the easiest to implement.  RandomForest is an ensemble method that is able to serve multiple classes while KNN, CART, and SVM as discussed in lecture were only able to construct binary classes.
 
 + Explain how you analyze it?  How well the model is fit to the data?  How did you measure the correctness? [10 points]
 o By incorporating rolling horizon into our data, we are able to produce a user-specified interval into the future.  The team elected to model an arbitrary 10 days into the future, which provided 10 observations and subsequent confusion matrices.  From there, we were able to analyze the accuracy, true positive, true negative, false positive, and false positive rates.  
 o Overall the model fits relatively well compared to a more traditional regression model as explored in this notebook.  Adjusting our ending point for the rolling horizon also has an impact on the model's accuracy rate as well.  For example, the model predicts with 100% accuracy the last month of data, December 2019 due to there only being "Low" risk events.  However, when ending the model at approximately the halfway point at date 700, the overall accuracy rate, true positive, false positive, true negative, and false negative values are 76.54%, 76.54%, 23.46%, 88.27%, and 11.73% respectively.  These results demonstrate that the model has difficulty in delineating between low, moderate, and high risk days.  Exchanging explanatory variables and adjusting the category thresholds have increase the requisite correctness parameters.
 
 + What are the results?  Conclusion.  [10 points]
  o Analyzing both the regression and classification models we can understand several conclusions.  First, time series analysis is an incredibly in depth subject that requires deep understanding of both theory and the dataset.  R employs several libraries capable of conducting time series analysis each more intricate than the last.  Therefore, it is imperative to truly understand what the package is doing and if that aligns with your objectives.  Second, the downward trend of events since 2018 may be causal, which can impact our various models and may be due to a number of factors.  If the notional NSA Bahrain Commander was willing to assume risk and believe that the violent activity on the island will remain at relative lows, we may be able to decrease our data collection range from 2016-2019 to 2018-2019.  Although this would reduce our dataset by 50%, it may provide a more accurate representation of today's data.
 
 + Discussion:  Pros and cons of methods you use. Any assumptions for your model?  Is there any  limitation?  Any improvement you can do?  [15 points]
 Pros:
  o Combining Rolling Horizon with RandomForest for classification is relatively easy to implement.
  o This combination is relatively computationally efficient compared to a Rolling Horizon/RandomForest to predict a quantitative value.
  o Although different measures of performance, classification yields a higher accuracy when comparing the various MAPEs and MASEs above.
  o By design, RandomForest has little impact of outliers and performs well on imbalanced data.
  
  Cons:
  o Arguably, the most significant con of our approach is the loss of granularity.  We are no longer able to predict a number of events whether it's the reduced dimension PCA value, riot count, or the total number of events.
  o With any RandomForest model, we are unable to accurately understand the model's characteristics due to RandomForests being "Black Box" models.
  o For our particular dataset, our predictors may not have ample predictive power.  When analyzing ACLED's data collection techniques, we can see that their Bahraini data overwhelmingly comes from social media and in particular Twitter.  As a result, one would think that predicting events using this data would've yielded better results.
  o Unknown to us, our prediction trees may be correlated, which is a byproduct of RandomForest.
  
  Limitations:
  o We can see from the univariate time series data above that the data is on an apparent downward trend, which may be causal.  As a result, trying to accurately predict the number of events may be difficult if a lower number of events is the new normal. 
  o The dataset somewhat accurately represents the ACLED target variables.  Despite ACLED drawing its data directly from Twitter, our dataset contains a significant amount of noise.
  o Time series data are difficult to accurately predict.

 + Cite all references. [10 points]
    https://www.cia.gov/library/publications/the-world-factbook/geos/ba.html
    https://data.worldbank.org/indicator/SP.URB.TOTL.IN.ZS?locations=BH
    http://www.washingtoninstitute.org/templateC05.php?CID=3309.
    http://www.bbc.com/news/world-middle-east-14540571
    http://www.indexoncensorship.org/2011/02/whats-behind-bahrains-protests/
    http://www.mepc.org/battle-bahrain-iranian-saudi-rivalry
    http://files.bici.org.bh/BICIreportEN.pdf
    http://www.nytimes.com/2011/03/15/world/middleeast/15bahrain.html?_r=1&hp
    http://guides.library.cornell.edu/c.php?g=31688&p=200754
    http://foreignpolicy.com/2012/01/02/bahrains-revolutionaries/
    http://www.washington.edu/news/2011/09/12/new-study-quantifies-use-of-social-media-in-arab-spring/
    http://www.economist.com/node/21550328
    http://www.twitter.com
    http://www.investing.com
    http://www.acleddata.com

# Way Forward
As previously noted, raw data from across 191 PMESII-PT variables were collected; however, additional data is necessary to increase overall accuracy of the model.  Accounting for nearly 98% of all internet searches in Bahrain, Google dominates as the number one internet search engine.   Therefore, incorporating daily search engine data from Google may be worthwhile.  Unfortunately, Google Trends provides only a relative usage value and not a raw number of user searches.  In the event Google decides to release its raw data or an agreement can be reached to incorporate Google’s raw data, it may prove to be of value as well.  Daily arrest statistics may be have an impact since the arrest of any key opposition members will inherently be a point of contention amongst low-level leaders and their followers.  Since opposition members primarily utilize mobile phones to communicate and coordinate protests, daily cell phone data usage rates may prove to be statistically significant.  Searching and accounting for key terms within articles, both Arabic and English, is possible with the advent of simple coding software and can be incorporated into each model.

As evidenced in our predictor selection, social media plays a predominant role in each of these models.  Social media will only continue to rise as users continue to create profiles, develop original content, and facilitate social networking.  The rise of the Arabic language is increasingly dominating social interactions online as these mediums are becoming the de facto location for people and organizations to connect and interact in Bahrain and throughout the Middle East.   As evidenced with the Black Lives Matter movement in the United States, social media allows individuals to organize, mobilize, and react almost instantaneously to polarizing events.  Bahrain is no exception to this as evidenced with the Arab Spring in 2011 and the opposition’s usage of social media today.  However, access and utilization of social media is no longer limited to youth as older generations are increasing their usage as well.   Social media plays an increasing vital role in the daily lives of billions around the world.

The models mentioned in this project merely demonstrates a prototype capability that can be modified, improved, and replicated across various countries.  For example, famine and unrest in Yemen or refugee migration in Syria may be predicted utilizing similar methods.  Furthermore, if this concept is applied to other countries within the Middle East, a cumulative model may be developed to predict the next Arab Spring.  In addition to application at the country level, this concept can be applied to districts in an attempt to model behavior in a particular area.  Applying these concepts at the micro and macro level to regions across the world allows a supported command to coordinate with host nation partners to affect and mitigate contributing factors.  

# Conclusion
By collecting civil information through data mining, one is able to develop a holistic understanding of the operational environment.  Moreover, this holistic understanding of the civil-sector components increases a command’s ability to affect events within an operational environment.  Despite the randomness associated with human behavior, the team demonstrated the ability to model daily protests given data surrounding the operational environment.  By analyzing seasonality within the data, the team identified that there may be an intentional or coincidental cycle of seven to ten days.  Identifying this pattern will enable effective decision making for appropriate force protection measures.  The team's analysis of high-risk areas yielded sufficient evidence that the base is not under imminent threat but the situation should be monitored.  The team analyzed the relationship between violent demonstrations and non-violent protests and concluded that the two are independent and identically distributed.  The significance of this cannot be understated as it established two distinct groups: peaceful demonstrators and agitators.  These two actors can be addressed separately to resolve their grievances.  The team also analyzed the relationship between violent actions between Bahraini forces and its populace.  Although the team did not immediately identify a relationship, further analysis should be done to determine if a relationship exists between violence against civilians and future violent demonstrations or other event types.  

These models could benefit from additional data sources such as Google search history, social media, and economic data to improve its accuracy.  Additional historical protest data would allow the analyst team to understand seasonality and trends from year to year.  Supplementary modeling techniques such as segmented or Poisson regression may also prove fruitful for future efforts.  Data analytics allows for accurate modeling and prediction of not just violent protests in Bahrain but the methodology discussed in this project could be adapted and applied to nearly any country within the Middle East.  A 60 to 70% certainty could prove instrumental for military commanders who are utilizing military intelligence as their sole source of information and are merely speculating as to the enemy’s strategies.  